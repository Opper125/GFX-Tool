<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FPS GFX Tool - Admin Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&family=Noto+Sans+Myanmar:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Custom Fonts */
body {
  font-family: 'Noto Sans Myanmar', 'Inter', sans-serif;
  line-height: 1.4;
}
h1, h2, h3, .font-orbitron {
  font-family: 'Orbitron', sans-serif;
}
.font-share-tech {
  font-family: 'Share Tech Mono', monospace;
}

/* Enhanced Color Palette */
:root {
  --primary-bg: #0a0d14;
  --secondary-bg: #1a1f2e;
  --accent-purple: #8b5cf6;
  --accent-green: #10b981;
  --accent-blue: #3b82f6;
  --accent-red: #ef4444;
  --accent-yellow: #f59e0b;
  --text-primary: #f8fafc;
  --text-secondary: #94a3b8;
  --border-color: #334155;
  --card-bg: rgba(30, 35, 48, 0.9);
  --input-bg: rgba(51, 65, 85, 0.3);
  --hover-bg: rgba(139, 92, 246, 0.1);
}

body {
  background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
  color: var(--text-primary);
  min-height: 100vh;
}

.admin-card {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  backdrop-filter: blur(20px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
}

.admin-card:hover {
  border-color: var(--accent-purple);
  box-shadow: 0 15px 40px rgba(139, 92, 246, 0.2);
}

.admin-btn {
  background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
  color: white;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  padding: 10px 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
}

.admin-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
}

.btn-success {
  background: linear-gradient(135deg, var(--accent-green), #059669);
}

.btn-danger {
  background: linear-gradient(135deg, var(--accent-red), #dc2626);
}

.btn-warning {
  background: linear-gradient(135deg, var(--accent-yellow), #d97706);
  color: #1f2937;
}

.admin-input {
  background: var(--input-bg);
  border: 2px solid var(--border-color);
  border-radius: 8px;
  padding: 12px 16px;
  color: var(--text-primary);
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.admin-input:focus {
  border-color: var(--accent-purple);
  outline: none;
  box-shadow: 0 0 20px rgba(139, 92, 246, 0.2);
}

.admin-input::placeholder {
  color: var(--text-secondary);
}

.admin-table {
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  overflow: hidden;
  backdrop-filter: blur(10px);
}

.admin-table th {
  background: rgba(139, 92, 246, 0.15);
  color: var(--accent-purple);
  font-weight: 700;
  text-transform: uppercase;
  font-size: 11px;
  padding: 12px 8px;
  border-bottom: 1px solid var(--border-color);
}

.admin-table td {
  padding: 10px 8px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  font-size: 13px;
}

.admin-table tbody tr:hover {
  background: var(--hover-bg);
}

.stats-card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.stats-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(139, 92, 246, 0.15);
}

.nav-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 8px 16px;
  color: var(--text-secondary);
  transition: all 0.3s ease;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
}

.nav-btn:hover, .nav-btn.active {
  background: var(--accent-purple);
  color: white;
  border-color: var(--accent-purple);
}

.loading-spinner {
  border: 3px solid rgba(139, 92, 246, 0.3);
  border-top: 3px solid var(--accent-purple);
  border-radius: 50%;
  width: 20px;
  height: 20px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 12px 20px;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  z-index: 1000;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

.success { background: var(--accent-green); }
.error { background: var(--accent-red); }
.warning { background: var(--accent-yellow); color: #1f2937; }
.info { background: var(--accent-blue); }

.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  padding: 20px;
}

.modal-content {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 24px;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  backdrop-filter: blur(20px);
}

.hidden { display: none !important; }

.connection-status {
  position: fixed;
  top: 15px;
  right: 15px;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  z-index: 1000;
}

.status-online {
  background: var(--accent-green);
  color: white;
}

.status-offline {
  background: var(--accent-red);
  color: white;
}

.status-connecting {
  background: var(--accent-yellow);
  color: #1f2937;
}

.badge {
  display: inline-block;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
}

.badge-active { background: var(--accent-green); color: white; }
.badge-inactive { background: var(--accent-red); color: white; }
.badge-pending { background: var(--accent-yellow); color: #1f2937; }
.badge-approved { background: var(--accent-green); color: white; }
.badge-rejected { background: var(--accent-red); color: white; }
.badge-banned { background: var(--accent-red); color: white; }

/* Responsive Design */
@media (max-width: 768px) {
  .admin-card { margin: 8px; padding: 16px; }
  .stats-card { padding: 16px; }
  .admin-table { font-size: 11px; }
  .admin-table th, .admin-table td { padding: 8px 4px; }
  .nav-btn { padding: 6px 12px; font-size: 12px; margin: 2px; }
  .modal-content { padding: 16px; }
}

/* Print Styles for PDF Export */
@media print {
  body { background: white !important; color: black !important; }
  .admin-card { background: white !important; border: 1px solid #ccc !important; }
  .stats-card { background: white !important; border: 1px solid #ccc !important; }
  .admin-table { background: white !important; }
  .admin-table th { background: #f3f4f6 !important; color: black !important; }
  .connection-status, .notification { display: none !important; }
  .modal { display: none !important; }
}
</style>
</head>
<body>

<!-- Connection Status -->
<div id="connection-status" class="connection-status status-connecting">
  <i class="fas fa-wifi"></i> CONNECTING...
</div>

<!-- Notification Container -->
<div id="notification-container"></div>

<!-- Main Container -->
<div class="container mx-auto px-4 py-6 max-w-7xl">
  
  <!-- Header -->
  <div class="text-center mb-8">
    <h1 class="text-3xl md:text-4xl font-orbitron font-bold mb-2 text-purple-400">
      <i class="fas fa-shield-alt mr-2"></i>
      FPS GFX TOOL ADMIN
    </h1>
    <p class="text-gray-400 font-semibold">SYSTEM MANAGEMENT CONSOLE</p>
  </div>

  <!-- Login Section -->
  <div id="login-section" class="max-w-md mx-auto">
    <div class="admin-card p-8">
      <h3 class="text-xl font-orbitron font-bold text-center mb-6 text-purple-400">
        <i class="fas fa-key mr-2"></i>
        ADMIN AUTHENTICATION
      </h3>
      <div class="space-y-4">
        <input 
          type="password" 
          id="admin-password" 
          placeholder="Enter Admin Password..." 
          class="admin-input w-full"
        >
        <button 
          onclick="adminLogin()" 
          id="login-btn"
          class="admin-btn w-full flex items-center justify-center space-x-2"
        >
          <i class="fas fa-sign-in-alt"></i>
          <span>ACCESS DASHBOARD</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Admin Dashboard -->
  <div id="admin-dashboard" class="hidden">
    
    <!-- Statistics Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8">
      <div class="stats-card">
        <i class="fas fa-users text-2xl text-blue-400 mb-2"></i>
        <h3 class="text-xs font-semibold text-gray-400 mb-1">USERS</h3>
        <p id="total-users" class="text-xl font-bold text-purple-400">0</p>
      </div>
      <div class="stats-card">
        <i class="fas fa-key text-2xl text-green-400 mb-2"></i>
        <h3 class="text-xs font-semibold text-gray-400 mb-1">KEYS</h3>
        <p id="total-keys" class="text-xl font-bold text-green-400">0</p>
      </div>
      <div class="stats-card">
        <i class="fas fa-newspaper text-2xl text-yellow-400 mb-2"></i>
        <h3 class="text-xs font-semibold text-gray-400 mb-1">NEWS</h3>
        <p id="total-news" class="text-xl font-bold text-yellow-400">0</p>
      </div>
      <div class="stats-card">
        <i class="fas fa-box-open text-2xl text-red-400 mb-2"></i>
        <h3 class="text-xs font-semibold text-gray-400 mb-1">PRODUCTS</h3>
        <p id="total-products" class="text-xl font-bold text-red-400">0</p>
      </div>
      <div class="stats-card">
        <i class="fas fa-user-check text-2xl text-cyan-400 mb-2"></i>
        <h3 class="text-xs font-semibold text-gray-400 mb-1">KYC PENDING</h3>
        <p id="pending-kyc" class="text-xl font-bold text-cyan-400">0</p>
      </div>
      <div class="stats-card">
        <i class="fas fa-shopping-cart text-2xl text-orange-400 mb-2"></i>
        <h3 class="text-xs font-semibold text-gray-400 mb-1">ORDERS</h3>
        <p id="pending-orders" class="text-xl font-bold text-orange-400">0</p>
      </div>
    </div>

    <!-- Navigation -->
    <div class="flex flex-wrap justify-center gap-2 mb-8">
      <button onclick="showSection('about', this)" class="nav-btn active">
        <i class="fas fa-info-circle mr-1"></i>ABOUT
      </button>
      <button onclick="showSection('keys', this)" class="nav-btn">
        <i class="fas fa-key mr-1"></i>KEYS
      </button>
      <button onclick="showSection('users', this)" class="nav-btn">
        <i class="fas fa-users mr-1"></i>USERS
      </button>
      <button onclick="showSection('news', this)" class="nav-btn">
        <i class="fas fa-newspaper mr-1"></i>NEWS
      </button>
      <button onclick="showSection('products', this)" class="nav-btn">
        <i class="fas fa-box-open mr-1"></i>PRODUCTS
      </button>
      <button onclick="showSection('payments', this)" class="nav-btn">
        <i class="fas fa-credit-card mr-1"></i>PAYMENTS
      </button>
      <button onclick="showSection('kyc', this)" class="nav-btn">
        <i class="fas fa-user-shield mr-1"></i>KYC
      </button>
      <button onclick="showSection('support', this)" class="nav-btn">
        <i class="fas fa-headset mr-1"></i>SUPPORT
      </button>
      <button onclick="showSection('user-products', this)" class="nav-btn">
        <i class="fas fa-store mr-1"></i>USER PRODUCTS
      </button>
      <button onclick="showSection('orders', this)" class="nav-btn">
        <i class="fas fa-shopping-cart mr-1"></i>ORDERS
      </button>
      <button onclick="adminLogout()" class="nav-btn btn-danger">
        <i class="fas fa-sign-out-alt mr-1"></i>LOGOUT
      </button>
    </div>

    <!-- About Management -->
    <div id="about-section" class="admin-section">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-info-circle mr-2"></i>ABOUT INFORMATION MANAGEMENT
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">CONTACT NAME</label>
            <input type="text" id="about-contact-name" class="admin-input w-full" placeholder="Contact Name">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">PHONE NUMBER</label>
            <input type="text" id="about-phone" class="admin-input w-full" placeholder="+95 9xx xxx xxxx">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">EMAIL</label>
            <input type="email" id="about-email" class="admin-input w-full" placeholder="contact@example.com">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">TELEGRAM LINK</label>
            <input type="url" id="about-telegram" class="admin-input w-full" placeholder="https://t.me/username">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">VIBER LINK</label>
            <input type="url" id="about-viber" class="admin-input w-full" placeholder="viber://chat?number=">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">FACEBOOK LINK</label>
            <input type="url" id="about-facebook" class="admin-input w-full" placeholder="https://facebook.com/page">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">TIKTOK LINK</label>
            <input type="url" id="about-tiktok" class="admin-input w-full" placeholder="https://tiktok.com/@username">
          </div>
          <div class="flex items-end">
            <button onclick="updateAbout()" class="admin-btn w-full">
              <i class="fas fa-save mr-2"></i>UPDATE ABOUT
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Keys Management -->
    <div id="keys-section" class="admin-section hidden">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-key mr-2"></i>ACCESS KEYS MANAGEMENT
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <input type="text" id="new-key-text" class="admin-input font-share-tech" placeholder="Enter new key...">
          <button onclick="generateRandomKey()" class="admin-btn btn-warning">
            <i class="fas fa-random mr-1"></i>GENERATE RANDOM
          </button>
          <button onclick="createKey()" class="admin-btn btn-success">
            <i class="fas fa-plus mr-1"></i>CREATE KEY
          </button>
        </div>

        <div class="overflow-x-auto">
          <table class="admin-table w-full">
            <thead>
              <tr>
                <th>KEY TEXT</th>
                <th>STATUS</th>
                <th>USED BY</th>
                <th>CREATED</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody id="keys-table">
              <tr>
                <td colspan="5" class="text-center py-8">
                  <div class="loading-spinner mx-auto mb-2"></div>
                  Loading keys...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Users Management -->
    <div id="users-section" class="admin-section hidden">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-users mr-2"></i>USER MANAGEMENT
        </h3>
        
        <div class="overflow-x-auto">
          <table class="admin-table w-full">
            <thead>
              <tr>
                <th>PROFILE</th>
                <th>USERNAME</th>
                <th>DISPLAY NAME</th>
                <th>STATUS</th>
                <th>CAN SELL</th>
                <th>KYC STATUS</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody id="users-table">
              <tr>
                <td colspan="7" class="text-center py-8">
                  <div class="loading-spinner mx-auto mb-2"></div>
                  Loading users...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- News Management -->
    <div id="news-section" class="admin-section hidden">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-newspaper mr-2"></i>NEWS MANAGEMENT
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">TITLE</label>
            <input type="text" id="news-title" class="admin-input w-full" placeholder="News title...">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">MEDIA FILE</label>
            <input type="file" id="news-media" class="admin-input w-full" accept="image/*,video/*,audio/*">
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium mb-2 text-gray-400">CONTENT</label>
            <textarea id="news-content" class="admin-input w-full" rows="4" placeholder="News content..."></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">YOUTUBE LINK</label>
            <input type="url" id="news-youtube" class="admin-input w-full" placeholder="https://youtube.com/...">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">TELEGRAM LINK</label>
            <input type="url" id="news-telegram" class="admin-input w-full" placeholder="https://t.me/...">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">FACEBOOK LINK</label>
            <input type="url" id="news-facebook" class="admin-input w-full" placeholder="https://facebook.com/...">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">TIKTOK LINK</label>
            <input type="url" id="news-tiktok" class="admin-input w-full" placeholder="https://tiktok.com/...">
          </div>
          <div class="md:col-span-2">
            <button onclick="createNews()" class="admin-btn w-full">
              <i class="fas fa-plus mr-2"></i>CREATE NEWS
            </button>
          </div>
        </div>

        <div id="news-list" class="space-y-4">
          <div class="loading-spinner mx-auto mb-4"></div>
          <p class="text-center text-gray-400">Loading news...</p>
        </div>
      </div>
    </div>

    <!-- Products Management -->
    <div id="products-section" class="admin-section hidden">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-box-open mr-2"></i>PRODUCTS MANAGEMENT
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">PRODUCT NAME</label>
            <input type="text" id="product-name" class="admin-input w-full" placeholder="Product name...">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">PRICE (MMK)</label>
            <input type="number" id="product-price" class="admin-input w-full" placeholder="0" min="0" step="0.01">
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium mb-2 text-gray-400">DESCRIPTION</label>
            <textarea id="product-description" class="admin-input w-full" rows="3" placeholder="Product description..."></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">FILE TYPE</label>
            <select id="product-file-type" class="admin-input w-full">
              <option value="apk">APK</option>
              <option value="zip">ZIP</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">PRODUCT FILE</label>
            <input type="file" id="product-file" class="admin-input w-full">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">ICON IMAGE</label>
            <input type="file" id="product-icon" class="admin-input w-full" accept="image/*">
          </div>
          <div>
            <button onclick="createProduct()" class="admin-btn w-full">
              <i class="fas fa-plus mr-2"></i>CREATE PRODUCT
            </button>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="admin-table w-full">
            <thead>
              <tr>
                <th>ICON</th>
                <th>NAME</th>
                <th>TYPE</th>
                <th>PRICE</th>
                <th>STATUS</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody id="products-table">
              <tr>
                <td colspan="6" class="text-center py-8">
                  <div class="loading-spinner mx-auto mb-2"></div>
                  Loading products...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Payments Management -->
    <div id="payments-section" class="admin-section hidden">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-credit-card mr-2"></i>PAYMENT METHODS MANAGEMENT
        </h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">METHOD NAME</label>
            <input type="text" id="payment-method-name" class="admin-input w-full" placeholder="KBZ Pay, Wave Money, etc.">
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">ACCOUNT INFO</label>
            <input type="text" id="payment-account-info" class="admin-input w-full" placeholder="Account number or phone">
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium mb-2 text-gray-400">INSTRUCTIONS</label>
            <textarea id="payment-instructions" class="admin-input w-full" rows="2" placeholder="Payment instructions..."></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium mb-2 text-gray-400">QR CODE IMAGE</label>
            <input type="file" id="payment-qr-code" class="admin-input w-full" accept="image/*">
          </div>
          <div>
            <button onclick="createPaymentMethod()" class="admin-btn w-full">
              <i class="fas fa-plus mr-2"></i>ADD PAYMENT METHOD
            </button>
          </div>
        </div>

        <div class="overflow-x-auto">
          <table class="admin-table w-full">
            <thead>
              <tr>
                <th>METHOD NAME</th>
                <th>ACCOUNT INFO</th>
                <th>QR CODE</th>
                <th>STATUS</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody id="payment-methods-table">
              <tr>
                <td colspan="5" class="text-center py-8">
                  <div class="loading-spinner mx-auto mb-2"></div>
                  Loading payment methods...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- KYC Management -->
    <div id="kyc-section" class="admin-section hidden">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-user-shield mr-2"></i>KYC VERIFICATION MANAGEMENT
        </h3>
        
        <div class="overflow-x-auto">
          <table class="admin-table w-full">
            <thead>
              <tr>
                <th>USER</th>
                <th>FULL NAME</th>
                <th>ID TYPE</th>
                <th>ID NUMBER</th>
                <th>SUBMITTED</th>
                <th>STATUS</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody id="kyc-table">
              <tr>
                <td colspan="7" class="text-center py-8">
                  <div class="loading-spinner mx-auto mb-2"></div>
                  Loading KYC submissions...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Support Management -->
    <div id="support-section" class="admin-section hidden">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-headset mr-2"></i>SUPPORT MESSAGES MANAGEMENT
        </h3>
        
        <div class="overflow-x-auto">
          <table class="admin-table w-full">
            <thead>
              <tr>
                <th>USER</th>
                <th>SUBJECT</th>
                <th>MESSAGE</th>
                <th>STATUS</th>
                <th>CREATED</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody id="support-table">
              <tr>
                <td colspan="6" class="text-center py-8">
                  <div class="loading-spinner mx-auto mb-2"></div>
                  Loading support messages...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- User Products Management -->
    <div id="user-products-section" class="admin-section hidden">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-store mr-2"></i>USER PRODUCTS MANAGEMENT
        </h3>
        
        <div class="overflow-x-auto">
          <table class="admin-table w-full">
            <thead>
              <tr>
                <th>SELLER</th>
                <th>PRODUCT NAME</th>
                <th>PRICE</th>
                <th>CATEGORY</th>
                <th>STATUS</th>
                <th>CREATED</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody id="user-products-table">
              <tr>
                <td colspan="7" class="text-center py-8">
                  <div class="loading-spinner mx-auto mb-2"></div>
                  Loading user products...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Orders Management -->
    <div id="orders-section" class="admin-section hidden">
      <div class="admin-card p-6 mb-6">
        <h3 class="text-lg font-orbitron font-bold mb-4 text-purple-400 flex items-center">
          <i class="fas fa-shopping-cart mr-2"></i>ORDERS MANAGEMENT
        </h3>
        
        <div class="overflow-x-auto">
          <table class="admin-table w-full">
            <thead>
              <tr>
                <th>ORDER #</th>
                <th>BUYER</th>
                <th>TYPE</th>
                <th>AMOUNT</th>
                <th>STATUS</th>
                <th>CREATED</th>
                <th>ACTIONS</th>
              </tr>
            </thead>
            <tbody id="orders-table">
              <tr>
                <td colspan="7" class="text-center py-8">
                  <div class="loading-spinner mx-auto mb-2"></div>
                  Loading orders...
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- KYC Details Modal -->
<div id="kyc-modal" class="modal hidden">
  <div class="modal-content max-w-4xl">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-orbitron font-bold text-purple-400">KYC VERIFICATION DETAILS</h2>
      <button onclick="closeKycModal()" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="kyc-modal-content">
      <!-- KYC details will be loaded here -->
    </div>
  </div>
</div>

<!-- Confirm Action Modal -->
<div id="confirm-modal" class="modal hidden">
  <div class="modal-content max-w-md">
    <div class="text-center">
      <i class="fas fa-exclamation-triangle text-4xl text-yellow-400 mb-4"></i>
      <h3 class="text-xl font-orbitron font-bold mb-4">CONFIRM ACTION</h3>
      <p id="confirm-message" class="text-gray-400 mb-6">Are you sure you want to perform this action?</p>
      <div class="flex space-x-4">
        <button onclick="closeConfirmModal()" class="admin-btn flex-1">
          <i class="fas fa-times mr-2"></i>CANCEL
        </button>
        <button onclick="confirmAction()" class="admin-btn btn-danger flex-1">
          <i class="fas fa-check mr-2"></i>CONFIRM
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Loading Overlay -->
<div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="admin-card p-8 text-center">
    <div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px;"></div>
    <p class="text-white font-semibold">PROCESSING...</p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
<script>
// Configuration
const CONFIG = {
  SUPABASE_URL: 'https://rliwdosxsbauwxkayjoa.supabase.co', // Replace with your Supabase URL
  SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJsaXdkb3N4c2JhdXd4a2F5am9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMDA2NjIsImV4cCI6MjA2OTY3NjY2Mn0.uDvU9eX3Cy--D9l6daGaO2QMpn1YnxMJYVlbaeIgHu4', // Replace with your Supabase Anon Key
  ADMIN_PASSWORD: 'Opper_FPS' // Change this to your admin password
};

// Global Variables
let supabaseClient = null;
let isLoggedIn = false;
let currentSection = 'about';
let confirmCallback = null;

// Initialize
document.addEventListener('DOMContentLoaded', initializeApp);

async function initializeApp() {
  updateConnectionStatus('connecting');
  
  try {
    // Initialize Supabase
    if (typeof supabase !== 'undefined') {
      supabaseClient = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
      
      // Test connection
      const { data, error } = await supabaseClient.from('about').select('id').limit(1);
      
      if (error && error.code !== 'PGRST116') {
        throw new Error(`Database connection failed: ${error.message}`);
      }

      updateConnectionStatus('online');
      showNotification('Database connected successfully!', 'success');
      
    } else {
      throw new Error('Supabase library failed to load');
    }
  } catch (error) {
    console.error('Initialization error:', error);
    updateConnectionStatus('offline');
    showNotification(`Connection failed: ${error.message}`, 'error');
  }

  // Add enter key listener
  document.getElementById('admin-password').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      adminLogin();
    }
  });
}

function updateConnectionStatus(status) {
  const statusElement = document.getElementById('connection-status');
  statusElement.className = 'connection-status';
  
  switch (status) {
    case 'online':
      statusElement.classList.add('status-online');
      statusElement.innerHTML = '<i class="fas fa-check-circle"></i> ONLINE';
      break;
    case 'offline':
      statusElement.classList.add('status-offline');
      statusElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> OFFLINE';
      break;
    case 'connecting':
      statusElement.classList.add('status-connecting');
      statusElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> CONNECTING...';
      break;
  }
}

function showNotification(message, type = 'info', duration = 5000) {
  const container = document.getElementById('notification-container');
  const notification = document.createElement('div');
  
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <div class="flex items-center justify-between">
      <span>${message}</span>
      <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `;
  
  container.appendChild(notification);
  
  setTimeout(() => {
    if (notification.parentNode) {
      notification.remove();
    }
  }, duration);
}

function showLoading() {
  document.getElementById('loading-overlay').classList.remove('hidden');
}

function hideLoading() {
  document.getElementById('loading-overlay').classList.add('hidden');
}

async function adminLogin() {
  const password = document.getElementById('admin-password').value.trim();
  
  if (!password) {
    showNotification('Please enter admin password', 'error');
    return;
  }
  
  if (password !== CONFIG.ADMIN_PASSWORD) {
    showNotification('Invalid admin password', 'error');
    return;
  }
  
  showLoading();
  
  try {
    isLoggedIn = true;
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('admin-dashboard').classList.remove('hidden');
    
    showNotification('Admin login successful', 'success');
    await loadDashboardData();
    
  } catch (error) {
    console.error('Login error:', error);
    showNotification('Login failed: ' + error.message, 'error');
  } finally {
    hideLoading();
  }
}

function adminLogout() {
  isLoggedIn = false;
  document.getElementById('admin-dashboard').classList.add('hidden');
  document.getElementById('login-section').classList.remove('hidden');
  document.getElementById('admin-password').value = '';
  showNotification('Logged out successfully', 'success');
}

async function loadDashboardData() {
  try {
    // Load statistics
    await Promise.all([
      loadStats(),
      loadCurrentSection()
    ]);
  } catch (error) {
    console.error('Error loading dashboard data:', error);
    showNotification('Error loading dashboard data', 'error');
  }
}

async function loadStats() {
  try {
    const [users, keys, news, products, kyc, orders] = await Promise.all([
      supabaseClient.from('user_profiles').select('id', { count: 'exact', head: true }),
      supabaseClient.from('access_keys').select('id', { count: 'exact', head: true }),
      supabaseClient.from('news').select('id', { count: 'exact', head: true }),
      supabaseClient.from('admin_products').select('id', { count: 'exact', head: true }),
      supabaseClient.from('kyc_documents').select('id', { count: 'exact', head: true }).eq('status', 'pending'),
      supabaseClient.from('orders').select('id', { count: 'exact', head: true }).eq('status', 'pending')
    ]);

    document.getElementById('total-users').textContent = users.count || 0;
    document.getElementById('total-keys').textContent = keys.count || 0;
    document.getElementById('total-news').textContent = news.count || 0;
    document.getElementById('total-products').textContent = products.count || 0;
    document.getElementById('pending-kyc').textContent = kyc.count || 0;
    document.getElementById('pending-orders').textContent = orders.count || 0;
    
  } catch (error) {
    console.error('Error loading stats:', error);
  }
}

function showSection(section, buttonElement) {
  // Hide all sections
  document.querySelectorAll('.admin-section').forEach(el => el.classList.add('hidden'));
  
  // Show selected section
  document.getElementById(section + '-section').classList.remove('hidden');
  
  // Update navigation buttons
  document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
  if (buttonElement) buttonElement.classList.add('active');
  
  currentSection = section;
  loadCurrentSection();
}

async function loadCurrentSection() {
  switch (currentSection) {
    case 'about':
      await loadAbout();
      break;
    case 'keys':
      await loadKeys();
      break;
    case 'users':
      await loadUsers();
      break;
    case 'news':
      await loadNews();
      break;
    case 'products':
      await loadProducts();
      break;
    case 'payments':
      await loadPaymentMethods();
      break;
    case 'kyc':
      await loadKyc();
      break;
    case 'support':
      await loadSupport();
      break;
    case 'user-products':
      await loadUserProducts();
      break;
    case 'orders':
      await loadOrders();
      break;
  }
}

// About Management Functions
async function loadAbout() {
  try {
    const { data, error } = await supabaseClient
      .from('about')
      .select('*')
      .limit(1)
      .single();

    if (error && error.code !== 'PGRST116') {
      throw error;
    }

    if (data) {
      document.getElementById('about-contact-name').value = data.contact_name || '';
      document.getElementById('about-phone').value = data.phone_number || '';
      document.getElementById('about-email').value = data.email || '';
      document.getElementById('about-telegram').value = data.telegram_link || '';
      document.getElementById('about-viber').value = data.viber_link || '';
      document.getElementById('about-facebook').value = data.facebook_link || '';
      document.getElementById('about-tiktok').value = data.tiktok_link || '';
    }
  } catch (error) {
    console.error('Error loading about:', error);
    showNotification('Error loading about information', 'error');
  }
}

async function updateAbout() {
  showLoading();
  
  try {
    const aboutData = {
      contact_name: document.getElementById('about-contact-name').value.trim(),
      phone_number: document.getElementById('about-phone').value.trim(),
      email: document.getElementById('about-email').value.trim(),
      telegram_link: document.getElementById('about-telegram').value.trim(),
      viber_link: document.getElementById('about-viber').value.trim(),
      facebook_link: document.getElementById('about-facebook').value.trim(),
      tiktok_link: document.getElementById('about-tiktok').value.trim(),
      updated_at: new Date().toISOString()
    };

    const { data, error } = await supabaseClient
      .from('about')
      .upsert(aboutData, { onConflict: 'id' });

    if (error) throw error;

    showNotification('About information updated successfully', 'success');
    
  } catch (error) {
    console.error('Error updating about:', error);
    showNotification('Error updating about information', 'error');
  } finally {
    hideLoading();
  }
}

// Keys Management Functions
async function loadKeys() {
  try {
    const { data, error } = await supabaseClient
      .from('access_keys')
      .select(`
        *,
        user_profiles (username, display_name)
      `)
      .order('created_at', { ascending: false });

    if (error) throw error;

    const tbody = document.getElementById('keys-table');
    
    if (data && data.length > 0) {
      tbody.innerHTML = data.map(key => `
        <tr>
          <td class="font-share-tech text-sm">${key.key_text}</td>
          <td>
            <span class="badge badge-${key.status}">
              ${key.status.toUpperCase()}
            </span>
          </td>
          <td>
            ${key.user_profiles ? 
              `${key.user_profiles.display_name || key.user_profiles.username || 'N/A'}` : 
              'Not Used'
            }
          </td>
          <td>${new Date(key.created_at).toLocaleDateString()}</td>
          <td>
            <div class="flex space-x-2">
              ${key.status === 'active' ? 
                `<button onclick="banKey('${key.id}')" class="admin-btn btn-danger btn-sm">
                  <i class="fas fa-ban"></i>
                </button>` : 
                `<button onclick="activateKey('${key.id}')" class="admin-btn btn-success btn-sm">
                  <i class="fas fa-check"></i>
                </button>`
              }
              <button onclick="deleteKey('${key.id}')" class="admin-btn btn-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    } else {
      tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-400">No keys found</td></tr>';
    }
    
  } catch (error) {
    console.error('Error loading keys:', error);
    showNotification('Error loading keys', 'error');
  }
}

function generateRandomKey() {
  const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let result = '';
  for (let i = 0; i < 16; i++) {
    result += characters.charAt(Math.floor(Math.random() * characters.length));
  }
  document.getElementById('new-key-text').value = result;
}

async function createKey() {
  const keyText = document.getElementById('new-key-text').value.trim();
  
  if (!keyText) {
    showNotification('Please enter key text', 'error');
    return;
  }
  
  showLoading();
  
  try {
    const { data, error } = await supabaseClient
      .from('access_keys')
      .insert([{ 
        key_text: keyText,
        status: 'active',
        created_at: new Date().toISOString()
      }]);

    if (error) throw error;

    document.getElementById('new-key-text').value = '';
    showNotification('Key created successfully', 'success');
    await loadKeys();
    await loadStats();
    
  } catch (error) {
    console.error('Error creating key:', error);
    if (error.code === '23505') {
      showNotification('Key already exists', 'error');
    } else {
      showNotification('Error creating key', 'error');
    }
  } finally {
    hideLoading();
  }
}

async function banKey(keyId) {
  showConfirmDialog('Are you sure you want to ban this key?', async () => {
    showLoading();
    try {
      const { error } = await supabaseClient
        .from('access_keys')
        .update({ status: 'banned' })
        .eq('id', keyId);

      if (error) throw error;

      showNotification('Key banned successfully', 'success');
      await loadKeys();
      await loadStats();
    } catch (error) {
      console.error('Error banning key:', error);
      showNotification('Error banning key', 'error');
    } finally {
      hideLoading();
    }
  });
}

async function activateKey(keyId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('access_keys')
      .update({ status: 'active' })
      .eq('id', keyId);

    if (error) throw error;

    showNotification('Key activated successfully', 'success');
    await loadKeys();
    await loadStats();
  } catch (error) {
    console.error('Error activating key:', error);
    showNotification('Error activating key', 'error');
  } finally {
    hideLoading();
  }
}

async function deleteKey(keyId) {
  showConfirmDialog('Are you sure you want to delete this key? This action cannot be undone.', async () => {
    showLoading();
    try {
      const { error } = await supabaseClient
        .from('access_keys')
        .delete()
        .eq('id', keyId);

      if (error) throw error;

      showNotification('Key deleted successfully', 'success');
      await loadKeys();
      await loadStats();
    } catch (error) {
      console.error('Error deleting key:', error);
      showNotification('Error deleting key', 'error');
    } finally {
      hideLoading();
    }
  });
}

// Users Management Functions
async function loadUsers() {
  try {
    const { data, error } = await supabaseClient
      .from('user_profiles')
      .select(`
        *,
        access_keys (key_text)
      `)
      .order('created_at', { ascending: false });

    if (error) throw error;

    const tbody = document.getElementById('users-table');
    
    if (data && data.length > 0) {
      tbody.innerHTML = data.map(user => `
        <tr>
          <td>
            <img src="${user.profile_picture || '/placeholder.svg?height=40&width=40'}" 
                 alt="Profile" class="w-8 h-8 rounded-full object-cover">
          </td>
          <td class="font-semibold">${user.username || 'N/A'}</td>
          <td>${user.display_name || 'N/A'}</td>
          <td>
            <span class="badge badge-${user.account_status}">
              ${user.account_status.toUpperCase()}
            </span>
          </td>
          <td>
            ${user.can_sell ? 
              '<span class="text-green-400"><i class="fas fa-check"></i></span>' : 
              '<span class="text-red-400"><i class="fas fa-times"></i></span>'
            }
          </td>
          <td>
            <span class="badge badge-${user.kyc_status === 'approved' ? 'approved' : user.kyc_status === 'rejected' ? 'rejected' : 'pending'}">
              ${user.kyc_status.replace('_', ' ').toUpperCase()}
            </span>
          </td>
          <td>
            <div class="flex space-x-2">
              ${user.account_status === 'active' ? 
                `<button onclick="banUser('${user.id}')" class="admin-btn btn-danger btn-sm">
                  <i class="fas fa-ban"></i>
                </button>` : 
                `<button onclick="unbanUser('${user.id}')" class="admin-btn btn-success btn-sm">
                  <i class="fas fa-check"></i>
                </button>`
              }
              <button onclick="deleteUser('${user.id}')" class="admin-btn btn-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    } else {
      tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-400">No users found</td></tr>';
    }
    
  } catch (error) {
    console.error('Error loading users:', error);
    showNotification('Error loading users', 'error');
  }
}

async function banUser(userId) {
  showConfirmDialog('Are you sure you want to ban this user?', async () => {
    showLoading();
    try {
      const { error } = await supabaseClient
        .from('user_profiles')
        .update({ account_status: 'banned' })
        .eq('id', userId);

      if (error) throw error;

      showNotification('User banned successfully', 'success');
      await loadUsers();
    } catch (error) {
      console.error('Error banning user:', error);
      showNotification('Error banning user', 'error');
    } finally {
      hideLoading();
    }
  });
}

async function unbanUser(userId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('user_profiles')
      .update({ account_status: 'active' })
      .eq('id', userId);

    if (error) throw error;

    showNotification('User unbanned successfully', 'success');
    await loadUsers();
  } catch (error) {
    console.error('Error unbanning user:', error);
    showNotification('Error unbanning user', 'error');
  } finally {
    hideLoading();
  }
}

async function deleteUser(userId) {
  showConfirmDialog('Are you sure you want to delete this user? This action cannot be undone.', async () => {
    showLoading();
    try {
      const { error } = await supabaseClient
        .from('user_profiles')
        .delete()
        .eq('id', userId);

      if (error) throw error;

      showNotification('User deleted successfully', 'success');
      await loadUsers();
      await loadStats();
    } catch (error) {
      console.error('Error deleting user:', error);
      showNotification('Error deleting user', 'error');
    } finally {
      hideLoading();
    }
  });
}

// News Management Functions
async function loadNews() {
  try {
    const { data, error } = await supabaseClient
      .from('news')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;

    const newsList = document.getElementById('news-list');
    
    if (data && data.length > 0) {
      newsList.innerHTML = data.map(news => `
        <div class="admin-card p-4">
          <div class="flex justify-between items-start mb-2">
            <h4 class="font-bold text-lg">${news.title}</h4>
            <div class="flex space-x-2">
              <span class="badge badge-${news.status}">
                ${news.status.toUpperCase()}
              </span>
              <button onclick="deleteNews('${news.id}')" class="admin-btn btn-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          <p class="text-gray-400 text-sm mb-2">${news.content}</p>
          ${news.media_url ? `
            <div class="mb-2">
              ${news.media_type === 'image' ? 
                `<img src="${news.media_url}" alt="News media" class="max-w-full h-32 object-cover rounded">` :
                news.media_type === 'video' ? 
                `<video controls class="max-w-full h-32 rounded">
                  <source src="${news.media_url}" type="video/mp4">
                </video>` :
                `<audio controls class="w-full">
                  <source src="${news.media_url}" type="audio/mpeg">
                </audio>`
              }
            </div>
          ` : ''}
          <div class="flex flex-wrap gap-2 text-sm">
            ${news.youtube_link ? `<a href="${news.youtube_link}" target="_blank" class="text-red-400"><i class="fab fa-youtube"></i></a>` : ''}
            ${news.telegram_link ? `<a href="${news.telegram_link}" target="_blank" class="text-blue-400"><i class="fab fa-telegram"></i></a>` : ''}
            ${news.facebook_link ? `<a href="${news.facebook_link}" target="_blank" class="text-blue-600"><i class="fab fa-facebook"></i></a>` : ''}
            ${news.tiktok_link ? `<a href="${news.tiktok_link}" target="_blank" class="text-pink-400"><i class="fab fa-tiktok"></i></a>` : ''}
          </div>
          <p class="text-xs text-gray-500 mt-2">${new Date(news.created_at).toLocaleString()}</p>
        </div>
      `).join('');
    } else {
      newsList.innerHTML = '<div class="text-center py-8 text-gray-400">No news found</div>';
    }
    
  } catch (error) {
    console.error('Error loading news:', error);
    showNotification('Error loading news', 'error');
  }
}

async function createNews() {
  const title = document.getElementById('news-title').value.trim();
  const content = document.getElementById('news-content').value.trim();
  
  if (!title || !content) {
    showNotification('Please fill in title and content', 'error');
    return;
  }
  
  showLoading();
  
  try {
    const newsData = {
      title: title,
      content: content,
      youtube_link: document.getElementById('news-youtube').value.trim() || null,
      telegram_link: document.getElementById('news-telegram').value.trim() || null,
      facebook_link: document.getElementById('news-facebook').value.trim() || null,
      tiktok_link: document.getElementById('news-tiktok').value.trim() || null,
      status: 'published',
      created_at: new Date().toISOString()
    };

    const mediaFile = document.getElementById('news-media').files[0];
    if (mediaFile) {
      // In a real implementation, you would upload the file to Supabase storage
      // For this demo, we'll use a placeholder
      newsData.media_url = '/placeholder-media-url';
      newsData.media_type = mediaFile.type.startsWith('image') ? 'image' : 
                           mediaFile.type.startsWith('video') ? 'video' : 'audio';
    }

    const { data, error } = await supabaseClient
      .from('news')
      .insert([newsData]);

    if (error) throw error;

    // Clear form
    document.getElementById('news-title').value = '';
    document.getElementById('news-content').value = '';
    document.getElementById('news-media').value = '';
    document.getElementById('news-youtube').value = '';
    document.getElementById('news-telegram').value = '';
    document.getElementById('news-facebook').value = '';
    document.getElementById('news-tiktok').value = '';

    showNotification('News created successfully', 'success');
    await loadNews();
    await loadStats();
    
  } catch (error) {
    console.error('Error creating news:', error);
    showNotification('Error creating news', 'error');
  } finally {
    hideLoading();
  }
}

async function deleteNews(newsId) {
  showConfirmDialog('Are you sure you want to delete this news?', async () => {
    showLoading();
    try {
      const { error } = await supabaseClient
        .from('news')
        .delete()
        .eq('id', newsId);

      if (error) throw error;

      showNotification('News deleted successfully', 'success');
      await loadNews();
      await loadStats();
    } catch (error) {
      console.error('Error deleting news:', error);
      showNotification('Error deleting news', 'error');
    } finally {
      hideLoading();
    }
  });
}

// Products Management Functions
async function loadProducts() {
  try {
    const { data, error } = await supabaseClient
      .from('admin_products')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;

    const tbody = document.getElementById('products-table');
    
    if (data && data.length > 0) {
      tbody.innerHTML = data.map(product => `
        <tr>
          <td>
            <img src="${product.icon_url || '/placeholder.svg?height=32&width=32'}" 
                 alt="Icon" class="w-8 h-8 rounded object-cover">
          </td>
          <td class="font-semibold">${product.product_name}</td>
          <td>
            <span class="badge badge-${product.file_type === 'apk' ? 'success' : 'info'}">
              ${product.file_type.toUpperCase()}
            </span>
          </td>
          <td class="font-semibold">${product.price} MMK</td>
          <td>
            <span class="badge badge-${product.status}">
              ${product.status.toUpperCase()}
            </span>
          </td>
          <td>
            <div class="flex space-x-2">
              ${product.status === 'active' ? 
                `<button onclick="deactivateProduct('${product.id}')" class="admin-btn btn-warning btn-sm">
                  <i class="fas fa-pause"></i>
                </button>` : 
                `<button onclick="activateProduct('${product.id}')" class="admin-btn btn-success btn-sm">
                  <i class="fas fa-play"></i>
                </button>`
              }
              <button onclick="deleteProduct('${product.id}')" class="admin-btn btn-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    } else {
      tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-400">No products found</td></tr>';
    }
    
  } catch (error) {
    console.error('Error loading products:', error);
    showNotification('Error loading products', 'error');
  }
}

async function createProduct() {
  const name = document.getElementById('product-name').value.trim();
  const price = document.getElementById('product-price').value.trim();
  const description = document.getElementById('product-description').value.trim();
  const fileType = document.getElementById('product-file-type').value;
  
  if (!name || !price || !description) {
    showNotification('Please fill in all required fields', 'error');
    return;
  }
  
  const productFile = document.getElementById('product-file').files[0];
  if (!productFile) {
    showNotification('Please select a product file', 'error');
    return;
  }
  
  showLoading();
  
  try {
    const productData = {
      product_name: name,
      description: description,
      file_type: fileType,
      price: parseFloat(price),
      status: 'active',
      created_at: new Date().toISOString(),
      // In a real implementation, you would upload files to Supabase storage
      file_url: '/placeholder-file-url',
      icon_url: '/placeholder-icon-url'
    };

    const { data, error } = await supabaseClient
      .from('admin_products')
      .insert([productData]);

    if (error) throw error;

    // Clear form
    document.getElementById('product-name').value = '';
    document.getElementById('product-price').value = '';
    document.getElementById('product-description').value = '';
    document.getElementById('product-file').value = '';
    document.getElementById('product-icon').value = '';

    showNotification('Product created successfully', 'success');
    await loadProducts();
    await loadStats();
    
  } catch (error) {
    console.error('Error creating product:', error);
    showNotification('Error creating product', 'error');
  } finally {
    hideLoading();
  }
}

async function activateProduct(productId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('admin_products')
      .update({ status: 'active' })
      .eq('id', productId);

    if (error) throw error;

    showNotification('Product activated successfully', 'success');
    await loadProducts();
  } catch (error) {
    console.error('Error activating product:', error);
    showNotification('Error activating product', 'error');
  } finally {
    hideLoading();
  }
}

async function deactivateProduct(productId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('admin_products')
      .update({ status: 'inactive' })
      .eq('id', productId);

    if (error) throw error;

    showNotification('Product deactivated successfully', 'success');
    await loadProducts();
  } catch (error) {
    console.error('Error deactivating product:', error);
    showNotification('Error deactivating product', 'error');
  } finally {
    hideLoading();
  }
}

async function deleteProduct(productId) {
  showConfirmDialog('Are you sure you want to delete this product?', async () => {
    showLoading();
    try {
      const { error } = await supabaseClient
        .from('admin_products')
        .delete()
        .eq('id', productId);

      if (error) throw error;

      showNotification('Product deleted successfully', 'success');
      await loadProducts();
      await loadStats();
    } catch (error) {
      console.error('Error deleting product:', error);
      showNotification('Error deleting product', 'error');
    } finally {
      hideLoading();
    }
  });
}

// Payment Methods Management Functions
async function loadPaymentMethods() {
  try {
    const { data, error } = await supabaseClient
      .from('payment_methods')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;

    const tbody = document.getElementById('payment-methods-table');
    
    if (data && data.length > 0) {
      tbody.innerHTML = data.map(method => `
        <tr>
          <td class="font-semibold">${method.method_name}</td>
          <td>${method.account_info}</td>
          <td>
            ${method.qr_code_image ? 
              `<img src="${method.qr_code_image}" alt="QR Code" class="w-8 h-8 object-cover rounded">` : 
              'No QR'
            }
          </td>
          <td>
            <span class="badge badge-${method.status}">
              ${method.status.toUpperCase()}
            </span>
          </td>
          <td>
            <div class="flex space-x-2">
              ${method.status === 'active' ? 
                `<button onclick="deactivatePaymentMethod('${method.id}')" class="admin-btn btn-warning btn-sm">
                  <i class="fas fa-pause"></i>
                </button>` : 
                `<button onclick="activatePaymentMethod('${method.id}')" class="admin-btn btn-success btn-sm">
                  <i class="fas fa-play"></i>
                </button>`
              }
              <button onclick="deletePaymentMethod('${method.id}')" class="admin-btn btn-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    } else {
      tbody.innerHTML = '<tr><td colspan="5" class="text-center py-8 text-gray-400">No payment methods found</td></tr>';
    }
    
  } catch (error) {
    console.error('Error loading payment methods:', error);
    showNotification('Error loading payment methods', 'error');
  }
}

async function createPaymentMethod() {
  const methodName = document.getElementById('payment-method-name').value.trim();
  const accountInfo = document.getElementById('payment-account-info').value.trim();
  const instructions = document.getElementById('payment-instructions').value.trim();
  
  if (!methodName || !accountInfo) {
    showNotification('Please fill in method name and account info', 'error');
    return;
  }
  
  showLoading();
  
  try {
    const paymentData = {
      method_name: methodName,
      account_info: accountInfo,
      instructions: instructions || null,
      status: 'active',
      created_at: new Date().toISOString(),
      // In a real implementation, you would upload QR code to Supabase storage
      qr_code_image: null
    };

    const { data, error } = await supabaseClient
      .from('payment_methods')
      .insert([paymentData]);

    if (error) throw error;

    // Clear form
    document.getElementById('payment-method-name').value = '';
    document.getElementById('payment-account-info').value = '';
    document.getElementById('payment-instructions').value = '';
    document.getElementById('payment-qr-code').value = '';

    showNotification('Payment method created successfully', 'success');
    await loadPaymentMethods();
    
  } catch (error) {
    console.error('Error creating payment method:', error);
    showNotification('Error creating payment method', 'error');
  } finally {
    hideLoading();
  }
}

async function activatePaymentMethod(methodId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('payment_methods')
      .update({ status: 'active' })
      .eq('id', methodId);

    if (error) throw error;

    showNotification('Payment method activated successfully', 'success');
    await loadPaymentMethods();
  } catch (error) {
    console.error('Error activating payment method:', error);
    showNotification('Error activating payment method', 'error');
  } finally {
    hideLoading();
  }
}

async function deactivatePaymentMethod(methodId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('payment_methods')
      .update({ status: 'inactive' })
      .eq('id', methodId);

    if (error) throw error;

    showNotification('Payment method deactivated successfully', 'success');
    await loadPaymentMethods();
  } catch (error) {
    console.error('Error deactivating payment method:', error);
    showNotification('Error deactivating payment method', 'error');
  } finally {
    hideLoading();
  }
}

async function deletePaymentMethod(methodId) {
  showConfirmDialog('Are you sure you want to delete this payment method?', async () => {
    showLoading();
    try {
      const { error } = await supabaseClient
        .from('payment_methods')
        .delete()
        .eq('id', methodId);

      if (error) throw error;

      showNotification('Payment method deleted successfully', 'success');
      await loadPaymentMethods();
    } catch (error) {
      console.error('Error deleting payment method:', error);
      showNotification('Error deleting payment method', 'error');
    } finally {
      hideLoading();
    }
  });
}

// KYC Management Functions
async function loadKyc() {
  try {
    const { data, error } = await supabaseClient
      .from('kyc_documents')
      .select(`
        *,
        user_profiles (username, display_name)
      `)
      .order('submitted_at', { ascending: false });

    if (error) throw error;

    const tbody = document.getElementById('kyc-table');
    
    if (data && data.length > 0) {
      tbody.innerHTML = data.map(kyc => `
        <tr>
          <td>
            ${kyc.user_profiles ? 
              `${kyc.user_profiles.display_name || kyc.user_profiles.username || 'N/A'}` : 
              'N/A'
            }
          </td>
          <td class="font-semibold">${kyc.full_name}</td>
          <td>
            <span class="badge badge-info">
              ${kyc.id_type.toUpperCase()}
            </span>
          </td>
          <td class="font-share-tech text-sm">${kyc.id_number}</td>
          <td>${new Date(kyc.submitted_at).toLocaleDateString()}</td>
          <td>
            <span class="badge badge-${kyc.status}">
              ${kyc.status.toUpperCase()}
            </span>
          </td>
          <td>
            <div class="flex space-x-2">
              <button onclick="viewKycDetails('${kyc.id}')" class="admin-btn btn-sm">
                <i class="fas fa-eye"></i>
              </button>
              ${kyc.status === 'pending' ? `
                <button onclick="approveKyc('${kyc.id}')" class="admin-btn btn-success btn-sm">
                  <i class="fas fa-check"></i>
                </button>
                <button onclick="rejectKyc('${kyc.id}')" class="admin-btn btn-danger btn-sm">
                  <i class="fas fa-times"></i>
                </button>
              ` : ''}
            </div>
          </td>
        </tr>
      `).join('');
    } else {
      tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-400">No KYC submissions found</td></tr>';
    }
    
  } catch (error) {
    console.error('Error loading KYC:', error);
    showNotification('Error loading KYC submissions', 'error');
  }
}

async function viewKycDetails(kycId) {
  try {
    const { data, error } = await supabaseClient
      .from('kyc_documents')
      .select(`
        *,
        user_profiles (username, display_name, profile_picture)
      `)
      .eq('id', kycId)
      .single();

    if (error) throw error;

    const modalContent = document.getElementById('kyc-modal-content');
    modalContent.innerHTML = `
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h4 class="text-lg font-bold mb-4 text-purple-400">User Information</h4>
          <div class="space-y-3">
            <div class="flex items-center space-x-3">
              <img src="${data.user_profiles?.profile_picture || '/placeholder.svg?height=50&width=50'}" 
                   alt="Profile" class="w-12 h-12 rounded-full object-cover">
              <div>
                <p class="font-semibold">${data.user_profiles?.display_name || 'N/A'}</p>
                <p class="text-gray-400 text-sm">@${data.user_profiles?.username || 'N/A'}</p>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-400">Full Name</label>
              <p class="font-semibold">${data.full_name}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-400">ID Type</label>
              <p class="font-semibold">${data.id_type.toUpperCase()}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-400">ID Number</label>
              <p class="font-semibold font-share-tech">${data.id_number}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-400">Additional Info</label>
              <p class="text-sm">${data.additional_info || 'None'}</p>
            </div>
          </div>
        </div>
        <div>
          <h4 class="text-lg font-bold mb-4 text-purple-400">Documents</h4>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">Front Image</label>
              <img src="${data.front_image}" alt="ID Front" class="w-full h-32 object-cover rounded border">
            </div>
            ${data.back_image ? `
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Back Image</label>
                <img src="${data.back_image}" alt="ID Back" class="w-full h-32 object-cover rounded border">
              </div>
            ` : ''}
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">Selfie Image</label>
              <img src="${data.selfie_image}" alt="Selfie" class="w-full h-32 object-cover rounded border">
            </div>
          </div>
        </div>
      </div>
      ${data.status === 'pending' ? `
        <div class="mt-6 pt-6 border-t border-gray-600">
          <h4 class="text-lg font-bold mb-4 text-purple-400">Actions</h4>
          <div class="flex space-x-4">
            <button onclick="approveKyc('${data.id}'); closeKycModal();" class="admin-btn btn-success flex-1">
              <i class="fas fa-check mr-2"></i>APPROVE KYC
            </button>
            <button onclick="rejectKyc('${data.id}'); closeKycModal();" class="admin-btn btn-danger flex-1">
              <i class="fas fa-times mr-2"></i>REJECT KYC
            </button>
          </div>
        </div>
      ` : `
        <div class="mt-6 pt-6 border-t border-gray-600">
          <div class="flex items-center justify-between">
            <span class="text-gray-400">Status:</span>
            <span class="badge badge-${data.status} text-lg">
              ${data.status.toUpperCase()}
            </span>
          </div>
          ${data.reviewer_notes ? `
            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-400">Reviewer Notes</label>
              <p class="text-sm bg-gray-800 p-3 rounded mt-1">${data.reviewer_notes}</p>
            </div>
          ` : ''}
        </div>
      `}
    `;

    document.getElementById('kyc-modal').classList.remove('hidden');
    
  } catch (error) {
    console.error('Error loading KYC details:', error);
    showNotification('Error loading KYC details', 'error');
  }
}

function closeKycModal() {
  document.getElementById('kyc-modal').classList.add('hidden');
}

async function approveKyc(kycId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('kyc_documents')
      .update({ 
        status: 'approved',
        reviewed_at: new Date().toISOString(),
        reviewer_notes: 'Approved by admin'
      })
      .eq('id', kycId);

    if (error) throw error;

    showNotification('KYC approved successfully', 'success');
    await loadKyc();
    await loadStats();
  } catch (error) {
    console.error('Error approving KYC:', error);
    showNotification('Error approving KYC', 'error');
  } finally {
    hideLoading();
  }
}

async function rejectKyc(kycId) {
  const reason = prompt('Please enter rejection reason:');
  if (!reason) return;
  
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('kyc_documents')
      .update({ 
        status: 'rejected',
        reviewed_at: new Date().toISOString(),
        reviewer_notes: reason
      })
      .eq('id', kycId);

    if (error) throw error;

    showNotification('KYC rejected successfully', 'success');
    await loadKyc();
    await loadStats();
  } catch (error) {
    console.error('Error rejecting KYC:', error);
    showNotification('Error rejecting KYC', 'error');
  } finally {
    hideLoading();
  }
}

// Support Management Functions
async function loadSupport() {
  try {
    const { data, error } = await supabaseClient
      .from('support_messages')
      .select(`
        *,
        user_profiles (username, display_name)
      `)
      .order('created_at', { ascending: false });

    if (error) throw error;

    const tbody = document.getElementById('support-table');
    
    if (data && data.length > 0) {
      tbody.innerHTML = data.map(support => `
        <tr>
          <td>
            ${support.user_profiles ? 
              `${support.user_profiles.display_name || support.user_profiles.username || 'N/A'}` : 
              'N/A'
            }
          </td>
          <td class="font-semibold">${support.subject || 'No Subject'}</td>
          <td class="max-w-xs truncate">${support.message}</td>
          <td>
            <span class="badge badge-${support.status === 'open' ? 'pending' : support.status === 'closed' ? 'inactive' : 'info'}">
              ${support.status.toUpperCase()}
            </span>
          </td>
          <td>${new Date(support.created_at).toLocaleDateString()}</td>
          <td>
            <div class="flex space-x-2">
              ${support.status === 'open' ? 
                `<button onclick="closeSupportMessage('${support.id}')" class="admin-btn btn-success btn-sm">
                  <i class="fas fa-check"></i>
                </button>` : 
                `<button onclick="reopenSupportMessage('${support.id}')" class="admin-btn btn-warning btn-sm">
                  <i class="fas fa-redo"></i>
                </button>`
              }
              <button onclick="deleteSupportMessage('${support.id}')" class="admin-btn btn-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    } else {
      tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-400">No support messages found</td></tr>';
    }
    
  } catch (error) {
    console.error('Error loading support messages:', error);
    showNotification('Error loading support messages', 'error');
  }
}

async function closeSupportMessage(messageId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('support_messages')
      .update({ 
        status: 'closed',
        updated_at: new Date().toISOString()
      })
      .eq('id', messageId);

    if (error) throw error;

    showNotification('Support message closed successfully', 'success');
    await loadSupport();
    await loadStats();
  } catch (error) {
    console.error('Error closing support message:', error);
    showNotification('Error closing support message', 'error');
  } finally {
    hideLoading();
  }
}

async function reopenSupportMessage(messageId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('support_messages')
      .update({ 
        status: 'open',
        updated_at: new Date().toISOString()
      })
      .eq('id', messageId);

    if (error) throw error;

    showNotification('Support message reopened successfully', 'success');
    await loadSupport();
    await loadStats();
  } catch (error) {
    console.error('Error reopening support message:', error);
    showNotification('Error reopening support message', 'error');
  } finally {
    hideLoading();
  }
}

async function deleteSupportMessage(messageId) {
  showConfirmDialog('Are you sure you want to delete this support message?', async () => {
    showLoading();
    try {
      const { error } = await supabaseClient
        .from('support_messages')
        .delete()
        .eq('id', messageId);

      if (error) throw error;

      showNotification('Support message deleted successfully', 'success');
      await loadSupport();
      await loadStats();
    } catch (error) {
      console.error('Error deleting support message:', error);
      showNotification('Error deleting support message', 'error');
    } finally {
      hideLoading();
    }
  });
}

// User Products Management Functions
async function loadUserProducts() {
  try {
    const { data, error } = await supabaseClient
      .from('user_products')
      .select(`
        *,
        user_profiles (username, display_name)
      `)
      .order('created_at', { ascending: false });

    if (error) throw error;

    const tbody = document.getElementById('user-products-table');
    
    if (data && data.length > 0) {
      tbody.innerHTML = data.map(product => `
        <tr>
          <td>
            ${product.user_profiles ? 
              `${product.user_profiles.display_name || product.user_profiles.username || 'N/A'}` : 
              'N/A'
            }
          </td>
          <td class="font-semibold">${product.product_name}</td>
          <td class="font-semibold">${product.price} MMK</td>
          <td>${product.category || 'N/A'}</td>
          <td>
            <span class="badge badge-${product.status}">
              ${product.status.toUpperCase()}
            </span>
          </td>
          <td>${new Date(product.created_at).toLocaleDateString()}</td>
          <td>
            <div class="flex space-x-2">
              ${product.status === 'pending' ? `
                <button onclick="approveUserProduct('${product.id}')" class="admin-btn btn-success btn-sm">
                  <i class="fas fa-check"></i>
                </button>
                <button onclick="rejectUserProduct('${product.id}')" class="admin-btn btn-danger btn-sm">
                  <i class="fas fa-times"></i>
                </button>
              ` : ''}
              <button onclick="deleteUserProduct('${product.id}')" class="admin-btn btn-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    } else {
      tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-400">No user products found</td></tr>';
    }
    
  } catch (error) {
    console.error('Error loading user products:', error);
    showNotification('Error loading user products', 'error');
  }
}

async function approveUserProduct(productId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('user_products')
      .update({ 
        status: 'approved',
        approved_at: new Date().toISOString()
      })
      .eq('id', productId);

    if (error) throw error;

    showNotification('User product approved successfully', 'success');
    await loadUserProducts();
    await loadStats();
  } catch (error) {
    console.error('Error approving user product:', error);
    showNotification('Error approving user product', 'error');
  } finally {
    hideLoading();
  }
}

async function rejectUserProduct(productId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('user_products')
      .update({ status: 'rejected' })
      .eq('id', productId);

    if (error) throw error;

    showNotification('User product rejected successfully', 'success');
    await loadUserProducts();
    await loadStats();
  } catch (error) {
    console.error('Error rejecting user product:', error);
    showNotification('Error rejecting user product', 'error');
  } finally {
    hideLoading();
  }
}

async function deleteUserProduct(productId) {
  showConfirmDialog('Are you sure you want to delete this user product?', async () => {
    showLoading();
    try {
      const { error } = await supabaseClient
        .from('user_products')
        .delete()
        .eq('id', productId);

      if (error) throw error;

      showNotification('User product deleted successfully', 'success');
      await loadUserProducts();
      await loadStats();
    } catch (error) {
      console.error('Error deleting user product:', error);
      showNotification('Error deleting user product', 'error');
    } finally {
      hideLoading();
    }
  });
}

// Orders Management Functions
async function loadOrders() {
  try {
    const { data, error } = await supabaseClient
      .from('orders')
      .select(`
        *,
        buyer:user_profiles!buyer_id (username, display_name),
        seller:user_profiles!seller_id (username, display_name),
        admin_products (product_name),
        user_products (product_name)
      `)
      .order('created_at', { ascending: false });

    if (error) throw error;

    const tbody = document.getElementById('orders-table');
    
    if (data && data.length > 0) {
      tbody.innerHTML = data.map(order => `
        <tr>
          <td class="font-share-tech text-sm">${order.order_number}</td>
          <td>
            ${order.buyer ? 
              `${order.buyer.display_name || order.buyer.username || 'N/A'}` : 
              'N/A'
            }
          </td>
          <td>
            <span class="badge badge-${order.order_type === 'admin_product' ? 'info' : 'warning'}">
              ${order.order_type === 'admin_product' ? 'ADMIN' : 'USER'}
            </span>
          </td>
          <td class="font-semibold">${order.amount} MMK</td>
          <td>
            <span class="badge badge-${order.status}">
              ${order.status.toUpperCase()}
            </span>
          </td>
          <td>${new Date(order.created_at).toLocaleDateString()}</td>
          <td>
            <div class="flex space-x-2">
              ${order.status === 'pending' ? `
                <button onclick="approveOrder('${order.id}')" class="admin-btn btn-success btn-sm">
                  <i class="fas fa-check"></i>
                </button>
                <button onclick="rejectOrder('${order.id}')" class="admin-btn btn-danger btn-sm">
                  <i class="fas fa-times"></i>
                </button>
              ` : ''}
              ${order.receipt_image ? `
                <button onclick="viewReceipt('${order.receipt_image}')" class="admin-btn btn-sm">
                  <i class="fas fa-receipt"></i>
                </button>
              ` : ''}
            </div>
          </td>
        </tr>
      `).join('');
    } else {
      tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-400">No orders found</td></tr>';
    }
    
  } catch (error) {
    console.error('Error loading orders:', error);
    showNotification('Error loading orders', 'error');
  }
}

async function approveOrder(orderId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('orders')
      .update({ 
        status: 'approved',
        approved_at: new Date().toISOString()
      })
      .eq('id', orderId);

    if (error) throw error;

    showNotification('Order approved successfully', 'success');
    await loadOrders();
    await loadStats();
  } catch (error) {
    console.error('Error approving order:', error);
    showNotification('Error approving order', 'error');
  } finally {
    hideLoading();
  }
}

async function rejectOrder(orderId) {
  showLoading();
  try {
    const { error } = await supabaseClient
      .from('orders')
      .update({ status: 'rejected' })
      .eq('id', orderId);

    if (error) throw error;

    showNotification('Order rejected successfully', 'success');
    await loadOrders();
    await loadStats();
  } catch (error) {
    console.error('Error rejecting order:', error);
    showNotification('Error rejecting order', 'error');
  } finally {
    hideLoading();
  }
}

function viewReceipt(receiptUrl) {
  window.open(receiptUrl, '_blank');
}

// Utility Functions
function showConfirmDialog(message, callback) {
  document.getElementById('confirm-message').textContent = message;
  confirmCallback = callback;
  document.getElementById('confirm-modal').classList.remove('hidden');
}

function closeConfirmModal() {
  document.getElementById('confirm-modal').classList.add('hidden');
  confirmCallback = null;
}

function confirmAction() {
  if (confirmCallback) {
    confirmCallback();
  }
  closeConfirmModal();
}

// Add custom styles for smaller buttons
const style = document.createElement('style');
style.textContent = `
  .btn-sm {
    padding: 4px 8px !important;
    font-size: 11px !important;
  }
`;
document.head.appendChild(style);
</script>

</body>
</html>
