<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMR GAMING SHOP - Admin Dashboard</title>
    
    <!-- CDN Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --accent-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --dark-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-neon: 0 0 30px rgba(102, 126, 234, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Myanmar', 'Orbitron', sans-serif;
            background: var(--dark-gradient);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Glass Morphism Effects */
        .glass-morphism {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
        }

        .glass-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* Loading Animation */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
        }

        .loading-text {
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 20px rgba(102, 126, 234, 0.8);
            margin-bottom: 2rem;
        }

        .loading-letter {
            display: inline-block;
            opacity: 0;
            transform: translateY(50px) rotateX(90deg);
            animation: letterAppear 0.8s ease-out forwards;
            position: relative;
        }

        .loading-letter::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            animation: shimmer 2s infinite;
        }

        @keyframes letterAppear {
            0% {
                opacity: 0;
                transform: translateY(50px) rotateX(90deg);
            }
            50% {
                opacity: 0.5;
                transform: translateY(25px) rotateX(45deg);
            }
            100% {
                opacity: 1;
                transform: translateY(0) rotateX(0deg);
            }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }

        /* Premium Buttons */
        .btn-premium {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(45deg, rgba(255, 255, 255, 0.2), transparent);
            transition: width 0.5s ease;
        }

        .btn-premium:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 20px 50px rgba(102, 126, 234, 0.6);
        }

        .btn-premium:hover::before {
            width: 100%;
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff4757, #ff3838);
            box-shadow: 0 10px 30px rgba(255, 71, 87, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #2ed573, #1abc9c);
            box-shadow: 0 10px 30px rgba(46, 213, 115, 0.4);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffa502, #ff6348);
            box-shadow: 0 10px 30px rgba(255, 165, 2, 0.4);
        }

        /* Modern Form Styles */
        .form-control-modern {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .form-control-modern:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .form-control-modern::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-control-dark {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control-dark:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(0, 0, 0, 0.4);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        /* Sidebar Modern */
        .sidebar-modern {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(30px);
            transition: all 0.5s cubic-bezier(0.23, 1, 0.320, 1);
            z-index: 998;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateX(-100%);
        }

        .sidebar-modern.active {
            transform: translateX(0);
        }

        .sidebar-item-modern {
            display: flex;
            align-items: center;
            padding: 20px 24px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 16px;
            margin: 8px 16px;
            position: relative;
            overflow: hidden;
        }

        .sidebar-item-modern::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            z-index: -1;
        }

        .sidebar-item-modern:hover,
        .sidebar-item-modern.active {
            color: white;
            transform: translateX(8px);
        }

        .sidebar-item-modern:hover::before,
        .sidebar-item-modern.active::before {
            width: 100%;
        }

        /* Modal Modern */
        .modal-modern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-modern.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content-modern {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 32px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.8) translateY(50px);
            transition: transform 0.3s ease;
        }

        .modal-modern.active .modal-content-modern {
            transform: scale(1) translateY(0);
        }

        /* Stat Cards */
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 32px;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-12px) scale(1.05);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card > * {
            position: relative;
            z-index: 2;
        }

        /* Table Styles */
        .table-modern {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            overflow: hidden;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-modern thead {
            background: rgba(102, 126, 234, 0.2);
        }

        .table-modern th,
        .table-modern td {
            padding: 20px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        .table-modern th {
            font-weight: 700;
            color: #667eea;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .table-modern tbody tr {
            transition: all 0.3s ease;
        }

        .table-modern tbody tr:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        /* Status Badges */
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(255, 165, 2, 0.2);
            color: #ffa502;
            border: 1px solid rgba(255, 165, 2, 0.3);
        }

        .status-approved {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            border: 1px solid rgba(46, 213, 115, 0.3);
        }

        .status-rejected {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        /* Neon Text Effect */
        .neon-text {
            color: #fff;
            text-shadow: 
                0 0 5px #667eea,
                0 0 10px #667eea,
                0 0 15px #667eea,
                0 0 20px #667eea,
                0 0 35px #667eea,
                0 0 40px #667eea;
            animation: neonGlow 2s ease-in-out infinite alternate;
        }

        @keyframes neonGlow {
            from {
                text-shadow: 
                    0 0 5px #667eea,
                    0 0 10px #667eea,
                    0 0 15px #667eea,
                    0 0 20px #667eea,
                    0 0 35px #667eea,
                    0 0 40px #667eea;
            }
            to {
                text-shadow: 
                    0 0 2px #667eea,
                    0 0 5px #667eea,
                    0 0 8px #667eea,
                    0 0 12px #667eea,
                    0 0 20px #667eea,
                    0 0 25px #667eea;
            }
        }

        /* Floating Animation */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* Notification */
        .notification-modern {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 9999;
            padding: 20px 30px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: slideInRight 0.5s cubic-bezier(0.23, 1, 0.320, 1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .notification-success { background: linear-gradient(45deg, #2ed573, #1abc9c); }
        .notification-error { background: linear-gradient(45deg, #ff4757, #ff3838); }
        .notification-warning { background: linear-gradient(45deg, #ffa502, #ff6348); }
        .notification-info { background: linear-gradient(45deg, #3742fa, #2f3542); }

        @keyframes slideInRight {
            from { 
                transform: translateX(400px) rotateY(30deg);
                opacity: 0;
            }
            to { 
                transform: translateX(0) rotateY(0deg);
                opacity: 1;
            }
        }

        /* Login Page Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--dark-gradient);
            padding: 2rem;
        }

        .login-card {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 32px;
            padding: 48px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
        }

        /* Dashboard Layout */
        .dashboard-layout {
            display: flex;
            min-height: 100vh;
        }

        .main-content {
            flex: 1;
            margin-left: 0;
            padding: 2rem;
            transition: margin-left 0.3s ease;
        }

        .main-content.sidebar-open {
            margin-left: 280px;
        }

        /* Header */
        .header-modern {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 20px 32px;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: between;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar-modern {
                width: 100%;
                transform: translateX(-100%);
            }
            
            .main-content.sidebar-open {
                margin-left: 0;
            }
            
            .modal-content-modern {
                width: 95%;
                padding: 24px;
            }

            .stat-card {
                padding: 24px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.8s ease-out; }
        .slide-up { animation: slideUp 0.6s ease-out; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-container">
        <div class="loading-text">
            <span class="loading-letter" style="animation-delay: 0.1s;">A</span>
            <span class="loading-letter" style="animation-delay: 0.2s;">D</span>
            <span class="loading-letter" style="animation-delay: 0.3s;">M</span>
            <span class="loading-letter" style="animation-delay: 0.4s;">I</span>
            <span class="loading-letter" style="animation-delay: 0.5s;">N</span>
        </div>
        <div class="text-white text-opacity-60 text-xl">MMR Gaming Shop Dashboard</div>
    </div>

    <!-- Main App -->
    <div id="app" class="min-h-screen">
        <!-- Login Page -->
        <div id="loginPage" class="login-container">
            <div class="login-card fade-in floating">
                <div class="text-center mb-12">
                    <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-6">
                        <i class="fas fa-shield-alt text-white text-3xl"></i>
                    </div>
                    <h1 class="text-4xl font-bold neon-text mb-4">MMR GAMING</h1>
                    <p class="text-white text-opacity-80 text-xl">Admin Dashboard</p>
                    <div class="w-20 h-1 bg-gradient-to-r from-blue-500 to-purple-500 mx-auto mt-4 rounded-full"></div>
                </div>
                
                <form id="adminLoginForm" class="space-y-8">
                    <div class="form-group">
                        <label class="block text-white text-opacity-90 font-semibold mb-4 text-lg">
                            <i class="fas fa-envelope mr-3"></i>Admin Email
                        </label>
                        <input type="email" id="adminEmail" required 
                               class="form-control-modern"
                               placeholder="admin@mmrgamingshop.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="block text-white text-opacity-90 font-semibold mb-4 text-lg">
                            <i class="fas fa-lock mr-3"></i>Password
                        </label>
                        <input type="password" id="adminPassword" required 
                               class="form-control-modern"
                               placeholder="••••••••">
                    </div>
                    
                    <button type="submit" class="btn-premium w-full text-xl py-4">
                        <span id="loginBtnText">
                            <i class="fas fa-sign-in-alt mr-3"></i>
                            Login to Dashboard
                        </span>
                        <i id="loginLoader" class="fas fa-spinner fa-spin hidden ml-3"></i>
                    </button>
                </form>
                
                <div class="text-center mt-8">
                    <p class="text-white text-opacity-60 text-sm">
                        © 2024 MMR Gaming Shop. All rights reserved.
                    </p>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboardPage" class="dashboard-layout hidden">
            <!-- Sidebar -->
            <aside class="sidebar-modern" id="sidebar">
                <div class="p-8">
                    <div class="text-center mb-12">
                        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4">
                            <i class="fas fa-gamepad text-white text-2xl"></i>
                        </div>
                        <h2 class="text-white font-bold text-xl">MMR GAMING</h2>
                        <p class="text-blue-300 text-sm">Admin Panel</p>
                    </div>
                    
                    <nav class="space-y-2">
                        <a href="#" class="sidebar-item-modern active" data-page="dashboard">
                            <i class="fas fa-tachometer-alt w-6 text-xl mr-4"></i>
                            <span class="text-lg">Dashboard</span>
                        </a>
                        <a href="#" class="sidebar-item-modern" data-page="users">
                            <i class="fas fa-users w-6 text-xl mr-4"></i>
                            <span class="text-lg">Users</span>
                        </a>
                        <a href="#" class="sidebar-item-modern" data-page="products">
                            <i class="fas fa-box w-6 text-xl mr-4"></i>
                            <span class="text-lg">Products</span>
                        </a>
                        <a href="#" class="sidebar-item-modern" data-page="orders">
                            <i class="fas fa-shopping-cart w-6 text-xl mr-4"></i>
                            <span class="text-lg">Orders</span>
                        </a>
                        <a href="#" class="sidebar-item-modern" data-page="payments">
                            <i class="fas fa-credit-card w-6 text-xl mr-4"></i>
                            <span class="text-lg">Payments</span>
                        </a>
                        <a href="#" class="sidebar-item-modern" data-page="kyc">
                            <i class="fas fa-id-card w-6 text-xl mr-4"></i>
                            <span class="text-lg">KYC Verification</span>
                        </a>
                        <a href="#" class="sidebar-item-modern" data-page="news">
                            <i class="fas fa-newspaper w-6 text-xl mr-4"></i>
                            <span class="text-lg">News</span>
                        </a>
                        <a href="#" class="sidebar-item-modern" data-page="about">
                            <i class="fas fa-info-circle w-6 text-xl mr-4"></i>
                            <span class="text-lg">About</span>
                        </a>
                    </nav>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content" id="mainContent">
                <!-- Header -->
                <header class="header-modern flex items-center justify-between">
                    <div class="flex items-center space-x-6">
                        <button id="menuToggle" class="text-white hover:text-blue-300 transition-colors">
                            <i class="fas fa-bars text-2xl"></i>
                        </button>
                        <h1 class="text-2xl font-bold text-white neon-text">Admin Dashboard</h1>
                    </div>
                    
                    <div class="flex items-center space-x-6">
                        <div class="hidden sm:flex items-center space-x-3">
                            <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                            <span class="text-white text-opacity-80 font-medium">Online</span>
                        </div>
                        <div class="text-right hidden sm:block">
                            <p class="text-white font-semibold" id="adminName">Admin</p>
                            <p class="text-white text-opacity-60 text-sm">Super Administrator</p>
                        </div>
                        <button id="logoutBtn" class="btn-danger px-6 py-3 text-white rounded-2xl font-medium">
                            <i class="fas fa-sign-out-alt mr-2"></i>
                            <span class="hidden sm:inline">Logout</span>
                        </button>
                    </div>
                </header>

                <!-- Dashboard Overview -->
                <div id="dashboardContent" class="page-content fade-in">
                    <div class="mb-12">
                        <h2 class="text-4xl font-bold text-white mb-4 neon-text">Welcome Back!</h2>
                        <p class="text-white text-opacity-70 text-xl">Here's what's happening with MMR Gaming Shop today.</p>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
                        <div class="stat-card slide-up" style="animation-delay: 0.1s;">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <p class="text-white text-opacity-60 text-sm font-semibold mb-2">TOTAL USERS</p>
                                    <p id="totalUsers" class="text-4xl font-bold text-white">0</p>
                                    <p class="text-green-400 text-sm mt-2">
                                        <i class="fas fa-arrow-up mr-1"></i>
                                        <span>+12% from last month</span>
                                    </p>
                                </div>
                                <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center">
                                    <i class="fas fa-users text-white text-2xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card slide-up" style="animation-delay: 0.2s;">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <p class="text-white text-opacity-60 text-sm font-semibold mb-2">TOTAL PRODUCTS</p>
                                    <p id="totalProducts" class="text-4xl font-bold text-white">0</p>
                                    <p class="text-green-400 text-sm mt-2">
                                        <i class="fas fa-arrow-up mr-1"></i>
                                        <span>+8% from last month</span>
                                    </p>
                                </div>
                                <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl flex items-center justify-center">
                                    <i class="fas fa-box text-white text-2xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card slide-up" style="animation-delay: 0.3s;">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <p class="text-white text-opacity-60 text-sm font-semibold mb-2">TOTAL ORDERS</p>
                                    <p id="totalOrders" class="text-4xl font-bold text-white">0</p>
                                    <p class="text-green-400 text-sm mt-2">
                                        <i class="fas fa-arrow-up mr-1"></i>
                                        <span>+25% from last month</span>
                                    </p>
                                </div>
                                <div class="w-16 h-16 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-2xl flex items-center justify-center">
                                    <i class="fas fa-shopping-cart text-white text-2xl"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card slide-up" style="animation-delay: 0.4s;">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <p class="text-white text-opacity-60 text-sm font-semibold mb-2">PENDING KYC</p>
                                    <p id="pendingKyc" class="text-4xl font-bold text-white">0</p>
                                    <p class="text-orange-400 text-sm mt-2">
                                        <i class="fas fa-clock mr-1"></i>
                                        <span>Needs attention</span>
                                    </p>
                                </div>
                                <div class="w-16 h-16 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center">
                                    <i class="fas fa-id-card text-white text-2xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts and Recent Activity -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="glass-card p-8 slide-up" style="animation-delay: 0.5s;">
                            <h3 class="text-2xl font-bold text-white mb-8">Recent Orders</h3>
                            <div id="recentOrders" class="space-y-4">
                                <!-- Recent orders will be populated here -->
                            </div>
                        </div>
                        
                        <div class="glass-card p-8 slide-up" style="animation-delay: 0.6s;">
                            <h3 class="text-2xl font-bold text-white mb-8">Sales Overview</h3>
                            <div style="height: 300px;">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Management -->
                <div id="usersContent" class="page-content hidden">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2 neon-text">Users Management</h2>
                            <p class="text-white text-opacity-70 text-lg">Manage all users and their activities</p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 mt-6 md:mt-0">
                            <input type="text" id="userSearchInput" placeholder="Search users..." 
                                   class="form-control-dark px-6 py-3 w-full sm:w-64">
                            <button id="refreshUsersBtn" class="btn-premium px-8 py-3">
                                <i class="fas fa-refresh mr-2"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="glass-card p-6 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="table-modern">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Email</th>
                                        <th>Username</th>
                                        <th>KYC Status</th>
                                        <th>Status</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Users will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Products Management -->
                <div id="productsContent" class="page-content hidden">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2 neon-text">Products Management</h2>
                            <p class="text-white text-opacity-70 text-lg">Manage all products and approvals</p>
                        </div>
                        <button id="addProductBtn" class="btn-premium px-8 py-3 mt-6 md:mt-0">
                            <i class="fas fa-plus mr-2"></i>
                            Add Product
                        </button>
                    </div>
                    
                    <div class="glass-card p-6">
                        <div class="overflow-x-auto">
                            <table class="table-modern">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Type</th>
                                        <th>Price</th>
                                        <th>Seller</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTableBody">
                                    <!-- Products will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Orders Management -->
                <div id="ordersContent" class="page-content hidden">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2 neon-text">Orders Management</h2>
                            <p class="text-white text-opacity-70 text-lg">Manage all orders and transactions</p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 mt-6 md:mt-0">
                            <select id="orderStatusFilter" class="form-control-dark px-6 py-3">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <button id="refreshOrdersBtn" class="btn-premium px-8 py-3">
                                <i class="fas fa-refresh mr-2"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="glass-card p-6">
                        <div class="overflow-x-auto">
                            <table class="table-modern">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Buyer</th>
                                        <th>Product</th>
                                        <th>Amount</th>
                                        <th>Payment</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTableBody">
                                    <!-- Orders will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Payment Methods Management -->
                <div id="paymentsContent" class="page-content hidden">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2 neon-text">Payment Methods</h2>
                            <p class="text-white text-opacity-70 text-lg">Manage payment methods and settings</p>
                        </div>
                        <button id="addPaymentBtn" class="btn-premium px-8 py-3 mt-6 md:mt-0">
                            <i class="fas fa-plus mr-2"></i>
                            Add Payment Method
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="paymentMethodsGrid">
                        <!-- Payment methods will be populated here -->
                    </div>
                </div>

                <!-- KYC Verification -->
                <div id="kycContent" class="page-content hidden">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2 neon-text">KYC Verification</h2>
                            <p class="text-white text-opacity-70 text-lg">Review and approve KYC applications</p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 mt-6 md:mt-0">
                            <select id="kycStatusFilter" class="form-control-dark px-6 py-3">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <button id="refreshKycBtn" class="btn-premium px-8 py-3">
                                <i class="fas fa-refresh mr-2"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="glass-card p-6">
                        <div class="overflow-x-auto">
                            <table class="table-modern">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Full Name</th>
                                        <th>Document Type</th>
                                        <th>Status</th>
                                        <th>Submitted</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="kycTableBody">
                                    <!-- KYC records will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- News Management -->
                <div id="newsContent" class="page-content hidden">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2 neon-text">News Management</h2>
                            <p class="text-white text-opacity-70 text-lg">Create and manage news articles</p>
                        </div>
                        <button id="addNewsBtn" class="btn-premium px-8 py-3 mt-6 md:mt-0">
                            <i class="fas fa-plus mr-2"></i>
                            Add News
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="newsGrid">
                        <!-- News items will be populated here -->
                    </div>
                </div>

                <!-- About Management -->
                <div id="aboutContent" class="page-content hidden">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-white mb-2 neon-text">About Page Management</h2>
                        <p class="text-white text-opacity-70 text-lg">Manage about page content and contact information</p>
                    </div>
                    
                    <div class="glass-card p-8">
                        <form id="aboutForm" class="space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-white font-semibold mb-4 text-lg">Company Name</label>
                                    <input type="text" id="companyName" class="form-control-dark" value="MMR GAMING SHOP">
                                </div>
                                <div>
                                    <label class="block text-white font-semibold mb-4 text-lg">Email</label>
                                    <input type="email" id="companyEmail" class="form-control-dark" placeholder="contact@mmrgamingshop.com">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-white font-semibold mb-4 text-lg">Description</label>
                                <textarea id="companyDescription" rows="6" class="form-control-dark" placeholder="Enter company description..."></textarea>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-white font-semibold mb-4 text-lg">Phone Number</label>
                                    <input type="tel" id="companyPhone" class="form-control-dark" placeholder="+95 xxx xxx xxxx">
                                </div>
                                <div>
                                    <label class="block text-white font-semibold mb-4 text-lg">Address</label>
                                    <input type="text" id="companyAddress" class="form-control-dark" placeholder="Company address">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-white font-semibold mb-4 text-lg">Telegram</label>
                                    <input type="url" id="telegramLink" class="form-control-dark" placeholder="https://t.me/...">
                                </div>
                                <div>
                                    <label class="block text-white font-semibold mb-4 text-lg">YouTube</label>
                                    <input type="url" id="youtubeLink" class="form-control-dark" placeholder="https://youtube.com/...">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-white font-semibold mb-4 text-lg">Viber</label>
                                    <input type="url" id="viberLink" class="form-control-dark" placeholder="viber://...">
                                </div>
                                <div>
                                    <label class="block text-white font-semibold mb-4 text-lg">WeChat</label>
                                    <input type="url" id="wechatLink" class="form-control-dark" placeholder="weixin://...">
                                </div>
                            </div>
                            
                            <button type="submit" class="btn-premium px-12 py-4 text-xl">
                                <i class="fas fa-save mr-3"></i>
                                Save Changes
                            </button>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal-modern">
        <div class="modal-content-modern">
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-3xl font-bold text-white neon-text">Add New Product</h3>
                <button class="modal-close text-white hover:text-red-300 transition-colors text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addProductForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-white font-semibold mb-3">Product Name</label>
                        <input type="text" name="name" required class="form-control-dark">
                    </div>
                    
                    <div>
                        <label class="block text-white font-semibold mb-3">Product Type</label>
                        <select name="product_type" id="productType" required class="form-control-dark">
                            <option value="">Select Type</option>
                            <option value="apk">APK Game</option>
                            <option value="game_account">Game Account</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">Price (MMK)</label>
                    <input type="number" name="price" required class="form-control-dark" min="0">
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">Description</label>
                    <textarea name="description" rows="4" class="form-control-dark"></textarea>
                </div>
                
                <!-- APK specific fields -->
                <div id="apkFields" class="hidden space-y-6">
                    <div>
                        <label class="block text-white font-semibold mb-3">APK File</label>
                        <input type="file" name="apk_file" accept=".apk" class="form-control-dark">
                    </div>
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">Product Icon</label>
                    <input type="file" name="icon_image" accept="image/*" class="form-control-dark">
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">Gallery Images</label>
                    <input type="file" name="gallery_images" accept="image/*" multiple class="form-control-dark">
                </div>
                
                <!-- Social Links -->
                <div class="border-t border-white border-opacity-20 pt-6">
                    <h4 class="text-xl font-semibold text-white mb-6">Social Links (Optional)</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-medium mb-2">Telegram</label>
                            <input type="url" name="telegram" class="form-control-dark" placeholder="https://t.me/...">
                        </div>
                        
                        <div>
                            <label class="block text-white font-medium mb-2">YouTube</label>
                            <input type="url" name="youtube" class="form-control-dark" placeholder="https://youtube.com/...">
                        </div>
                        
                        <div>
                            <label class="block text-white font-medium mb-2">Viber</label>
                            <input type="url" name="viber" class="form-control-dark" placeholder="viber://...">
                        </div>
                        
                        <div>
                            <label class="block text-white font-medium mb-2">WeChat</label>
                            <input type="url" name="wechat" class="form-control-dark" placeholder="weixin://...">
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-white border-opacity-20">
                    <button type="submit" class="btn-premium px-8 py-4">
                        <span id="addProductBtnText">
                            <i class="fas fa-plus mr-2"></i>
                            Add Product
                        </span>
                        <i id="addProductLoading" class="fas fa-spinner fa-spin hidden ml-2"></i>
                    </button>
                    <button type="button" class="modal-close px-8 py-4 bg-gray-600 text-white rounded-2xl font-medium hover:bg-gray-700">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Payment Method Modal -->
    <div id="addPaymentModal" class="modal-modern">
        <div class="modal-content-modern">
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-3xl font-bold text-white neon-text">Add Payment Method</h3>
                <button class="modal-close text-white hover:text-red-300 transition-colors text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addPaymentForm" class="space-y-6">
                <div>
                    <label class="block text-white font-semibold mb-3">Payment Method Name</label>
                    <input type="text" name="name" required class="form-control-dark" placeholder="KBZ Pay, Wave Money, etc.">
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">Account Number/Details</label>
                    <input type="text" name="details" required class="form-control-dark" placeholder="09xxxxxxxxx">
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">Description</label>
                    <textarea name="description" rows="3" class="form-control-dark" placeholder="Additional information..."></textarea>
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">QR Code Image</label>
                    <input type="file" name="qr_code" accept="image/*" required class="form-control-dark">
                </div>
                
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-white border-opacity-20">
                    <button type="submit" class="btn-premium px-8 py-4">
                        <span id="addPaymentBtnText">
                            <i class="fas fa-plus mr-2"></i>
                            Add Payment Method
                        </span>
                        <i id="addPaymentLoading" class="fas fa-spinner fa-spin hidden ml-2"></i>
                    </button>
                    <button type="button" class="modal-close px-8 py-4 bg-gray-600 text-white rounded-2xl font-medium hover:bg-gray-700">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add News Modal -->
    <div id="addNewsModal" class="modal-modern">
        <div class="modal-content-modern">
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-3xl font-bold text-white neon-text">Add News Article</h3>
                <button class="modal-close text-white hover:text-red-300 transition-colors text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addNewsForm" class="space-y-6">
                <div>
                    <label class="block text-white font-semibold mb-3">News Title</label>
                    <input type="text" name="title" required class="form-control-dark">
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">Content</label>
                    <textarea name="content" rows="6" required class="form-control-dark"></textarea>
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">Video (Max 50MB)</label>
                    <input type="file" name="video" accept="video/mp4" class="form-control-dark">
                    <p class="text-white text-opacity-60 text-sm mt-2">Optional: Upload MP4 video (Max 50MB)</p>
                </div>
                
                <div>
                    <label class="block text-white font-semibold mb-3">Images</label>
                    <input type="file" name="images" accept="image/*" multiple class="form-control-dark">
                </div>
                
                <!-- Social Links -->
                <div class="border-t border-white border-opacity-20 pt-6">
                    <h4 class="text-xl font-semibold text-white mb-6">Social Links (Optional)</h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-white font-medium mb-2">Telegram</label>
                            <input type="url" name="telegram" class="form-control-dark" placeholder="https://t.me/...">
                        </div>
                        
                        <div>
                            <label class="block text-white font-medium mb-2">YouTube</label>
                            <input type="url" name="youtube" class="form-control-dark" placeholder="https://youtube.com/...">
                        </div>
                        
                        <div>
                            <label class="block text-white font-medium mb-2">Viber</label>
                            <input type="url" name="viber" class="form-control-dark" placeholder="viber://...">
                        </div>
                        
                        <div>
                            <label class="block text-white font-medium mb-2">WeChat</label>
                            <input type="url" name="wechat" class="form-control-dark" placeholder="weixin://...">
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-white border-opacity-20">
                    <button type="submit" class="btn-premium px-8 py-4">
                        <span id="addNewsBtnText">
                            <i class="fas fa-plus mr-2"></i>
                            Publish News
                        </span>
                        <i id="addNewsLoading" class="fas fa-spinner fa-spin hidden ml-2"></i>
                    </button>
                    <button type="button" class="modal-close px-8 py-4 bg-gray-600 text-white rounded-2xl font-medium hover:bg-gray-700">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View KYC Modal -->
    <div id="viewKycModal" class="modal-modern">
        <div class="modal-content-modern max-w-4xl">
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-3xl font-bold text-white neon-text">KYC Details</h3>
                <button class="modal-close text-white hover:text-red-300 transition-colors text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="kycDetailsContent">
                <!-- KYC details will be populated here -->
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-white border-opacity-20">
                <button id="approveKycBtn" class="btn-success px-8 py-4">
                    <i class="fas fa-check mr-2"></i>
                    Approve KYC
                </button>
                <button id="rejectKycBtn" class="btn-danger px-8 py-4">
                    <i class="fas fa-times mr-2"></i>
                    Reject KYC
                </button>
                <button class="modal-close px-8 py-4 bg-gray-600 text-white rounded-2xl font-medium hover:bg-gray-700">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- View Order Modal -->
    <div id="viewOrderModal" class="modal-modern">
        <div class="modal-content-modern max-w-4xl">
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-3xl font-bold text-white neon-text">Order Details</h3>
                <button class="modal-close text-white hover:text-red-300 transition-colors text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="orderDetailsContent">
                <!-- Order details will be populated here -->
            </div>
            
            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 pt-6 border-t border-white border-opacity-20">
                <button id="approveOrderBtn" class="btn-success px-8 py-4">
                    <i class="fas fa-check mr-2"></i>
                    Approve Order
                </button>
                <button id="rejectOrderBtn" class="btn-danger px-8 py-4">
                    <i class="fas fa-times mr-2"></i>
                    Reject Order
                </button>
                <button class="modal-close px-8 py-4 bg-gray-600 text-white rounded-2xl font-medium hover:bg-gray-700">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const supabaseUrl = 'https://rliwdosxsbauwxkayjoa.supabase.co'; // Replace with your Supabase URL
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJsaXdkb3N4c2JhdXd4a2F5am9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMDA2NjIsImV4cCI6MjA2OTY3NjY2Mn0.uDvU9eX3Cy--D9l6daGaO2QMpn1YnxMJYVlbaeIgHu4'; // Replace with your Supabase anon key
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Global Variables
        let currentAdmin = null;
        let currentPage = 'dashboard';

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            // Show loading screen
            showLoading();

            // Check if admin is already logged in
            const adminSession = localStorage.getItem('adminSession');
            if (adminSession) {
                try {
                    const sessionData = JSON.parse(adminSession);
                    const admin = await verifyAdminSession(sessionData.token);
                    if (admin) {
                        currentAdmin = admin;
                        showDashboard();
                        return;
                    }
                } catch (error) {
                    console.error('Session verification failed:', error);
                    localStorage.removeItem('adminSession');
                }
            }

            // Show login page
            showLogin();
        }

        function showLoading() {
            document.getElementById('loadingScreen').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
            
            // Hide loading after 2 seconds
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
            }, 2000);
        }

        function showLogin() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            
            // Update admin info
            document.getElementById('adminName').textContent = currentAdmin.name;
            
            // Load dashboard data
            loadDashboardData();
            setupEventListeners();
        }

        // Admin Login
        document.getElementById('adminLoginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            const loginBtn = document.getElementById('loginBtnText');
            const loginLoader = document.getElementById('loginLoader');
            
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-3"></i>Logging in...';
            
            try {
                // Login admin
                const { data, error } = await supabase
                    .from('admins')
                    .select('*')
                    .eq('email', email)
                    .eq('password', password)
                    .eq('is_active', true)
                    .single();

                if (error || !data) {
                    throw new Error('Invalid credentials');
                }

                // Create admin session
                const sessionToken = await createAdminSession(data.id);
                
                // Store session
                localStorage.setItem('adminSession', JSON.stringify({
                    token: sessionToken,
                    admin: data,
                    expires: Date.now() + (7 * 24 * 60 * 60 * 1000) // 7 days
                }));

                currentAdmin = data;
                showNotification('Login successful!', 'success');
                showDashboard();

            } catch (error) {
                console.error('Login error:', error);
                showNotification('Login failed. Please check your credentials.', 'error');
            } finally {
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-3"></i>Login to Dashboard';
            }
        });

        // Create Admin Session
        async function createAdminSession(adminId) {
            const { data, error } = await supabase.rpc('create_admin_session', {
                admin_id: adminId
            });

            if (error) throw error;
            return data;
        }

        // Verify Admin Session
        async function verifyAdminSession(token) {
            const { data, error } = await supabase.rpc('get_admin_from_session', {
                token: token
            });

            if (error || !data) return null;
            
            // Get full admin details
            const { data: admin, error: adminError } = await supabase
                .from('admins')
                .select('*')
                .eq('id', data)
                .single();

            return adminError ? null : admin;
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Menu toggle
            document.getElementById('menuToggle').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.getElementById('mainContent');
                
                sidebar.classList.toggle('active');
                mainContent.classList.toggle('sidebar-open');
            });

            // Sidebar navigation
            document.querySelectorAll('.sidebar-item-modern').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Remove active class from all items
                    document.querySelectorAll('.sidebar-item-modern').forEach(i => i.classList.remove('active'));
                    
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    // Show corresponding page
                    const page = this.dataset.page;
                    showPage(page);
                });
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);

            // Modal close buttons
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal-modern').classList.remove('active');
                });
            });

            // Form submissions
            setupFormHandlers();
        }

        // Show Page
        function showPage(page) {
            // Hide all page contents
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Show selected page
            const pageContent = document.getElementById(page + 'Content');
            if (pageContent) {
                pageContent.classList.remove('hidden');
                currentPage = page;

                // Load page specific data
                switch(page) {
                    case 'dashboard':
                        loadDashboardData();
                        break;
                    case 'users':
                        loadUsers();
                        break;
                    case 'products':
                        loadProducts();
                        break;
                    case 'orders':
                        loadOrders();
                        break;
                    case 'payments':
                        loadPaymentMethods();
                        break;
                    case 'kyc':
                        loadKycApplications();
                        break;
                    case 'news':
                        loadNews();
                        break;
                    case 'about':
                        loadAboutData();
                        break;
                }
            }

            // Close sidebar on mobile
            if (window.innerWidth < 768) {
                document.getElementById('sidebar').classList.remove('active');
                document.getElementById('mainContent').classList.remove('sidebar-open');
            }
        }

        // Load Dashboard Data
        async function loadDashboardData() {
            try {
                // Load stats
                const [usersResult, productsResult, ordersResult, kycResult] = await Promise.all([
                    supabase.from('users').select('id', { count: 'exact' }),
                    supabase.from('products').select('id', { count: 'exact' }),
                    supabase.from('orders').select('id', { count: 'exact' }),
                    supabase.from('kyc_verifications').select('id', { count: 'exact' }).eq('status', 'pending')
                ]);

                document.getElementById('totalUsers').textContent = usersResult.count || 0;
                document.getElementById('totalProducts').textContent = productsResult.count || 0;
                document.getElementById('totalOrders').textContent = ordersResult.count || 0;
                document.getElementById('pendingKyc').textContent = kycResult.count || 0;

                // Load recent orders
                loadRecentOrders();

                // Load sales chart
                loadSalesChart();

            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('Error loading dashboard data', 'error');
            }
        }

        // Load Recent Orders
        async function loadRecentOrders() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        buyer:users!buyer_id(name),
                        product:products!product_id(name)
                    `)
                    .order('ordered_at', { ascending: false })
                    .limit(5);

                if (error) throw error;

                const container = document.getElementById('recentOrders');
                container.innerHTML = '';

                if (orders && orders.length > 0) {
                    orders.forEach(order => {
                        const orderElement = document.createElement('div');
                        orderElement.className = 'flex items-center justify-between p-4 bg-white bg-opacity-5 rounded-xl';
                        orderElement.innerHTML = `
                            <div>
                                <p class="text-white font-semibold">${order.product?.name || 'Unknown Product'}</p>
                                <p class="text-white text-opacity-60 text-sm">by ${order.buyer?.name || 'Unknown User'}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-white font-semibold">${order.amount} MMK</p>
                                <span class="status-badge status-${order.status}">${order.status}</span>
                            </div>
                        `;
                        container.appendChild(orderElement);
                    });
                } else {
                    container.innerHTML = '<p class="text-white text-opacity-60 text-center py-8">No recent orders</p>';
                }

            } catch (error) {
                console.error('Error loading recent orders:', error);
            }
        }

        // Load Sales Chart
        function loadSalesChart() {
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Sales',
                        data: [12, 19, 3, 5, 2, 3],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Load Users
        async function loadUsers() {
            try {
                const { data: users, error } = await supabase
                    .from('users')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = '';

                if (users && users.length > 0) {
                    users.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-600 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user text-white"></i>
                                    </div>
                                    <span class="font-medium">${user.name}</span>
                                </div>
                            </td>
                            <td>${user.email}</td>
                            <td>${user.username}</td>
                            <td><span class="status-badge status-${user.kyc_status}">${user.kyc_status}</span></td>
                            <td><span class="status-badge ${user.is_active ? 'status-approved' : 'status-rejected'}">${user.is_active ? 'Active' : 'Inactive'}</span></td>
                            <td>${new Date(user.created_at).toLocaleDateString()}</td>
                            <td>
                                <button class="btn-premium px-4 py-2 text-sm mr-2" onclick="viewUser('${user.id}')">
                                    <i class="fas fa-eye mr-1"></i>View
                                </button>
                                <button class="btn-danger px-4 py-2 text-sm" onclick="toggleUserStatus('${user.id}', ${user.is_active})">
                                    <i class="fas fa-${user.is_active ? 'ban' : 'check'} mr-1"></i>
                                    ${user.is_active ? 'Block' : 'Unblock'}
                                </button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-white text-opacity-60">No users found</td></tr>';
                }

            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('Error loading users', 'error');
            }
        }

        // Load Products
        async function loadProducts() {
            try {
                const { data: products, error } = await supabase
                    .from('products')
                    .select(`
                        *,
                        seller:users!seller_id(name)
                    `)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('productsTableBody');
                tbody.innerHTML = '';

                if (products && products.length > 0) {
                    products.forEach(product => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-blue-600 rounded-full flex items-center justify-center">
                                        <i class="fas fa-box text-white"></i>
                                    </div>
                                    <span class="font-medium">${product.name}</span>
                                </div>
                            </td>
                            <td><span class="bg-blue-500 bg-opacity-20 text-blue-300 px-3 py-1 rounded-full text-sm">${product.product_type}</span></td>
                            <td>${product.price} MMK</td>
                            <td>${product.is_admin_product ? 'Admin' : (product.seller?.name || 'Unknown')}</td>
                            <td><span class="status-badge status-${product.status}">${product.status}</span></td>
                            <td>${new Date(product.created_at).toLocaleDateString()}</td>
                            <td>
                                <button class="btn-premium px-4 py-2 text-sm mr-2" onclick="viewProduct('${product.id}')">
                                    <i class="fas fa-eye mr-1"></i>View
                                </button>
                                ${product.status === 'pending' ? `
                                    <button class="btn-success px-4 py-2 text-sm mr-2" onclick="approveProduct('${product.id}')">
                                        <i class="fas fa-check mr-1"></i>Approve
                                    </button>
                                    <button class="btn-danger px-4 py-2 text-sm" onclick="rejectProduct('${product.id}')">
                                        <i class="fas fa-times mr-1"></i>Reject
                                    </button>
                                ` : ''}
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-white text-opacity-60">No products found</td></tr>';
                }

            } catch (error) {
                console.error('Error loading products:', error);
                showNotification('Error loading products', 'error');
            }
        }

        // Load Orders
        async function loadOrders() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        buyer:users!buyer_id(name),
                        product:products!product_id(name),
                        payment_method:payment_methods!payment_method_id(name)
                    `)
                    .order('ordered_at', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('ordersTableBody');
                tbody.innerHTML = '';

                if (orders && orders.length > 0) {
                    orders.forEach(order => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><code class="bg-gray-800 px-2 py-1 rounded text-sm">${order.id.substring(0, 8)}...</code></td>
                            <td>${order.buyer?.name || 'Unknown'}</td>
                            <td>${order.product?.name || 'Unknown'}</td>
                            <td>${order.amount} MMK</td>
                            <td>${order.payment_method?.name || 'N/A'}</td>
                            <td><span class="status-badge status-${order.status}">${order.status}</span></td>
                            <td>${new Date(order.ordered_at).toLocaleDateString()}</td>
                            <td>
                                <button class="btn-premium px-4 py-2 text-sm mr-2" onclick="viewOrder('${order.id}')">
                                    <i class="fas fa-eye mr-1"></i>View
                                </button>
                                ${order.status === 'pending' ? `
                                    <button class="btn-success px-4 py-2 text-sm mr-2" onclick="approveOrder('${order.id}')">
                                        <i class="fas fa-check mr-1"></i>Approve
                                    </button>
                                    <button class="btn-danger px-4 py-2 text-sm" onclick="rejectOrder('${order.id}')">
                                        <i class="fas fa-times mr-1"></i>Reject
                                    </button>
                                ` : ''}
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center py-8 text-white text-opacity-60">No orders found</td></tr>';
                }

            } catch (error) {
                console.error('Error loading orders:', error);
                showNotification('Error loading orders', 'error');
            }
        }

        // Load Payment Methods
        async function loadPaymentMethods() {
            try {
                const { data: methods, error } = await supabase
                    .from('payment_methods')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const container = document.getElementById('paymentMethodsGrid');
                container.innerHTML = '';

                if (methods && methods.length > 0) {
                    methods.forEach(method => {
                        const card = document.createElement('div');
                        card.className = 'glass-card p-6';
                        card.innerHTML = `
                            <div class="text-center mb-6">
                                <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <i class="fas fa-credit-card text-white text-2xl"></i>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-2">${method.name}</h3>
                                <p class="text-white text-opacity-70">${method.details}</p>
                            </div>
                            
                            ${method.description ? `
                                <p class="text-white text-opacity-60 text-sm mb-4">${method.description}</p>
                            ` : ''}
                            
                            <div class="flex space-x-3">
                                <button class="btn-premium flex-1 py-3" onclick="editPaymentMethod('${method.id}')">
                                    <i class="fas fa-edit mr-2"></i>Edit
                                </button>
                                <button class="btn-danger flex-1 py-3" onclick="deletePaymentMethod('${method.id}')">
                                    <i class="fas fa-trash mr-2"></i>Delete
                                </button>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = '<div class="col-span-full text-center py-16"><p class="text-white text-opacity-60 text-xl">No payment methods found</p></div>';
                }

            } catch (error) {
                console.error('Error loading payment methods:', error);
                showNotification('Error loading payment methods', 'error');
            }
        }

        // Load KYC Applications
        async function loadKycApplications() {
            try {
                const { data: applications, error } = await supabase
                    .from('kyc_verifications')
                    .select(`
                        *,
                        user:users!user_id(name, email)
                    `)
                    .order('submitted_at', { ascending: false });

                if (error) throw error;

                const tbody = document.getElementById('kycTableBody');
                tbody.innerHTML = '';

                if (applications && applications.length > 0) {
                    applications.forEach(kyc => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>
                                <div class="flex items-center space-x-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-600 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user text-white"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium">${kyc.user?.name || 'Unknown'}</p>
                                        <p class="text-white text-opacity-60 text-sm">${kyc.user?.email || ''}</p>
                                    </div>
                                </div>
                            </td>
                            <td>${kyc.full_name}</td>
                            <td><span class="bg-blue-500 bg-opacity-20 text-blue-300 px-3 py-1 rounded-full text-sm">${kyc.document_type}</span></td>
                            <td><span class="status-badge status-${kyc.status}">${kyc.status}</span></td>
                            <td>${new Date(kyc.submitted_at).toLocaleDateString()}</td>
                            <td>
                                <button class="btn-premium px-4 py-2 text-sm mr-2" onclick="viewKyc('${kyc.id}')">
                                    <i class="fas fa-eye mr-1"></i>View
                                </button>
                                ${kyc.status === 'pending' ? `
                                    <button class="btn-success px-4 py-2 text-sm mr-2" onclick="approveKyc('${kyc.id}')">
                                        <i class="fas fa-check mr-1"></i>Approve
                                    </button>
                                    <button class="btn-danger px-4 py-2 text-sm" onclick="rejectKyc('${kyc.id}')">
                                        <i class="fas fa-times mr-1"></i>Reject
                                    </button>
                                ` : ''}
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-white text-opacity-60">No KYC applications found</td></tr>';
                }

            } catch (error) {
                console.error('Error loading KYC applications:', error);
                showNotification('Error loading KYC applications', 'error');
            }
        }

        // Load News
        async function loadNews() {
            try {
                const { data: news, error } = await supabase
                    .from('news')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const container = document.getElementById('newsGrid');
                container.innerHTML = '';

                if (news && news.length > 0) {
                    news.forEach(article => {
                        const card = document.createElement('div');
                        card.className = 'glass-card p-6';
                        card.innerHTML = `
                            <div class="mb-6">
                                <h3 class="text-xl font-bold text-white mb-3">${article.title}</h3>
                                <p class="text-white text-opacity-70 line-clamp-3">${article.content.substring(0, 150)}...</p>
                            </div>
                            
                            <div class="flex items-center justify-between mb-6">
                                <span class="status-badge ${article.is_published ? 'status-approved' : 'status-pending'}">
                                    ${article.is_published ? 'Published' : 'Draft'}
                                </span>
                                <span class="text-white text-opacity-60 text-sm">
                                    ${new Date(article.created_at).toLocaleDateString()}
                                </span>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button class="btn-premium flex-1 py-3" onclick="editNews('${article.id}')">
                                    <i class="fas fa-edit mr-2"></i>Edit
                                </button>
                                <button class="btn-warning flex-1 py-3" onclick="toggleNewsStatus('${article.id}', ${article.is_published})">
                                    <i class="fas fa-${article.is_published ? 'eye-slash' : 'eye'} mr-2"></i>
                                    ${article.is_published ? 'Hide' : 'Publish'}
                                </button>
                                <button class="btn-danger px-4 py-3" onclick="deleteNews('${article.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                } else {
                    container.innerHTML = '<div class="col-span-full text-center py-16"><p class="text-white text-opacity-60 text-xl">No news articles found</p></div>';
                }

            } catch (error) {
                console.error('Error loading news:', error);
                showNotification('Error loading news', 'error');
            }
        }

        // Load About Data
        async function loadAboutData() {
            // This would typically load from a settings table
            // For now, we'll use default values
            document.getElementById('companyName').value = 'MMR GAMING SHOP';
            document.getElementById('companyEmail').value = 'contact@mmrgamingshop.com';
            document.getElementById('companyDescription').value = 'Premium gaming platform for Myanmar gamers...';
        }

        // Setup Form Handlers
        function setupFormHandlers() {
            // Add Product Modal
            document.getElementById('addProductBtn').addEventListener('click', function() {
                document.getElementById('addProductModal').classList.add('active');
            });

            // Product Type Change
            document.getElementById('productType').addEventListener('change', function() {
                const apkFields = document.getElementById('apkFields');
                if (this.value === 'apk') {
                    apkFields.classList.remove('hidden');
                } else {
                    apkFields.classList.add('hidden');
                }
            });

            // Add Payment Modal
            document.getElementById('addPaymentBtn').addEventListener('click', function() {
                document.getElementById('addPaymentModal').classList.add('active');
            });

            // Add News Modal
            document.getElementById('addNewsBtn').addEventListener('click', function() {
                document.getElementById('addNewsModal').classList.add('active');
            });

            // Form submissions
            document.getElementById('addProductForm').addEventListener('submit', handleAddProduct);
            document.getElementById('addPaymentForm').addEventListener('submit', handleAddPayment);
            document.getElementById('addNewsForm').addEventListener('submit', handleAddNews);
            document.getElementById('aboutForm').addEventListener('submit', handleUpdateAbout);
        }

        // Handle Add Product
        async function handleAddProduct(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                // Here you would handle file uploads and create the product
                showNotification('Product added successfully!', 'success');
                document.getElementById('addProductModal').classList.remove('active');
                loadProducts();
            } catch (error) {
                console.error('Error adding product:', error);
                showNotification('Error adding product', 'error');
            }
        }

        // Handle Add Payment
        async function handleAddPayment(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                // Here you would handle file uploads and create the payment method
                showNotification('Payment method added successfully!', 'success');
                document.getElementById('addPaymentModal').classList.remove('active');
                loadPaymentMethods();
            } catch (error) {
                console.error('Error adding payment method:', error);
                showNotification('Error adding payment method', 'error');
            }
        }

        // Handle Add News
        async function handleAddNews(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                // Here you would handle file uploads and create the news article
                showNotification('News article added successfully!', 'success');
                document.getElementById('addNewsModal').classList.remove('active');
                loadNews();
            } catch (error) {
                console.error('Error adding news article:', error);
                showNotification('Error adding news article', 'error');
            }
        }

        // Handle Update About
        async function handleUpdateAbout(e) {
            e.preventDefault();
            
            try {
                // Here you would update the about information
                showNotification('About information updated successfully!', 'success');
            } catch (error) {
                console.error('Error updating about information:', error);
                showNotification('Error updating about information', 'error');
            }
        }

        // Action Functions
        async function approveKyc(kycId) {
            try {
                const { error } = await supabase
                    .from('kyc_verifications')
                    .update({ 
                        status: 'approved',
                        reviewed_at: new Date().toISOString(),
                        reviewed_by: currentAdmin.id
                    })
                    .eq('id', kycId);

                if (error) throw error;

                // Update user's KYC status and enable seller mode
                const { data: kyc } = await supabase
                    .from('kyc_verifications')
                    .select('user_id')
                    .eq('id', kycId)
                    .single();

                if (kyc) {
                    await supabase
                        .from('users')
                        .update({ 
                            kyc_status: 'approved',
                            is_seller: true
                        })
                        .eq('id', kyc.user_id);
                }

                showNotification('KYC approved successfully!', 'success');
                loadKycApplications();
            } catch (error) {
                console.error('Error approving KYC:', error);
                showNotification('Error approving KYC', 'error');
            }
        }

        async function rejectKyc(kycId) {
            try {
                const { error } = await supabase
                    .from('kyc_verifications')
                    .update({ 
                        status: 'rejected',
                        reviewed_at: new Date().toISOString(),
                        reviewed_by: currentAdmin.id
                    })
                    .eq('id', kycId);

                if (error) throw error;

                // Update user's KYC status
                const { data: kyc } = await supabase
                    .from('kyc_verifications')
                    .select('user_id')
                    .eq('id', kycId)
                    .single();

                if (kyc) {
                    await supabase
                        .from('users')
                        .update({ kyc_status: 'rejected' })
                        .eq('id', kyc.user_id);
                }

                showNotification('KYC rejected', 'warning');
                loadKycApplications();
            } catch (error) {
                console.error('Error rejecting KYC:', error);
                showNotification('Error rejecting KYC', 'error');
            }
        }

        async function approveOrder(orderId) {
            try {
                const { error } = await supabase
                    .from('orders')
                    .update({ 
                        status: 'approved',
                        processed_at: new Date().toISOString(),
                        processed_by: currentAdmin.id
                    })
                    .eq('id', orderId);

                if (error) throw error;

                showNotification('Order approved successfully!', 'success');
                loadOrders();
            } catch (error) {
                console.error('Error approving order:', error);
                showNotification('Error approving order', 'error');
            }
        }

        async function rejectOrder(orderId) {
            try {
                const { error } = await supabase
                    .from('orders')
                    .update({ 
                        status: 'rejected',
                        processed_at: new Date().toISOString(),
                        processed_by: currentAdmin.id
                    })
                    .eq('id', orderId);

                if (error) throw error;

                showNotification('Order rejected', 'warning');
                loadOrders();
            } catch (error) {
                console.error('Error rejecting order:', error);
                showNotification('Error rejecting order', 'error');
            }
        }

        async function approveProduct(productId) {
            try {
                const { error } = await supabase
                    .from('products')
                    .update({ status: 'approved' })
                    .eq('id', productId);

                if (error) throw error;

                showNotification('Product approved successfully!', 'success');
                loadProducts();
            } catch (error) {
                console.error('Error approving product:', error);
                showNotification('Error approving product', 'error');
            }
        }

        async function rejectProduct(productId) {
            try {
                const { error } = await supabase
                    .from('products')
                    .update({ status: 'rejected' })
                    .eq('id', productId);

                if (error) throw error;

                showNotification('Product rejected', 'warning');
                loadProducts();
            } catch (error) {
                console.error('Error rejecting product:', error);
                showNotification('Error rejecting product', 'error');
            }
        }

        async function toggleUserStatus(userId, currentStatus) {
            try {
                const { error } = await supabase
                    .from('users')
                    .update({ is_active: !currentStatus })
                    .eq('id', userId);

                if (error) throw error;

                showNotification(`User ${!currentStatus ? 'activated' : 'deactivated'} successfully!`, 'success');
                loadUsers();
            } catch (error) {
                console.error('Error toggling user status:', error);
                showNotification('Error updating user status', 'error');
            }
        }

        // View Functions (placeholder)
        function viewUser(userId) {
            showNotification('User details modal would open here', 'info');
        }

        function viewProduct(productId) {
            showNotification('Product details modal would open here', 'info');
        }

        function viewOrder(orderId) {
            showNotification('Order details modal would open here', 'info');
        }

        function viewKyc(kycId) {
            showNotification('KYC details modal would open here', 'info');
        }

        // Logout
        function logout() {
            localStorage.removeItem('adminSession');
            currentAdmin = null;
            showLogin();
            showNotification('Logged out successfully', 'info');
        }

        // Show Notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification-modern notification-${type}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} mr-3"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Refresh Functions
        document.getElementById('refreshUsersBtn')?.addEventListener('click', loadUsers);
        document.getElementById('refreshOrdersBtn')?.addEventListener('click', loadOrders);
        document.getElementById('refreshKycBtn')?.addEventListener('click', loadKycApplications);

        // Search Functionality
        document.getElementById('userSearchInput')?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#usersTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });

        // Filter Functionality
        document.getElementById('orderStatusFilter')?.addEventListener('change', function(e) {
            const filterValue = e.target.value;
            const rows = document.querySelectorAll('#ordersTableBody tr');
            
            rows.forEach(row => {
                if (!filterValue) {
                    row.style.display = '';
                } else {
                    const statusBadge = row.querySelector('.status-badge');
                    const status = statusBadge ? statusBadge.textContent.toLowerCase() : '';
                    row.style.display = status.includes(filterValue) ? '' : 'none';
                }
            });
        });

        document.getElementById('kycStatusFilter')?.addEventListener('change', function(e) {
            const filterValue = e.target.value;
            const rows = document.querySelectorAll('#kycTableBody tr');
            
            rows.forEach(row => {
                if (!filterValue) {
                    row.style.display = '';
                } else {
                    const statusBadge = row.querySelector('.status-badge');
                    const status = statusBadge ? statusBadge.textContent.toLowerCase() : '';
                    row.style.display = status.includes(filterValue) ? '' : 'none';
                }
            });
        });
    </script>
</body>
</html>
