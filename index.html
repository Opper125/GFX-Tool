<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FPS GFX Tool - Index</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      background: linear-gradient(180deg, #1a1a1a, #2a2a2a);
      position: relative;
      overflow-x: hidden;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    body.dashboard-active {
      background: url('https://upload.wikimedia.org/wikipedia/commons/4/48/Myanmar_map.png') no-repeat center center / cover;
      animation: mapZoom 20s ease-in-out infinite;
    }
    @keyframes mapZoom { 0% { background-size: 100%; } 50% { background-size: 110%; } 100% { background-size: 100%; } }
    body::before {
      content: '';
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 200px;
      background: url('https://i.imgur.com/4Dwaves.png') repeat-x bottom;
      background-size: 2000px 200px;
      animation: waveAnimation 10s linear infinite;
      filter: drop-shadow(0 0 20px rgba(0, 191, 255, 0.5));
    }
    @keyframes waveAnimation { 0% { background-position-x: 0; } 100% { background-position-x: 2000px; } }
    .container {
      background: rgba(34, 34, 34, 0.9);
      padding: 24px;
      border-radius: 16px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.8s ease-out;
      backdrop-filter: blur(10px);
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    h1 { font-size: 24px; color: #ffd700; margin-bottom: 24px; }
    input, button { width: 100%; padding: 12px; margin: 12px 0; border-radius: 8px; }
    #status { color: #ff4444; text-align: center; }
    .success { color: #44ff44; }
    #config-form { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>FPS GFX Tool</h1>
    <div id="status"></div>
    <input type="text" id="key" placeholder="Enter Key" required>
    <button onclick="validateKey()">Submit</button>
    <div id="config-form">
      <h2>Configure GFX Settings</h2>
      <select id="game-version">
        <option value="pubg">PUBG</option>
        <option value="free-fire">Free Fire</option>
      </select>
      <input type="number" id="fps" placeholder="FPS (e.g., 60)" min="30" max="120">
      <select id="bit-type">
        <option value="32-bit">32-bit</option>
        <option value="64-bit">64-bit</option>
      </select>
      <label><input type="checkbox" id="ipad-view"> iPad View</label>
      <input type="number" id="dpi" placeholder="DPI (optional)">
      <input type="text" id="resolution" placeholder="Resolution (e.g., 1920x1080)">
      <button onclick="generateConfig()">Generate Config</button>
      <a id="download-link" style="display: none;">Download Config</a>
    </div>
  </div>

  <script>
    let isOnline = navigator.onLine;
    let cachedData = JSON.parse(localStorage.getItem('userData') || '{}');

    window.addEventListener('online', () => {
      isOnline = true;
      document.getElementById('status').innerText = 'Online';
      syncCachedData();
    });

    window.addEventListener('offline', () => {
      isOnline = false;
      document.getElementById('status').innerText = 'Offline';
    });

    function showMessage(message, type = 'error') {
      const status = document.getElementById('status');
      status.innerText = message;
      status.className = type === 'success' ? 'success' : '';
      setTimeout(() => status.innerText = '', 5000);
    }

    function validateKey() {
      const key = document.getElementById('key').value.trim();
      if (!key) {
        showMessage('Please enter a key.');
        return;
      }

      if (!isOnline) {
        if (cachedData.keys && cachedData.keys[key] && cachedData.keys[key].isValid) {
          showMessage('Key validated from cache.', 'success');
          showConfigForm();
          return;
        }
        showMessage('Offline mode: Key not found in cache.');
        return;
      }

      // Mock validation using local logic
      fetch('/validate-key', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ key })
      }).then(response => response.json()).then(data => {
        if (data.valid) {
          if (!cachedData.keys) cachedData.keys = {};
          cachedData.keys[key] = { isValid: true, timestamp: Date.now() };
          localStorage.setItem('userData', JSON.stringify(cachedData));
          showMessage('Key validated successfully!', 'success');
          showConfigForm();
        } else {
          showMessage('Invalid key.');
        }
      }).catch(() => {
        showMessage('Network error. Check your internet.');
      });
    }

    function showConfigForm() {
      document.getElementById('config-form').style.display = 'block';
      document.getElementById('key').style.display = 'none';
      document.querySelector('button[onclick="validateKey()"]').style.display = 'none';
      document.body.classList.add('dashboard-active');
    }

    function generateConfig() {
      const gameVersion = document.getElementById('game-version').value;
      const fps = document.getElementById('fps').value;
      const bitType = document.getElementById('bit-type').value;
      const ipadView = document.getElementById('ipad-view').checked;
      const dpi = document.getElementById('dpi').value || '';
      const resolution = document.getElementById('resolution').value || '1920x1080';

      if (!fps || !gameVersion || !bitType) {
        showMessage('Please fill all required fields.');
        return;
      }

      const config = { gameVersion, fps, bitType, ipadView, dpi, resolution, timestamp: Date.now() };
      if (!cachedData.configs) cachedData.configs = {};
      cachedData.configs[config.timestamp] = config;
      localStorage.setItem('userData', JSON.stringify(cachedData));

      const configText = `GFX Config\nGame: ${gameVersion}\nFPS: ${fps}\nBit: ${bitType}\nIPad View: ${ipadView}\nDPI: ${dpi}\nResolution: ${resolution}`;
      const blob = new Blob([configText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const downloadLink = document.getElementById('download-link');
      downloadLink.href = url;
      downloadLink.download = `gfx_config_${config.timestamp}.txt`;
      downloadLink.style.display = 'block';
      downloadLink.textContent = 'Download Config';
      showMessage('Config generated!', 'success');
    }

    function syncCachedData() {
      if (isOnline) {
        fetch('/sync-data', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(cachedData)
        }).then(() => {
          showMessage('Data synced successfully.', 'success');
        }).catch(() => {
          showMessage('Sync failed. Data remains cached.');
        });
      }
    }

    document.getElementById('status').innerText = isOnline ? 'Online' : 'Offline';
  </script>
</body>
</html>
