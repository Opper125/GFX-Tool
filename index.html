<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>FPS GFX Tool - မြန်မာ အသုံးပြုသူ အင်တာဖေ့စ်</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&family=Noto+Sans+Myanmar:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Myanmar Cultural Color Palette */
:root {
  --myanmar-red: #FF6B35;
  --myanmar-gold: #FFD700;
  --myanmar-green: #228B22;
  --myanmar-blue: #1E3A8A;
  --myanmar-purple: #7C3AED;
  --dark-bg: #0F172A;
  --card-bg: rgba(30, 41, 59, 0.8);
  --glass-bg: rgba(255, 255, 255, 0.1);
  --text-light: #F1F5F9;
  --text-muted: #94A3B8;
  --border-color: rgba(255, 255, 255, 0.2);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Noto Sans Myanmar', 'Orbitron', sans-serif;
  background: linear-gradient(135deg, var(--dark-bg) 0%, #1E293B  50%, #334155 100%);
  color: var(--text-light);
  min-height: 100vh;
  overflow-x: hidden;
}

.myanmar-pattern {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: 
    radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(34, 139, 34, 0.1) 0%, transparent 50%);
  z-index: -1;
  animation: patternFloat 20s ease-in-out infinite;
}

@keyframes patternFloat {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(5deg); }
}

.glass-card {
  background: var(--card-bg);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border-color);
  border-radius: 20px;
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.glass-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 35px 70px -12px rgba(0, 0, 0, 0.35);
  border-color: var(--myanmar-gold);
}

.myanmar-btn {
  background: linear-gradient(135deg, var(--myanmar-red), var(--myanmar-gold));
  border: none;
  padding: 12px 24px;
  border-radius: 12px;
  color: white;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
}

.myanmar-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  transition: left 0.6s ease;
}

.myanmar-btn:hover::before {
  left: 100%;
}

.myanmar-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 35px rgba(255, 107, 53, 0.5);
}

.myanmar-btn:active {
  transform: translateY(0);
}

.status-indicator {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  padding: 8px 16px;
  border-radius: 25px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  backdrop-filter: blur(10px);
}

.status-online {
  background: linear-gradient(135deg, var(--myanmar-green), #10B981);
  color: white;
  animation: pulse 2s infinite;
}

.status-offline {
  background: linear-gradient(135deg, var(--myanmar-red), #EF4444);
  color: white;
  animation: shake 0.5s ease-in-out;
}

.status-connecting {
  background: linear-gradient(135deg, var(--myanmar-purple), var(--myanmar-gold));
  color: white;
  animation: spin 1s linear infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.05); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.app-input {
  background: var(--glass-bg);
  border: 2px solid var(--border-color);
  border-radius: 12px;
  padding: 14px 16px;
  color: var(--text-light);
  width: 100%;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.app-input:focus {
  outline: none;
  border-color: var(--myanmar-gold);
  box-shadow: 0 0 25px rgba(255, 215, 0, 0.3);
}

.app-input::placeholder {
  color: var(--text-muted);
}

.section-header {
  background: linear-gradient(135deg, var(--myanmar-purple), var(--myanmar-blue));
  color: white;
  padding: 16px 24px;
  border-radius: 15px;
  margin-bottom: 20px;
  text-align: center;
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  letter-spacing: 1px;
  box-shadow: 0 10px 30px rgba(124, 58, 237, 0.3);
}

.nav-tabs {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
  margin-bottom: 30px;
}

.nav-tab {
  padding: 10px 16px;
  border-radius: 25px;
  border: 2px solid var(--border-color);
  background: var(--glass-bg);
  color: var(--text-muted);
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 12px;
  letter-spacing: 0.5px;
}

.nav-tab.active {
  background: linear-gradient(135deg, var(--myanmar-gold), var(--myanmar-red));
  border-color: var(--myanmar-gold);
  color: white;
  box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
}

.nav-tab:hover:not(.active) {
  border-color: var(--myanmar-gold);
  color: var(--myanmar-gold);
}

.news-item, .product-item, .chat-message {
  background: var(--glass-bg);
  border: 1px solid var(--border-color);
  border-radius: 15px;
  padding: 20px;
  margin-bottom: 16px;
  transition: all 0.3s ease;
  backdrop-filter: blur(15px);
}

.news-item:hover, .product-item:hover {
  border-color: var(--myanmar-gold);
  transform: translateY(-3px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: var(--glass-bg);
  border: 1px solid var(--border-color);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(15px);
}

.stat-card:hover {
  border-color: var(--myanmar-gold);
  transform: translateY(-5px);
}

.stat-icon {
  font-size: 2.5rem;
  margin-bottom: 10px;
  background: linear-gradient(135deg, var(--myanmar-gold), var(--myanmar-red));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.loading-spinner {
  width: 32px;
  height: 32px;
  border: 3px solid rgba(255, 215, 0, 0.3);
  border-top: 3px solid var(--myanmar-gold);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  padding: 20px;
}

.modal-content {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 20px;
  padding: 30px;
  max-width: 600px;
  width: 100%;
  max-height: 80vh;
  overflow-y: auto;
  backdrop-filter: blur(20px);
}

.notification {
  position: fixed;
  top: 80px;
  right: 20px;
  left: 20px;
  max-width: 400px;
  margin: 0 auto;
  padding: 16px 20px;
  border-radius: 15px;
  color: white;
  font-weight: 600;
  z-index: 1500;
  animation: slideInRight 0.5s ease-out;
  backdrop-filter: blur(15px);
}

@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

.success { background: linear-gradient(135deg, var(--myanmar-green), #10B981); }
.error { background: linear-gradient(135deg, var(--myanmar-red), #EF4444); }
.info { background: linear-gradient(135deg, var(--myanmar-blue), #3B82F6); }
.warning { background: linear-gradient(135deg, var(--myanmar-gold), #F59E0B); }

.chat-container {
  height: 400px;
  overflow-y: auto;
  background: var(--glass-bg);
  border: 1px solid var(--border-color);
  border-radius: 15px;
  padding: 15px;
  margin-bottom: 15px;
  backdrop-filter: blur(15px);
}

.chat-message {
  margin-bottom: 12px;
  padding: 10px 15px;
  border-radius: 10px;
}

.chat-message.own {
  background: linear-gradient(135deg, var(--myanmar-purple), var(--myanmar-blue));
  margin-left: 20%;
  text-align: right;
}

.chat-message.other {
  background: var(--glass-bg);
  margin-right: 20%;
}

.profile-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.hidden { display: none !important; }

/* Responsive Design */
@media (max-width: 768px) {
  .container { padding: 10px; }
  .glass-card { padding: 20px; margin: 10px; }
  .status-indicator { top: 15px; right: 15px; font-size: 10px; padding: 6px 12px; }
  .notification { top: 60px; right: 15px; left: 15px; }
  .nav-tabs { gap: 6px; }
  .nav-tab { padding: 8px 12px; font-size: 11px; }
  .stats-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
  .chat-container { height: 300px; }
  .profile-section { grid-template-columns: 1fr; }
}

@media (max-width: 480px) {
  .myanmar-pattern { opacity: 0.7; }
  .glass-card { padding: 15px; margin: 5px; border-radius: 15px; }
  .section-header { padding: 12px 16px; font-size: 14px; }
  .myanmar-btn { padding: 10px 16px; font-size: 13px; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
  .stat-card { padding: 15px; }
  .stat-icon { font-size: 2rem; }
  .chat-container { height: 250px; }
  .nav-tab { padding: 6px 10px; font-size: 10px; }
}

/* PDF Export Optimization */
@media print {
  body { 
    background: white !important; 
    color: black !important;
    font-size: 12px;
  }
  .myanmar-pattern { display: none; }
  .status-indicator { display: none; }
  .glass-card, .stat-card, .news-item, .product-item { 
    background: white !important; 
    border: 1px solid #ccc !important;
    box-shadow: none !important;
  }
  .myanmar-btn { 
    background: #333 !important; 
    color: white !important;
  }
  .section-header {
    background: #333 !important;
    color: white !important;
  }
  .chat-container { 
    height: auto !important; 
    max-height: 300px;
  }
  .modal { display: none !important; }
  .notification { display: none !important; }
  .nav-tab.active {
    background: #333 !important;
    color: white !important;
  }
  * { 
    -webkit-print-color-adjust: exact !important; 
    color-adjust: exact !important; 
  }
}

/* Custom Scrollbar */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); }
::-webkit-scrollbar-thumb { 
  background: linear-gradient(135deg, var(--myanmar-gold), var(--myanmar-red)); 
  border-radius: 4px; 
}
::-webkit-scrollbar-thumb:hover { 
  background: linear-gradient(135deg, var(--myanmar-red), var(--myanmar-gold)); 
}
</style>
</head>
<body>
<div class="myanmar-pattern"></div>

<!-- Status Indicator -->
<div id="status-indicator" class="status-indicator status-connecting">
  <i class="fas fa-wifi"></i> ချိတ်ဆက်နေသည်...
</div>

<!-- Notification Container -->
<div id="notification-container"></div>

<!-- Main Container -->
<div class="container mx-auto p-4 max-w-6xl">
  
  <!-- App Header -->
  <div class="text-center mb-8">
    <h1 class="text-4xl md:text-5xl font-bold mb-4 font-orbitron">
      <span style="background: linear-gradient(135deg, var(--myanmar-gold), var(--myanmar-red)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
        <i class="fas fa-gamepad mr-3"></i>FPS GFX TOOL
      </span>
    </h1>
    <p class="text-lg text-gray-300 mb-6">မြန်မာနိုင်ငံရဲ့ အကောင်းဆုံး FPS Gaming Tools</p>
    <div class="inline-block px-6 py-3 bg-gradient-to-r from-myanmar-purple to-myanmar-blue text-white rounded-full font-bold">
      <i class="fas fa-star mr-2"></i>Premium Gaming Experience
    </div>
  </div>

  <!-- Login Section -->
  <div id="login-section" class="max-w-md mx-auto">
    <div class="glass-card p-8">
      <div class="section-header">
        <i class="fas fa-key mr-2"></i>ACCESS KEY LOGIN
      </div>
      <div class="space-y-6">
        <div>
          <input type="text" id="access-key" placeholder="သင့်ရဲ့ Access Key ကို ထည့်ပါ..." class="app-input">
        </div>
        <button onclick="authenticateUser()" class="myanmar-btn w-full">
          <i class="fas fa-sign-in-alt mr-2"></i>LOGIN
        </button>
      </div>
    </div>
  </div>

  <!-- Profile Creation Section -->
  <div id="profile-creation" class="max-w-md mx-auto hidden">
    <div class="glass-card p-8">
      <div class="section-header">
        <i class="fas fa-user-plus mr-2"></i>PROFILE ဖန်တီးရန်
      </div>
      <p class="text-center mb-6 text-gray-300">သင့်ရဲ့ key အတွက် profile မရှိသေးပါ။ အသစ်ဖန်တီးပါ။</p>
      <div class="space-y-4">
        <input type="text" id="username" placeholder="Username (အတူတူမဖြစ်ရ)" class="app-input">
        <input type="text" id="display-name" placeholder="သင့်နာမည်" class="app-input">
        <input type="file" id="profile-pic" accept="image/*" class="app-input">
        <button onclick="createUserProfile()" class="myanmar-btn w-full">
          <i class="fas fa-plus-circle mr-2"></i>PROFILE ဖန်တီးရန်
        </button>
      </div>
    </div>
  </div>

  <!-- Main App Content -->
  <div id="app-content" class="hidden">
    
    <!-- Stats Dashboard -->
    <div class="stats-grid">
      <div class="stat-card">
        <i class="fas fa-download stat-icon"></i>
        <h3 class="text-sm font-semibold text-gray-300 mb-2">TOTAL DOWNLOADS</h3>
        <p id="total-downloads" class="text-2xl font-bold text-myanmar-gold">0</p>
      </div>
      <div class="stat-card">
        <i class="fas fa-box-open stat-icon"></i>
        <h3 class="text-sm font-semibold text-gray-300 mb-2">PRODUCTS</h3>
        <p id="total-products" class="text-2xl font-bold text-myanmar-gold">0</p>
      </div>
      <div class="stat-card">
        <i class="fas fa-users stat-icon"></i>
        <h3 class="text-sm font-semibold text-gray-300 mb-2">ACTIVE USERS</h3>
        <p id="active-users" class="text-2xl font-bold text-myanmar-gold">0</p>
      </div>
      <div class="stat-card">
        <i class="fas fa-comments stat-icon"></i>
        <h3 class="text-sm font-semibold text-gray-300 mb-2">CHAT MESSAGES</h3>
        <p id="chat-count" class="text-2xl font-bold text-myanmar-gold">0</p>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <div class="nav-tab active" onclick="showSection('home', this)">
        <i class="fas fa-home mr-1"></i>HOME
      </div>
      <div class="nav-tab" onclick="showSection('news', this)">
        <i class="fas fa-newspaper mr-1"></i>NEWS
      </div>
      <div class="nav-tab" onclick="showSection('products', this)">
        <i class="fas fa-box-open mr-1"></i>PRODUCTS
      </div>
      <div class="nav-tab" onclick="showSection('chat', this)">
        <i class="fas fa-comments mr-1"></i>CHAT
      </div>
      <div class="nav-tab" onclick="showSection('support', this)">
        <i class="fas fa-headset mr-1"></i>SUPPORT
      </div>
      <div class="nav-tab" onclick="showSection('about', this)">
        <i class="fas fa-info-circle mr-1"></i>ABOUT
      </div>
      <div class="nav-tab" onclick="showSection('profile', this)">
        <i class="fas fa-user mr-1"></i>PROFILE
      </div>
      <div class="nav-tab" onclick="logoutUser()" style="background: linear-gradient(135deg, var(--myanmar-red), #EF4444); color: white;">
        <i class="fas fa-sign-out-alt mr-1"></i>LOGOUT
      </div>
    </div>

    <!-- Home Section -->
    <div id="home-section" class="app-section">
      <div class="glass-card p-8">
        <div class="section-header">
          <i class="fas fa-home mr-2"></i>DASHBOARD
        </div>
        <div class="text-center">
          <h3 class="text-2xl font-bold mb-4">ကြိုဆိုပါတယ် FPS GFX Tool မှာ!</h3>
          <p class="text-gray-300 mb-6">Professional Gaming Experience အတွက် လိုအပ်တဲ့ tool အားလုံး</p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glass-card p-6">
              <i class="fas fa-mobile-alt text-4xl text-myanmar-gold mb-4"></i>
              <h4 class="font-bold mb-2">Mobile Optimization</h4>
              <p class="text-sm text-gray-300">မိုဘိုင်းဖုန်းအတွက် အထူးပြုလုပ်ထားတဲ့ GFX tools များ</p>
            </div>
            <div class="glass-card p-6">
              <i class="fas fa-tachometer-alt text-4xl text-myanmar-red mb-4"></i>
              <h4 class="font-bold mb-2">Performance Boost</h4>
              <p class="text-sm text-gray-300">FPS တိုးမြှင့်ပေးနိုင်တဲ့ advanced settings များ</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- News Section -->
    <div id="news-section" class="app-section hidden">
      <div class="glass-card p-8">
        <div class="section-header">
          <i class="fas fa-newspaper mr-2"></i>နောက်ဆုံးရ သတင်းများ
        </div>
        <div id="news-container">
          <div class="text-center py-8">
            <div class="loading-spinner mb-4"></div>
            <p class="text-gray-300">သတင်းများ ခေါ်နေသည်...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Products Section -->
    <div id="products-section" class="app-section hidden">
      <div class="glass-card p-8">
        <div class="section-header">
          <i class="fas fa-box-open mr-2"></i>PRODUCTS & APKS
        </div>
        <div id="products-container">
          <div class="text-center py-8">
            <div class="loading-spinner mb-4"></div>
            <p class="text-gray-300">Products များ ခေါ်နေသည်...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Section -->
    <div id="chat-section" class="app-section hidden">
      <div class="glass-card p-8">
        <div class="section-header">
          <i class="fas fa-comments mr-2"></i>GLOBAL CHAT
        </div>
        <div class="chat-container" id="chat-messages">
          <div class="text-center py-8">
            <div class="loading-spinner mb-4"></div>
            <p class="text-gray-300">Chat messages ခေါ်နေသည်...</p>
          </div>
        </div>
        <div class="flex gap-3">
          <input type="text" id="chat-input" placeholder="မက်ဆေ့ချ် ရိုက်ပါ..." class="app-input flex-1">
          <button onclick="sendMessage()" class="myanmar-btn">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Support Section -->
    <div id="support-section" class="app-section hidden">
      <div class="glass-card p-8">
        <div class="section-header">
          <i class="fas fa-headset mr-2"></i>SUPPORT CENTER
        </div>
        <div class="space-y-6">
          <div>
            <label class="block text-sm font-semibold mb-2">Subject</label>
            <input type="text" id="support-subject" placeholder="ပြဿနာ ခေါင်းစဥ်" class="app-input">
          </div>
          <div>
            <label class="block text-sm font-semibold mb-2">Message</label>
            <textarea id="support-message" placeholder="သင့်ရဲ့ ပြဿနာကို အသေးစိတ် ရှင်းပြပါ..." rows="5" class="app-input resize-none"></textarea>
          </div>
          <button onclick="sendSupportMessage()" class="myanmar-btn w-full">
            <i class="fas fa-paper-plane mr-2"></i>SEND SUPPORT MESSAGE
          </button>
        </div>
        
        <div class="mt-8">
          <h4 class="font-bold mb-4">သင့်ရဲ့ Support Messages များ</h4>
          <div id="support-messages" class="space-y-3">
            <div class="text-center py-4">
              <div class="loading-spinner mb-2"></div>
              <p class="text-gray-300 text-sm">Loading...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- About Section -->
    <div id="about-section" class="app-section hidden">
      <div class="glass-card p-8">
        <div class="section-header">
          <i class="fas fa-info-circle mr-2"></i>ABOUT US
        </div>
        <div id="about-content">
          <div class="text-center py-8">
            <div class="loading-spinner mb-4"></div>
            <p class="text-gray-300">About information ခေါ်နေသည်...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Section -->
    <div id="profile-section" class="app-section hidden">
      <div class="glass-card p-8">
        <div class="section-header">
          <i class="fas fa-user mr-2"></i>MY PROFILE
        </div>
        <div class="profile-section">
          <div class="text-center">
            <img id="profile-image" src="https://via.placeholder.com/150x150/1E3A8A/FFD700?text=USER" alt="Profile" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-myanmar-gold">
            <h3 id="profile-name" class="text-xl font-bold mb-2">Loading...</h3>
            <p id="profile-username" class="text-gray-300 mb-4">@username</p>
            <div class="inline-block px-4 py-2 rounded-full text-sm font-semibold" id="profile-status">
              Loading status...
            </div>
          </div>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-semibold mb-2">Display Name</label>
              <input type="text" id="edit-display-name" class="app-input">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-2">New Profile Picture</label>
              <input type="file" id="edit-profile-pic" accept="image/*" class="app-input">
            </div>
            <button onclick="updateProfile()" class="myanmar-btn w-full">
              <i class="fas fa-save mr-2"></i>UPDATE PROFILE
            </button>
            
            <!-- KYC Section -->
            <div class="mt-8 p-6 bg-glass-bg rounded-lg border border-myanmar-gold" id="kyc-section">
              <h4 class="font-bold mb-4 text-myanmar-gold">
                <i class="fas fa-user-shield mr-2"></i>KYC VERIFICATION
              </h4>
              <p class="text-sm text-gray-300 mb-4">အရောင်းအဝယ် လုပ်ငန်း လုပ်ကိုင်နိုင်ရန် KYC လုပ်ထားရပါမယ်။</p>
              <div id="kyc-content">
                <!-- KYC form or status will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Modal for Product Details -->
<div id="product-modal" class="modal hidden">
  <div class="modal-content">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-bold">Product Details</h3>
      <button onclick="closeProductModal()" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="product-modal-content">
      <!-- Product details will be loaded here -->
    </div>
  </div>
</div>

<!-- Modal for Order/Payment -->
<div id="payment-modal" class="modal hidden">
  <div class="modal-content">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-bold">Make Payment</h3>
      <button onclick="closePaymentModal()" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="payment-modal-content">
      <!-- Payment form will be loaded here -->
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
<script>
// Configuration - သင့် Supabase credentials များကို ဒီမှာ ထည့်ပါ
const CONFIG = {
  SUPABASE_URL: 'https://rliwdosxsbauwxkayjoa.supabase.co', // https://xxxxx.supabase.co
  SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJsaXdkb3N4c2JhdXd4a2F5am9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMDA2NjIsImV4cCI6MjA2OTY3NjY2Mn0.uDvU9eX3Cy--D9l6daGaO2QMpn1YnxMJYVlbaeIgHu4',
  MAX_RETRY_ATTEMPTS: 3,
  RETRY_DELAY: 2000
};

// Global State
let state = {
  supabase: null,
  currentUser: null,
  currentSection: 'home',
  isAuthenticated: false,
  reconnectAttempts: 0,
  realtimeSubscriptions: []
};

// Initialize App
document.addEventListener('DOMContentLoaded', initializeApp);

async function initializeApp() {
  try {
    updateStatus('connecting');
    
    // Validate configuration
    if (!CONFIG.SUPABASE_URL || CONFIG.SUPABASE_URL === 'YOUR_SUPABASE_URL_HERE') {
      throw new Error('Supabase URL ကို CONFIG မှာ ထည့်ပေးပါ!');
    }
    
    if (!CONFIG.SUPABASE_ANON_KEY || CONFIG.SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY_HERE') {
      throw new Error('Supabase Anon Key ကို CONFIG မှာ ထည့်ပေးပါ!');
    }

    // Initialize Supabase
    if (typeof supabase !== 'undefined') {
      state.supabase = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY, {
        auth: { persistSession: false },
        realtime: { params: { eventsPerSecond: 10 } }
      });

      // Test connection
      const { data, error } = await state.supabase.from('about').select('id').limit(1);
      
      if (error && error.code !== 'PGRST116') {
        throw new Error(`Database connection failed: ${error.message}`);
      }

      updateStatus('online');
      showNotification('Database မှာ အောင်မြင်စွာ ချိတ်ဆက်ပြီးပါပြီ!', 'success');
      
      state.reconnectAttempts = 0;

      // Check for existing session
      const storedKey = localStorage.getItem('fps_access_key');
      if (storedKey) {
        document.getElementById('access-key').value = storedKey;
        await authenticateUser(true); // Silent login attempt
      }

    } else {
      throw new Error('Supabase library ကို load မလုပ်နိုင်ပါ');
    }
  } catch (error) {
    console.error('App initialization error:', error);
    updateStatus('offline');
    showNotification(`Connection error: ${error.message}`, 'error');
    
    // Retry logic
    if (state.reconnectAttempts < CONFIG.MAX_RETRY_ATTEMPTS) {
      state.reconnectAttempts++;
      setTimeout(() => {
        console.log(`Retrying connection (${state.reconnectAttempts}/${CONFIG.MAX_RETRY_ATTEMPTS})...`);
        initializeApp();
      }, CONFIG.RETRY_DELAY);
    }
  }

  // Add event listeners
  setupEventListeners();
}

function setupEventListeners() {
  // Enter key for login
  document.getElementById('access-key').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      authenticateUser();
    }
  });

  // Enter key for chat
  document.getElementById('chat-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });
}

function updateStatus(status) {
  const indicator = document.getElementById('status-indicator');
  indicator.className = 'status-indicator';
  
  switch (status) {
    case 'online':
      indicator.classList.add('status-online');
      indicator.innerHTML = '<i class="fas fa-check-circle"></i> ONLINE';
      break;
    case 'offline':
      indicator.classList.add('status-offline');
      indicator.innerHTML = '<i class="fas fa-exclamation-triangle"></i> OFFLINE';
      break;
    case 'connecting':
      indicator.classList.add('status-connecting');
      indicator.innerHTML = '<i class="fas fa-spinner fa-spin"></i> CONNECTING...';
      break;
  }
}

function showNotification(message, type = 'info', duration = 5000) {
  const container = document.getElementById('notification-container');
  const notification = document.createElement('div');
  
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <i class="fas ${getNotificationIcon(type)} mr-2"></i>
        <span>${message}</span>
      </div>
      <button onclick="this.parentElement.parentElement.remove()" class="ml-4">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `;
  
  container.appendChild(notification);
  
  setTimeout(() => {
    if (notification.parentElement) {
      notification.remove();
    }
  }, duration);
}

function getNotificationIcon(type) {
  const icons = {
    success: 'fa-check-circle',
    error: 'fa-exclamation-triangle',
    info: 'fa-info-circle',
    warning: 'fa-exclamation-circle'
  };
  return icons[type] || icons.info;
}

async function authenticateUser(silent = false) {
  const keyInput = document.getElementById('access-key');
  const key = keyInput.value.trim();
  
  if (!key && !silent) {
    showNotification('Access key ကို ထည့်ပေးပါ!', 'warning');
    return;
  }

  if (!state.supabase) {
    showNotification('Database မချိတ်ဆက်ရသေးပါ!', 'error');
    return;
  }

  try {
    if (!silent) {
      keyInput.disabled = true;
      keyInput.placeholder = 'စစ်ဆေးနေသည်...';
    }

    // Check if key exists and is active
    const { data: keyData, error: keyError } = await state.supabase
      .from('access_keys')
      .select('*')
      .eq('key_text', key)
      .eq('status', 'active')
      .single();

    if (keyError || !keyData) {
      if (!silent) {
        showNotification('မမှန်ကန်တဲ့ access key ပါ!', 'error');
        keyInput.disabled = false;
        keyInput.placeholder = 'သင့်ရဲ့ Access Key ကို ထည့်ပါ...';
      }
      return;
    }

    // Check if key has associated profile
    if (keyData.user_id) {
      const { data: profile, error: profileError } = await state.supabase
        .from('user_profiles')
        .select('*')
        .eq('access_key_id', keyData.id)
        .single();

      if (profile && !profileError) {
        state.currentUser = { ...keyData, profile };
        localStorage.setItem('fps_access_key', key);
        showMainApp();
        if (!silent) {
          showNotification(`ကြိုဆိုပါတယ် ${profile.display_name}!`, 'success');
        }
        return;
      }
    }

    // Key exists but no profile - show profile creation
    state.currentUser = keyData;
    localStorage.setItem('fps_access_key', key);
    showProfileCreation();
    if (!silent) {
      showNotification('Profile ဖန်တီးရန် လိုအပ်ပါတယ်', 'info');
    }

  } catch (error) {
    console.error('Authentication error:', error);
    showNotification('Authentication တွင် အမှား ဖြစ်ပွားခဲ့သည်!', 'error');
    if (!silent) {
      keyInput.disabled = false;
      keyInput.placeholder = 'သင့်ရဲ့ Access Key ကို ထည့်ပါ...';
    }
  }
}

function showProfileCreation() {
  document.getElementById('login-section').classList.add('hidden');
  document.getElementById('profile-creation').classList.remove('hidden');
  document.getElementById('app-content').classList.add('hidden');
}

async function createUserProfile() {
  const username = document.getElementById('username').value.trim();
  const displayName = document.getElementById('display-name').value.trim();
  const profilePic = document.getElementById('profile-pic').files[0];

  if (!username || !displayName) {
    showNotification('Username နဲ့ Display Name ကို ထည့်ပေးပါ!', 'warning');
    return;
  }

  try {
    let profilePictureUrl = null;

    // Upload profile picture if provided
    if (profilePic) {
      const fileExt = profilePic.name.split('.').pop();
      const fileName = `${state.currentUser.id}-${Date.now()}.${fileExt}`;
      
      const { data: uploadData, error: uploadError } = await state.supabase.storage
        .from('profiles')
        .upload(fileName, profilePic);

      if (!uploadError) {
        const { data } = state.supabase.storage
          .from('profiles')
          .getPublicUrl(fileName);
        profilePictureUrl = data.publicUrl;
      }
    }

    // Create user profile
    const { data: profile, error: profileError } = await state.supabase
      .from('user_profiles')
      .insert([{
        access_key_id: state.currentUser.id,
        username: username,
        display_name: displayName,
        profile_picture: profilePictureUrl
      }])
      .select()
      .single();

    if (profileError) {
      if (profileError.code === '23505') {
        showNotification('ဒီ username ကို သူတစ်ယောက်က အသုံးပြုပြီးပါပြီ!', 'error');
      } else {
        throw profileError;
      }
      return;
    }

    // Update access key with user_id
    await state.supabase
      .from('access_keys')
      .update({ 
        is_used: true, 
        used_at: new Date().toISOString(),
        user_id: profile.id 
      })
      .eq('id', state.currentUser.id);

    state.currentUser.profile = profile;
    state.currentUser.user_id = profile.id;
    
    showMainApp();
    showNotification('Profile အောင်မြင်စွာ ဖန်တီးပြီးပါပြီ!', 'success');

  } catch (error) {
    console.error('Profile creation error:', error);
    showNotification('Profile ဖန်တီးရာတွင် အမှား ဖြစ်ပွားခဲ့သည်!', 'error');
  }
}

function showMainApp() {
  document.getElementById('login-section').classList.add('hidden');
  document.getElementById('profile-creation').classList.add('hidden');
  document.getElementById('app-content').classList.remove('hidden');
  
  state.isAuthenticated = true;
  
  // Load initial data
  loadDashboardStats();
  loadNews();
  loadProducts();
  loadAboutInfo();
  loadUserProfile();
  loadSupportMessages();
  
  // Setup real-time subscriptions
  setupRealtimeSubscriptions();
}

function showSection(section, element) {
  // Remove active class from all tabs
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Add active class to clicked tab
  if (element) {
    element.classList.add('active');
  }
  
  // Hide all sections
  document.querySelectorAll('.app-section').forEach(section => {
    section.classList.add('hidden');
  });
  
  // Show selected section
  document.getElementById(`${section}-section`).classList.remove('hidden');
  state.currentSection = section;

  // Load section-specific data
  if (section === 'chat') {
    loadChatMessages();
  }
}

async function loadDashboardStats() {
  try {
    // Load various stats
    const [newsCount, productsCount, usersCount] = await Promise.all([
      state.supabase.from('news').select('id', { count: 'exact' }).eq('status', 'published'),
      state.supabase.from('admin_products').select('id', { count: 'exact' }).eq('status', 'active'),
      state.supabase.from('user_profiles').select('id', { count: 'exact' }).eq('account_status', 'active')
    ]);

    document.getElementById('total-downloads').textContent = '1,234'; // Mock data
    document.getElementById('total-products').textContent = productsCount.count || 0;
    document.getElementById('active-users').textContent = usersCount.count || 0;
    document.getElementById('chat-count').textContent = '567'; // Mock data

  } catch (error) {
    console.error('Stats loading error:', error);
  }
}

async function loadNews() {
  try {
    const { data: news, error } = await state.supabase
      .from('news')
      .select('*')
      .eq('status', 'published')
      .order('created_at', { ascending: false })
      .limit(10);

    if (error) throw error;

    const container = document.getElementById('news-container');
    
    if (!news || news.length === 0) {
      container.innerHTML = `
        <div class="text-center py-8">
          <i class="fas fa-newspaper text-4xl text-gray-400 mb-4"></i>
          <p class="text-gray-300">သတင်းများ မရှိသေးပါ</p>
        </div>
      `;
      return;
    }

    container.innerHTML = news.map(item => `
      <div class="news-item">
        <div class="flex items-start justify-between mb-3">
          <h4 class="font-bold text-lg text-myanmar-gold">${item.title}</h4>
          <span class="text-xs text-gray-400">${new Date(item.created_at).toLocaleDateString('my-MM')}</span>
        </div>
        <p class="text-gray-300 mb-4">${item.content}</p>
        ${item.media_url ? `
          <div class="mb-4">
            ${item.media_type === 'image' ? 
              `<img src="${item.media_url}" alt="News Media" class="w-full h-48 object-cover rounded-lg">` :
              item.media_type === 'video' ?
              `<video controls playsinline webkit-playsinline class="w-full h-48 rounded-lg">
                <source src="${item.media_url}" type="video/mp4">
              </video>` :
              `<audio controls class="w-full">
                <source src="${item.media_url}" type="audio/mpeg">
              </audio>`
            }
          </div>
        ` : ''}
        <div class="flex flex-wrap gap-2">
          ${item.youtube_link ? `<a href="${item.youtube_link}" target="_blank" class="text-red-400 hover:text-red-300"><i class="fab fa-youtube mr-1"></i>YouTube</a>` : ''}
          ${item.tiktok_link ? `<a href="${item.tiktok_link}" target="_blank" class="text-pink-400 hover:text-pink-300"><i class="fab fa-tiktok mr-1"></i>TikTok</a>` : ''}
          ${item.telegram_link ? `<a href="${item.telegram_link}" target="_blank" class="text-blue-400 hover:text-blue-300"><i class="fab fa-telegram mr-1"></i>Telegram</a>` : ''}
          ${item.facebook_link ? `<a href="${item.facebook_link}" target="_blank" class="text-blue-600 hover:text-blue-500"><i class="fab fa-facebook mr-1"></i>Facebook</a>` : ''}
        </div>
      </div>
    `).join('');

  } catch (error) {
    console.error('News loading error:', error);
    document.getElementById('news-container').innerHTML = `
      <div class="text-center py-8">
        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
        <p class="text-gray-300">သတင်းများ ခေါ်ရာတွင် အမှား ဖြစ်ပွားခဲ့သည်</p>
      </div>
    `;
  }
}

async function loadProducts() {
  try {
    const { data: products, error } = await state.supabase
      .from('admin_products')
      .select('*')
      .eq('status', 'active')
      .order('created_at', { ascending: false });

    if (error) throw error;

    const container = document.getElementById('products-container');
    
    if (!products || products.length === 0) {
      container.innerHTML = `
        <div class="text-center py-8">
          <i class="fas fa-box-open text-4xl text-gray-400 mb-4"></i>
          <p class="text-gray-300">Products များ မရှိသေးပါ</p>
        </div>
      `;
      return;
    }

    container.innerHTML = `
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        ${products.map(product => `
          <div class="product-item">
            <div class="flex items-center mb-4">
              ${product.icon_url ? 
                `<img src="${product.icon_url}" alt="${product.product_name}" class="w-16 h-16 rounded-lg mr-4">` :
                `<div class="w-16 h-16 bg-myanmar-purple rounded-lg flex items-center justify-center mr-4">
                  <i class="fas fa-${product.file_type === 'apk' ? 'mobile-alt' : 'file-archive'} text-2xl text-white"></i>
                </div>`
              }
              <div class="flex-1">
                <h4 class="font-bold text-myanmar-gold">${product.product_name}</h4>
                <p class="text-xs text-gray-400 uppercase">${product.file_type}</p>
              </div>
            </div>
            ${product.description ? `<p class="text-sm text-gray-300 mb-4">${product.description}</p>` : ''}
            <div class="flex items-center justify-between">
              <span class="text-lg font-bold text-myanmar-gold">
                ${product.price > 0 ? `${product.price} MMK` : 'FREE'}
              </span>
              <button onclick="purchaseProduct('${product.id}')" class="myanmar-btn btn-small">
                <i class="fas fa-${product.price > 0 ? 'shopping-cart' : 'download'} mr-1"></i>
                ${product.price > 0 ? 'BUY' : 'DOWNLOAD'}
              </button>
            </div>
          </div>
        `).join('')}
      </div>
    `;

  } catch (error) {
    console.error('Products loading error:', error);
    document.getElementById('products-container').innerHTML = `
      <div class="text-center py-8">
        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
        <p class="text-gray-300">Products များ ခေါ်ရာတွင် အမှား ဖြစ်ပွားခဲ့သည်</p>
      </div>
    `;
  }
}

async function loadChatMessages() {
  try {
    const { data: messages, error } = await state.supabase
      .from('chat_messages')
      .select(`
        *,
        user_profiles:sender_id (username, display_name, profile_picture)
      `)
      .eq('chat_type', 'global')
      .order('created_at', { ascending: true })
      .limit(50);

    if (error) throw error;

    const container = document.getElementById('chat-messages');
    
    if (!messages || messages.length === 0) {
      container.innerHTML = `
        <div class="text-center py-8">
          <i class="fas fa-comments text-4xl text-gray-400 mb-4"></i>
          <p class="text-gray-300">Chat messages များ မရှိသေးပါ</p>
        </div>
      `;
      return;
    }

    container.innerHTML = messages.map(msg => {
      const isOwn = msg.sender_id === state.currentUser.user_id;
      const profile = msg.user_profiles;
      
      return `
        <div class="chat-message ${isOwn ? 'own' : 'other'}">
          <div class="flex items-start gap-2 ${isOwn ? 'flex-row-reverse' : ''}">
            <img src="${profile?.profile_picture || 'https://via.placeholder.com/32x32/1E3A8A/FFD700?text=U'}" 
                 alt="${profile?.display_name || 'User'}" 
                 class="w-8 h-8 rounded-full">
            <div class="flex-1 ${isOwn ? 'text-right' : ''}">
              <p class="text-xs text-gray-400 mb-1">
                ${profile?.display_name || 'Anonymous'} • ${new Date(msg.created_at).toLocaleTimeString('my-MM')}
              </p>
              <p class="text-sm">${msg.message}</p>
            </div>
          </div>
        </div>
      `;
    }).join('');

    // Scroll to bottom
    container.scrollTop = container.scrollHeight;

  } catch (error) {
    console.error('Chat loading error:', error);
    document.getElementById('chat-messages').innerHTML = `
      <div class="text-center py-8">
        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
        <p class="text-gray-300">Chat messages များ ခေါ်ရာတွင် အမှား ဖြစ်ပွားခဲ့သည်</p>
      </div>
    `;
  }
}

async function sendMessage() {
  const input = document.getElementById('chat-input');
  const message = input.value.trim();

  if (!message) {
    showNotification('မက်ဆေ့ချ် ရိုက်ပေးပါ!', 'warning');
    return;
  }

  if (!state.currentUser.user_id) {
    showNotification('Login လုပ်ထားရပါမယ်!', 'error');
    return;
  }

  try {
    const { error } = await state.supabase
      .from('chat_messages')
      .insert([{
        chat_type: 'global',
        sender_id: state.currentUser.user_id,
        message: message,
        message_type: 'text'
      }]);

    if (error) throw error;

    input.value = '';
    // Message will be added via real-time subscription

  } catch (error) {
    console.error('Send message error:', error);
    showNotification('မက်ဆေ့ချ် ပို့ရာတွင် အမှား ဖြစ်ပွားခဲ့သည်!', 'error');
  }
}

async function loadAboutInfo() {
  try {
    const { data: about, error } = await state.supabase
      .from('about')
      .select('*')
      .limit(1)
      .single();

    if (error && error.code !== 'PGRST116') throw error;

    const container = document.getElementById('about-content');
    
    if (!about) {
      container.innerHTML = `
        <div class="text-center py-8">
          <i class="fas fa-info-circle text-4xl text-gray-400 mb-4"></i>
          <p class="text-gray-300">About information မရှိသေးပါ</p>
        </div>
      `;
      return;
    }

    container.innerHTML = `
      <div class="space-y-6">
        ${about.contact_name ? `
          <div class="flex items-center gap-3">
            <i class="fas fa-user text-myanmar-gold text-xl"></i>
            <div>
              <h4 class="font-semibold">Contact Person</h4>
              <p class="text-gray-300">${about.contact_name}</p>
            </div>
          </div>
        ` : ''}
        
        ${about.phone_number ? `
          <div class="flex items-center gap-3">
            <i class="fas fa-phone text-myanmar-gold text-xl"></i>
            <div>
              <h4 class="font-semibold">Phone Number</h4>
              <p class="text-gray-300">${about.phone_number}</p>
            </div>
          </div>
        ` : ''}
        
        ${about.email ? `
          <div class="flex items-center gap-3">
            <i class="fas fa-envelope text-myanmar-gold text-xl"></i>
            <div>
              <h4 class="font-semibold">Email</h4>
              <p class="text-gray-300">${about.email}</p>
            </div>
          </div>
        ` : ''}
        
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
          ${about.telegram_link ? `
            <a href="${about.telegram_link}" target="_blank" class="flex items-center justify-center p-3 bg-blue-600 rounded-lg hover:bg-blue-500 transition">
              <i class="fab fa-telegram text-xl mr-2"></i>
              Telegram
            </a>
          ` : ''}
          
          ${about.viber_link ? `
            <a href="${about.viber_link}" target="_blank" class="flex items-center justify-center p-3 bg-purple-600 rounded-lg hover:bg-purple-500 transition">
              <i class="fab fa-viber text-xl mr-2"></i>
              Viber
            </a>
          ` : ''}
          
          ${about.facebook_link ? `
            <a href="${about.facebook_link}" target="_blank" class="flex items-center justify-center p-3 bg-blue-800 rounded-lg hover:bg-blue-700 transition">
              <i class="fab fa-facebook text-xl mr-2"></i>
              Facebook
            </a>
          ` : ''}
          
          ${about.tiktok_link ? `
            <a href="${about.tiktok_link}" target="_blank" class="flex items-center justify-center p-3 bg-pink-600 rounded-lg hover:bg-pink-500 transition">
              <i class="fab fa-tiktok text-xl mr-2"></i>
              TikTok
            </a>
          ` : ''}
        </div>
      </div>
    `;

  } catch (error) {
    console.error('About loading error:', error);
    document.getElementById('about-content').innerHTML = `
      <div class="text-center py-8">
        <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
        <p class="text-gray-300">About information ခေါ်ရာတွင် အမှား ဖြစ်ပွားခဲ့သည်</p>
      </div>
    `;
  }
}

async function loadUserProfile() {
  if (!state.currentUser?.profile) return;

  const profile = state.currentUser.profile;
  
  // Update profile display
  document.getElementById('profile-image').src = profile.profile_picture || 'https://via.placeholder.com/150x150/1E3A8A/FFD700?text=USER';
  document.getElementById('profile-name').textContent = profile.display_name;
  document.getElementById('profile-username').textContent = `@${profile.username}`;
  
  const statusElement = document.getElementById('profile-status');
  statusElement.textContent = profile.account_status.toUpperCase();
  statusElement.className = `inline-block px-4 py-2 rounded-full text-sm font-semibold ${
    profile.account_status === 'active' ? 'bg-green-600' :
    profile.account_status === 'banned' ? 'bg-red-600' :
    'bg-yellow-600'
  }`;
  
  // Fill edit form
  document.getElementById('edit-display-name').value = profile.display_name;
  
  // Load KYC status
  await loadKYCStatus();
}

async function loadKYCStatus() {
  try {
    const { data: kyc, error } = await state.supabase
      .from('kyc_documents')
      .select('*')
      .eq('user_id', state.currentUser.user_id)
      .order('submitted_at', { ascending: false })
      .limit(1)
      .single();

    const kycContent = document.getElementById('kyc-content');
    
    if (error && error.code !== 'PGRST116') throw error;

    if (!kyc) {
      // No KYC submitted
      kycContent.innerHTML = `
        <div class="space-y-4">
          <p class="text-sm text-gray-300">KYC verification မရှိသေးပါ။ အရောင်းအဝယ် လုပ်ကိုင်ရန် KYC လုပ်ရပါမယ်။</p>
          <button onclick="showKYCForm()" class="myanmar-btn">
            <i class="fas fa-id-card mr-2"></i>START KYC VERIFICATION
          </button>
        </div>
      `;
    } else {
      // KYC exists - show status
      const statusColors = {
        pending: 'bg-yellow-600',
        approved: 'bg-green-600',
        rejected: 'bg-red-600'
      };
      
      kycContent.innerHTML = `
        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <span>KYC Status:</span>
            <span class="px-3 py-1 rounded-full text-sm font-semibold ${statusColors[kyc.status]}">
              ${kyc.status.toUpperCase()}
            </span>
          </div>
          <p class="text-sm text-gray-300">
            Submitted: ${new Date(kyc.submitted_at).toLocaleDateString('my-MM')}
          </p>
          ${kyc.reviewer_notes ? `
            <div class="bg-gray-800 p-3 rounded-lg">
              <h5 class="font-semibold mb-2">Admin Notes:</h5>
              <p class="text-sm text-gray-300">${kyc.reviewer_notes}</p>
            </div>
          ` : ''}
          ${kyc.status === 'rejected' ? `
            <button onclick="showKYCForm()" class="myanmar-btn">
              <i class="fas fa-redo mr-2"></i>RESUBMIT KYC
            </button>
          ` : ''}
        </div>
      `;
    }

  } catch (error) {
    console.error('KYC loading error:', error);
  }
}

function showKYCForm() {
  // This would show a KYC submission form
  // Implementation would include file uploads for ID documents
  showNotification('KYC form ကို admin dashboard မှာ စီမံခန့်ခွဲပါတယ်', 'info');
}

async function updateProfile() {
  const newDisplayName = document.getElementById('edit-display-name').value.trim();
  const newProfilePic = document.getElementById('edit-profile-pic').files[0];

  if (!newDisplayName) {
    showNotification('Display name ကို ထည့်ပေးပါ!', 'warning');
    return;
  }

  try {
    let updateData = { display_name: newDisplayName };

    // Upload new profile picture if provided
    if (newProfilePic) {
      const fileExt = newProfilePic.name.split('.').pop();
      const fileName = `${state.currentUser.user_id}-${Date.now()}.${fileExt}`;
      
      const { data: uploadData, error: uploadError } = await state.supabase.storage
        .from('profiles')
        .upload(fileName, newProfilePic);

      if (!uploadError) {
        const { data } = state.supabase.storage
          .from('profiles')
          .getPublicUrl(fileName);
        updateData.profile_picture = data.publicUrl;
      }
    }

    const { data, error } = await state.supabase
      .from('user_profiles')
      .update(updateData)
      .eq('id', state.currentUser.user_id)
      .select()
      .single();

    if (error) throw error;

    // Update current user data
    state.currentUser.profile = { ...state.currentUser.profile, ...data };
    
    // Refresh profile display
    loadUserProfile();
    
    showNotification('Profile အောင်မြင်စွာ update လုပ်ပြီးပါပြီ!', 'success');

  } catch (error) {
    console.error('Profile update error:', error);
    showNotification('Profile update လုပ်ရာတွင် အမှား ဖြစ်ပွားခဲ့သည်!', 'error');
  }
}

async function loadSupportMessages() {
  if (!state.currentUser?.user_id) return;

  try {
    const { data: messages, error } = await state.supabase
      .from('support_messages')
      .select('*')
      .eq('user_id', state.currentUser.user_id)
      .order('created_at', { ascending: false });

    if (error) throw error;

    const container = document.getElementById('support-messages');
    
    if (!messages || messages.length === 0) {
      container.innerHTML = `
        <div class="text-center py-4">
          <i class="fas fa-inbox text-2xl text-gray-400 mb-2"></i>
          <p class="text-sm text-gray-300">Support messages မရှိသေးပါ</p>
        </div>
      `;
      return;
    }

    container.innerHTML = messages.map(msg => `
      <div class="glass-card p-4">
        <div class="flex items-center justify-between mb-2">
          <h5 class="font-semibold">${msg.subject || 'No Subject'}</h5>
          <div class="flex items-center gap-2">
            <span class="px-2 py-1 rounded text-xs font-semibold ${
              msg.status === 'open' ? 'bg-yellow-600' :
              msg.status === 'replied' ? 'bg-blue-600' :
              'bg-gray-600'
            }">
              ${msg.status.toUpperCase()}
            </span>
            <span class="text-xs text-gray-400">
              ${new Date(msg.created_at).toLocaleDateString('my-MM')}
            </span>
          </div>
        </div>
        <p class="text-sm text-gray-300">${msg.message}</p>
      </div>
    `).join('');

  } catch (error) {
    console.error('Support messages loading error:', error);
  }
}

async function sendSupportMessage() {
  const subject = document.getElementById('support-subject').value.trim();
  const message = document.getElementById('support-message').value.trim();

  if (!subject || !message) {
    showNotification('Subject နဲ့ Message နှစ်ခုလုံး ထည့်ပေးပါ!', 'warning');
    return;
  }

  if (!state.currentUser?.user_id) {
    showNotification('Login လုပ်ထားရပါမယ်!', 'error');
    return;
  }

  try {
    const { error } = await state.supabase
      .from('support_messages')
      .insert([{
        user_id: state.currentUser.user_id,
        subject: subject,
        message: message
      }]);

    if (error) throw error;

    // Clear form
    document.getElementById('support-subject').value = '';
    document.getElementById('support-message').value = '';
    
    // Reload messages
    loadSupportMessages();
    
    showNotification('Support message အောင်မြင်စွာ ပို့ပြီးပါပြီ!', 'success');

  } catch (error) {
    console.error('Send support message error:', error);
    showNotification('Support message ပို့ရာတွင် အမှား ဖြစ်ပွားခဲ့သည်!', 'error');
  }
}

async function purchaseProduct(productId) {
  try {
    const { data: product, error } = await state.supabase
      .from('admin_products')
      .select('*')
      .eq('id', productId)
      .single();

    if (error) throw error;

    if (product.price === 0) {
      // Free product - direct download
      if (product.file_url) {
        // Create download link
        const link = document.createElement('a');
        link.href = product.file_url;
        link.download = product.product_name;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification(`${product.product_name} ကို အောင်မြင်စွာ download လုပ်ပြီးပါပြီ!`, 'success');
      }
    } else {
      // Paid product - show payment modal
      showPaymentModal(product);
    }

  } catch (error) {
    console.error('Purchase product error:', error);
    showNotification('Product purchase လုပ်ရာတွင် အမှား ဖြစ်ပွားခဲ့သည်!', 'error');
  }
}

async function showPaymentModal(product) {
  try {
    const { data: paymentMethods, error } = await state.supabase
      .from('payment_methods')
      .select('*')
      .eq('status', 'active');

    if (error) throw error;

    const modal = document.getElementById('payment-modal');
    const content = document.getElementById('payment-modal-content');
    
    content.innerHTML = `
      <div class="space-y-6">
        <div class="text-center">
          <h4 class="text-xl font-bold mb-2">${product.product_name}</h4>
          <p class="text-2xl font-bold text-myanmar-gold">${product.price} MMK</p>
        </div>
        
        <div>
          <h5 class="font-semibold mb-3">Payment Method ရွေးချယ်ပါ:</h5>
          <div class="space-y-3">
            ${paymentMethods.map(method => `
              <div class="glass-card p-4 cursor-pointer hover:border-myanmar-gold" onclick="selectPaymentMethod('${method.id}')">
                <div class="flex items-center justify-between">
                  <div>
                    <h6 class="font-semibold">${method.method_name}</h6>
                    <p class="text-sm text-gray-300">${method.account_info}</p>
                  </div>
                  ${method.qr_code_image ? `<i class="fas fa-qrcode text-myanmar-gold"></i>` : ''}
                </div>
              </div>
            `).join('')}
          </div>
        </div>
        
        <div id="payment-details" class="hidden">
          <!-- Payment details will be shown here after method selection -->
        </div>
      </div>
    `;
    
    modal.classList.remove('hidden');
    window.currentProduct = product;

  } catch (error) {
    console.error('Payment modal error:', error);
    showNotification('Payment methods ခေါ်ရာတွင် အမှား ဖြစ်ပွားခဲ့သည်!', 'error');
  }
}

function selectPaymentMethod(methodId) {
  // Implementation for payment method selection and order creation
  showNotification('Payment method selection ကို admin dashboard မှာ စီမံခန့်ခွဲပါတယ်', 'info');
}

function closeProductModal() {
  document.getElementById('product-modal').classList.add('hidden');
}

function closePaymentModal() {
  document.getElementById('payment-modal').classList.add('hidden');
}

function setupRealtimeSubscriptions() {
  // Subscribe to chat messages
  const chatSubscription = state.supabase
    .channel('public:chat_messages')
    .on('postgres_changes', 
      { 
        event: 'INSERT', 
        schema: 'public', 
        table: 'chat_messages',
        filter: 'chat_type=eq.global'
      }, 
      (payload) => {
        if (state.currentSection === 'chat') {
          loadChatMessages();
        }
      }
    )
    .subscribe();

  // Subscribe to news updates
  const newsSubscription = state.supabase
    .channel('public:news')
    .on('postgres_changes', 
      { 
        event: '*', 
        schema: 'public', 
        table: 'news'
      }, 
      (payload) => {
        if (state.currentSection === 'news') {
          loadNews();
        }
        loadDashboardStats(); // Update stats
      }
    )
    .subscribe();

  state.realtimeSubscriptions.push(chatSubscription, newsSubscription);
}

function logoutUser() {
  // Clean up subscriptions
  state.realtimeSubscriptions.forEach(subscription => {
    subscription.unsubscribe();
  });
  state.realtimeSubscriptions = [];

  // Clear state
  state.currentUser = null;
  state.isAuthenticated = false;
  
  // Clear localStorage
  localStorage.removeItem('fps_access_key');
  
  // Show login section
  document.getElementById('app-content').classList.add('hidden');
  document.getElementById('profile-creation').classList.add('hidden');
  document.getElementById('login-section').classList.remove('hidden');
  
  // Reset form
  document.getElementById('access-key').value = '';
  document.getElementById('access-key').disabled = false;
  document.getElementById('access-key').placeholder = 'သင့်ရဲ့ Access Key ကို ထည့်ပါ...';
  
  showNotification('အောင်မြင်စွာ logout လုပ်ပြီးပါပြီ!', 'success');
}

// Add utility CSS classes
const style = document.createElement('style');
style.textContent = `
  .btn-small {
    padding: 6px 12px !important;
    font-size: 12px !important;
  }
  .myanmar-btn.btn-small {
    padding: 6px 12px !important;
    font-size: 12px !important;
  }
`;
document.head.appendChild(style);
</script>
</body>
</html>
