<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>FPS GFX Tool - မြန်မာ</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&family=Noto+Sans+Myanmar:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/bcryptjs@2.4.3/dist/bcrypt.min.js"></script>
<style>
/* Custom Fonts */
body {
  font-family: 'Noto Sans Myanmar', 'Inter', sans-serif;
}
h1, h2, h3, .font-orbitron {
  font-family: 'Orbitron', sans-serif;
}
.font-share-tech {
  font-family: 'Share Tech Mono', monospace;
}

/* Color Palette */
:root {
  --primary-bg: hsl(220 20% 8%);
  --secondary-bg: hsl(220 20% 12%);
  --accent-color: hsl(200 100% 50%);
  --accent-hover: hsl(200 100% 60%);
  --success-color: hsl(120 100% 40%);
  --warning-color: hsl(45 100% 50%);
  --error-color: hsl(0 100% 50%);
  --text-primary: hsl(0 0% 95%);
  --text-secondary: hsl(0 0% 70%);
  --border-color: hsl(220 20% 20%);
}

body {
  background: linear-gradient(135deg, var(--primary-bg) 0%, hsl(220 25% 10%) 100%);
  color: var(--text-primary);
  min-height: 100vh;
}

/* Glassmorphism Effect */
.glass {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
}

.glass-dark {
  background: rgba(0, 0, 0, 0.3);
  backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
}

/* Neon Effects */
.neon-border {
  border: 2px solid transparent;
  background: linear-gradient(var(--secondary-bg), var(--secondary-bg)) padding-box,
              linear-gradient(45deg, var(--accent-color), var(--success-color)) border-box;
  border-radius: 12px;
}

.neon-glow {
  box-shadow: 0 0 20px rgba(0, 200, 255, 0.3);
}

.btn-neon {
  background: linear-gradient(45deg, var(--accent-color), var(--success-color));
  border: none;
  border-radius: 8px;
  padding: 12px 24px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.btn-neon:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 200, 255, 0.4);
}

.btn-danger {
  background: linear-gradient(45deg, var(--error-color), #ff6b6b);
}

.btn-warning {
  background: linear-gradient(45deg, var(--warning-color), #ffa726);
}

/* Animations */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.animate-slide-up {
  animation: slideInUp 0.5s ease-out;
}

.animate-fade-in {
  animation: fadeIn 0.3s ease-out;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--primary-bg);
}

::-webkit-scrollbar-thumb {
  background: var(--accent-color);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--accent-hover);
}

/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(5px);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: var(--secondary-bg);
  padding: 2rem;
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;
}

/* Form Styles */
.form-group {
  margin-bottom: 1.5rem;
}

.form-label {
  display: block;
  margin-bottom: 0.5rem;
  color: var(--text-secondary);
  font-weight: 500;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  color: var(--text-primary);
  font-size: 14px;
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: var(--accent-color);
  box-shadow: 0 0 10px rgba(0, 200, 255, 0.2);
}

.form-textarea {
  resize: vertical;
  min-height: 100px;
}

/* Navigation Styles */
.nav-item {
  padding: 12px 20px;
  margin: 4px 0;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 12px;
}

.nav-item:hover {
  background: rgba(0, 200, 255, 0.1);
  transform: translateX(4px);
}

.nav-item.active {
  background: linear-gradient(90deg, var(--accent-color), var(--success-color));
  color: white;
}

/* Product Card Styles */
.product-card {
  background: var(--secondary-bg);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s ease;
  cursor: pointer;
}

.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 200, 255, 0.2);
  border-color: var(--accent-color);
}

/* Chat Styles */
.chat-container {
  height: 400px;
  overflow-y: auto;
  padding: 1rem;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  margin-bottom: 1rem;
}

.chat-message {
  margin-bottom: 1rem;
  padding: 0.75rem;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.05);
}

.chat-message.own {
  background: rgba(0, 200, 255, 0.2);
  margin-left: 2rem;
}

.chat-message.other {
  background: rgba(255, 255, 255, 0.05);
  margin-right: 2rem;
}

/* Status Badges */
.badge {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
}

.badge-success {
  background: rgba(0, 255, 0, 0.2);
  color: #4ade80;
  border: 1px solid #4ade80;
}

.badge-warning {
  background: rgba(255, 200, 0, 0.2);
  color: #fbbf24;
  border: 1px solid #fbbf24;
}

.badge-error {
  background: rgba(255, 0, 0, 0.2);
  color: #ef4444;
  border: 1px solid #ef4444;
}

.badge-info {
  background: rgba(0, 200, 255, 0.2);
  color: #3b82f6;
  border: 1px solid #3b82f6;
}

/* Loading Animation */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: var(--accent-color);
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
  .modal-content {
    margin: 1rem;
    padding: 1.5rem;
  }
  
  .grid {
    grid-template-columns: 1fr;
  }
}

/* Hide scrollbar for chat */
.chat-container::-webkit-scrollbar {
  width: 4px;
}

/* File upload styles */
.file-upload {
  position: relative;
  overflow: hidden;
  display: inline-block;
  cursor: pointer;
  width: 100%;
}

.file-upload input[type=file] {
  position: absolute;
  left: -9999px;
}

.file-upload-label {
  display: block;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.05);
  border: 2px dashed rgba(255, 255, 255, 0.3);
  border-radius: 8px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.file-upload-label:hover {
  border-color: var(--accent-color);
  background: rgba(0, 200, 255, 0.05);
}

/* Image preview styles */
.image-preview {
  max-width: 200px;
  max-height: 200px;
  border-radius: 8px;
  margin-top: 10px;
  border: 1px solid rgba(255, 255, 255, 0.2);
}
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading-screen" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
  <div class="text-center">
    <div class="loading mb-4"></div>
    <p class="text-xl font-orbitron">FPS GFX Tool ကို တင်နေသည်...</p>
  </div>
</div>

<!-- Authentication Modal -->
<div id="auth-modal" class="modal">
  <div class="modal-content w-full max-w-md">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-orbitron text-white">အကောင့်ဝင်ရောက်ခြင်း</h2>
      <button onclick="closeModal('auth-modal')" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Login Form -->
    <div id="login-form">
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label class="form-label">အီးမေးလ်</label>
          <input type="email" class="form-input" id="login-email" required>
        </div>
        <div class="form-group">
          <label class="form-label">စကားဝှက်</label>
          <input type="password" class="form-input" id="login-password" required>
        </div>
        <button type="submit" class="btn-neon w-full mb-4">
          <i class="fas fa-sign-in-alt mr-2"></i>အကောင့်ဝင်ရောက်ရန်
        </button>
      </form>
      <p class="text-center text-gray-400">
        အကောင့်မရှိသေးဘူးလား? 
        <button onclick="showSignupForm()" class="text-blue-400 hover:text-blue-300">အကောင့်ဖွင့်ရန်</button>
      </p>
    </div>

    <!-- Signup Form -->
    <div id="signup-form" style="display: none;">
      <form onsubmit="handleSignup(event)">
        <div class="form-group">
          <label class="form-label">အီးမေးလ်</label>
          <input type="email" class="form-input" id="signup-email" required>
        </div>
        <div class="form-group">
          <label class="form-label">စကားဝှက်</label>
          <input type="password" class="form-input" id="signup-password" required minlength="6">
        </div>
        <div class="form-group">
          <label class="form-label">စကားဝှက်အတည်ပြုရန်</label>
          <input type="password" class="form-input" id="signup-confirm-password" required minlength="6">
        </div>
        <div class="form-group">
          <label class="form-label">အသုံးပြုသူအမည်</label>
          <input type="text" class="form-input" id="signup-username" required>
        </div>
        <div class="form-group">
          <label class="form-label">ပြသမည့်အမည်</label>
          <input type="text" class="form-input" id="signup-display-name" required>
        </div>
        <div class="form-group">
          <label class="form-label">ပရိုဖိုင်ပုံ (ရွေးချယ်ခွင့်ရှိသည်)</label>
          <div class="file-upload">
            <input type="file" id="signup-profile-picture" accept="image/*">
            <label for="signup-profile-picture" class="file-upload-label">
              <i class="fas fa-camera mr-2"></i>ပုံရွေးချယ်ရန်
            </label>
          </div>
          <img id="signup-preview" class="image-preview" style="display: none;">
        </div>
        <button type="submit" class="btn-neon w-full mb-4">
          <i class="fas fa-user-plus mr-2"></i>အကောင့်ဖွင့်ရန်
        </button>
      </form>
      <p class="text-center text-gray-400">
        အကောင့်ရှိပြီးသားလား? 
        <button onclick="showLoginForm()" class="text-blue-400 hover:text-blue-300">အကောင့်ဝင်ရောက်ရန်</button>
      </p>
    </div>
  </div>
</div>

<!-- Main Application -->
<div id="main-app" style="display: none;">
  <!-- Header -->
  <header class="glass-dark sticky top-0 z-40 p-4">
    <div class="container mx-auto flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <h1 class="text-2xl font-orbitron font-bold neon-glow">FPS GFX Tool</h1>
        <div class="hidden md:block">
          <div class="flex items-center space-x-2 text-sm">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <span class="text-green-400">လိုင်းပေါ်တွင်ရှိသည်</span>
          </div>
        </div>
      </div>
      
      <div class="flex items-center space-x-4">
        <div class="flex items-center space-x-2">
          <img id="header-profile-pic" class="w-8 h-8 rounded-full border-2 border-blue-400" src="https://via.placeholder.com/40">
          <span id="header-username" class="text-sm font-medium">အသုံးပြုသူ</span>
        </div>
        <button onclick="showProfile()" class="nav-item">
          <i class="fas fa-user"></i>
        </button>
        <button onclick="logout()" class="nav-item text-red-400">
          <i class="fas fa-sign-out-alt"></i>
        </button>
      </div>
    </div>
  </header>

  <div class="container mx-auto p-4 grid grid-cols-1 lg:grid-cols-4 gap-6">
    <!-- Sidebar Navigation -->
    <div class="lg:col-span-1">
      <nav class="glass p-6 rounded-xl sticky top-24">
        <div class="space-y-2">
          <div class="nav-item active" onclick="showSection('dashboard')">
            <i class="fas fa-tachometer-alt"></i>
            <span>ပင်မစာမျက်နှာ</span>
          </div>
          <div class="nav-item" onclick="showSection('products')">
            <i class="fas fa-box"></i>
            <span>ထုတ်ကုန်များ</span>
          </div>
          <div class="nav-item" onclick="showSection('user-products')">
            <i class="fas fa-store"></i>
            <span>အသုံးပြုသူထုတ်ကုန်များ</span>
          </div>
          <div class="nav-item" onclick="showSection('my-purchases')">
            <i class="fas fa-shopping-cart"></i>
            <span>ကျွန်ုပ်၏ဝယ်ယူမှုများ</span>
          </div>
          <div class="nav-item" onclick="showSection('seller-dashboard')" id="seller-nav" style="display: none;">
            <i class="fas fa-chart-line"></i>
            <span>ရောင်းချသူစာမျက်နှာ</span>
          </div>
          <div class="nav-item" onclick="showSection('global-chat')">
            <i class="fas fa-comments"></i>
            <span>စကားပြောခန်း</span>
          </div>
          <div class="nav-item" onclick="showSection('private-chat')">
            <i class="fas fa-comment"></i>
            <span>ကိုယ်ရေးကိုယ်တာစကားပြော</span>
          </div>
          <div class="nav-item" onclick="showSection('support')">
            <i class="fas fa-life-ring"></i>
            <span>အကူအညီ</span>
          </div>
          <div class="nav-item" onclick="showSection('kyc')">
            <i class="fas fa-id-card"></i>
            <span>အထောက်အထားစာရွက်</span>
          </div>
          <div class="nav-item" onclick="showSection('news')">
            <i class="fas fa-newspaper"></i>
            <span>သတင်းများ</span>
          </div>
          <div class="nav-item" onclick="showSection('about')">
            <i class="fas fa-info-circle"></i>
            <span>ကျွန်ုပ်တို့အကြောင်း</span>
          </div>
        </div>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="lg:col-span-3">
      <!-- Dashboard Section -->
      <div id="dashboard-section" class="section">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">ကြိုဆိုပါသည်</h2>
          
          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="neon-border p-4 text-center">
              <i class="fas fa-download text-3xl text-blue-400 mb-2"></i>
              <h3 class="text-xl font-bold" id="total-downloads">0</h3>
              <p class="text-gray-400">စုစုပေါင်းဒေါင်းလုဒ်</p>
            </div>
            <div class="neon-border p-4 text-center">
              <i class="fas fa-box text-3xl text-green-400 mb-2"></i>
              <h3 class="text-xl font-bold" id="available-products">0</h3>
              <p class="text-gray-400">ရရှိနိုင်သောထုတ်ကုန်များ</p>
            </div>
            <div class="neon-border p-4 text-center">
              <i class="fas fa-shopping-cart text-3xl text-yellow-400 mb-2"></i>
              <h3 class="text-xl font-bold" id="total-purchases">0</h3>
              <p class="text-gray-400">ဝယ်ယူမှုများ</p>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="glass-dark p-4 rounded-lg">
            <h3 class="text-xl font-bold mb-4">လတ်တလောလှုပ်ရှားမှုများ</h3>
            <div id="recent-activity" class="space-y-2 text-gray-300">
              <p>လှုပ်ရှားမှုများကိုတင်နေသည်...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Products Section -->
      <div id="products-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">ထုတ်ကုန်များ</h2>
          
          <!-- Search and Filter -->
          <div class="mb-6 flex flex-col md:flex-row gap-4">
            <input type="text" placeholder="ထုတ်ကုန်ရှာဖွေရန်..." class="form-input flex-1" id="product-search">
            <select class="form-input" id="product-filter">
              <option value="all">အားလုံး</option>
              <option value="free">အခမဲ့</option>
              <option value="paid">ငွေပေးချေရသည်</option>
            </select>
          </div>

          <!-- Products Grid -->
          <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Products will be loaded here -->
          </div>
        </div>
      </div>

      <!-- User Products Section -->
      <div id="user-products-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">အသုံးပြုသူထုတ်ကုန်များ</h2>
          
          <!-- Search -->
          <div class="mb-6">
            <input type="text" placeholder="အသုံးပြုသူထုတ်ကုန်ရှာဖွေရန်..." class="form-input" id="user-product-search">
          </div>

          <!-- User Products Grid -->
          <div id="user-products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- User products will be loaded here -->
          </div>
        </div>
      </div>

      <!-- My Purchases Section -->
      <div id="my-purchases-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">ကျွန်ုပ်၏ဝယ်ယူမှုများ</h2>
          
          <div id="my-purchases-list" class="space-y-4">
            <!-- Purchases will be loaded here -->
          </div>
        </div>
      </div>

      <!-- Seller Dashboard Section -->
      <div id="seller-dashboard-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">ရောင်းချသူစာမျက်နှာ</h2>
          
          <!-- Seller Stats -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="neon-border p-4 text-center">
              <i class="fas fa-box text-3xl text-blue-400 mb-2"></i>
              <h3 class="text-xl font-bold" id="my-products-count">0</h3>
              <p class="text-gray-400">ကျွန်ုပ်၏ထုတ်ကုန်များ</p>
            </div>
            <div class="neon-border p-4 text-center">
              <i class="fas fa-shopping-cart text-3xl text-green-400 mb-2"></i>
              <h3 class="text-xl font-bold" id="my-orders-count">0</h3>
              <p class="text-gray-400">အမိန့်များ</p>
            </div>
            <div class="neon-border p-4 text-center">
              <i class="fas fa-money-bill text-3xl text-yellow-400 mb-2"></i>
              <h3 class="text-xl font-bold" id="total-earnings">0</h3>
              <p class="text-gray-400">စုစုပေါင်းဝင်ငွေ</p>
            </div>
            <div class="neon-border p-4 text-center">
              <i class="fas fa-star text-3xl text-purple-400 mb-2"></i>
              <h3 class="text-xl font-bold" id="seller-rating">5.0</h3>
              <p class="text-gray-400">အဆင့်သတ်မှတ်ချက်</p>
            </div>
          </div>

          <!-- Add Product Button -->
          <button onclick="showAddProductModal()" class="btn-neon mb-6">
            <i class="fas fa-plus mr-2"></i>ထုတ်ကုန်အသစ်ထည့်ရန်
          </button>

          <!-- My Products -->
          <div class="glass-dark p-4 rounded-lg mb-6">
            <h3 class="text-xl font-bold mb-4">ကျွန်ုပ်၏ထုတ်ကုန်များ</h3>
            <div id="seller-products-list" class="space-y-4">
              <!-- Seller products will be loaded here -->
            </div>
          </div>

          <!-- Payment Methods -->
          <div class="glass-dark p-4 rounded-lg mb-6">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-bold">ငွေပေးချေရေးနည်းလမ်းများ</h3>
              <button onclick="showAddPaymentMethodModal()" class="btn-neon text-sm">
                <i class="fas fa-plus mr-2"></i>အသစ်ထည့်ရန်
              </button>
            </div>
            <div id="seller-payment-methods" class="space-y-2">
              <!-- Payment methods will be loaded here -->
            </div>
          </div>

          <!-- Orders -->
          <div class="glass-dark p-4 rounded-lg">
            <h3 class="text-xl font-bold mb-4">အမိန့်များ</h3>
            <div id="seller-orders-list" class="space-y-4">
              <!-- Orders will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Global Chat Section -->
      <div id="global-chat-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">စကားပြောခန်း</h2>
          
          <div class="chat-container" id="global-chat-messages">
            <!-- Chat messages will be loaded here -->
          </div>

          <form onsubmit="sendGlobalMessage(event)" class="flex gap-2">
            <input type="text" placeholder="မက်ဆေ့ခ်ရေးပါ..." class="form-input flex-1" id="global-chat-input" required>
            <button type="submit" class="btn-neon">
              <i class="fas fa-paper-plane"></i>
            </button>
          </form>
        </div>
      </div>

      <!-- Private Chat Section -->
      <div id="private-chat-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">ကိုယ်ရေးကိုယ်တာစကားပြော</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Chat List -->
            <div class="glass-dark p-4 rounded-lg">
              <h3 class="text-lg font-bold mb-4">စကားပြောခန်းများ</h3>
              <div id="private-chat-list" class="space-y-2">
                <!-- Chat list will be loaded here -->
              </div>
            </div>

            <!-- Chat Window -->
            <div class="md:col-span-2">
              <div id="private-chat-window" class="glass-dark p-4 rounded-lg">
                <div class="text-center text-gray-400 py-8">
                  စကားပြောခန်းတစ်ခုရွေးချယ်ပါ
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Support Section -->
      <div id="support-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">အကူအညီ</h2>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Create Support Ticket -->
            <div class="glass-dark p-4 rounded-lg">
              <h3 class="text-xl font-bold mb-4">အကူအညီတောင်းခံရန်</h3>
              <form onsubmit="createSupportTicket(event)">
                <div class="form-group">
                  <label class="form-label">ခေါင်းစဉ်</label>
                  <input type="text" class="form-input" id="support-subject" required>
                </div>
                <div class="form-group">
                  <label class="form-label">မက်ဆေ့ခ်</label>
                  <textarea class="form-input form-textarea" id="support-message" required></textarea>
                </div>
                <button type="submit" class="btn-neon w-full">
                  <i class="fas fa-paper-plane mr-2"></i>ပို့ရန်
                </button>
              </form>
            </div>

            <!-- Support Tickets -->
            <div class="glass-dark p-4 rounded-lg">
              <h3 class="text-xl font-bold mb-4">ကျွန်ုပ်၏အကူအညီတောင်းခံမှုများ</h3>
              <div id="support-tickets-list" class="space-y-4">
                <!-- Support tickets will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- KYC Section -->
      <div id="kyc-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">အထောက်အထားစာရွက်စာတမ်း (KYC)</h2>
          
          <div id="kyc-status-card" class="neon-border p-6 mb-6 text-center">
            <!-- KYC status will be shown here -->
          </div>

          <div id="kyc-form-container">
            <!-- KYC form will be shown here -->
          </div>
        </div>
      </div>

      <!-- News Section -->
      <div id="news-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">သတင်းများ</h2>
          
          <div id="news-list" class="space-y-6">
            <!-- News will be loaded here -->
          </div>
        </div>
      </div>

      <!-- About Section -->
      <div id="about-section" class="section" style="display: none;">
        <div class="glass p-6 rounded-xl animate-slide-up">
          <h2 class="text-3xl font-orbitron font-bold mb-6 neon-glow">ကျွန်ုပ်တို့အကြောင်း</h2>
          
          <div id="about-content" class="glass-dark p-6 rounded-lg">
            <!-- About content will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Product Details Modal -->
<div id="product-details-modal" class="modal">
  <div class="modal-content max-w-2xl">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-orbitron font-bold">ထုတ်ကုန်အသေးစိတ်</h2>
      <button onclick="closeModal('product-details-modal')" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="product-details-content">
      <!-- Product details will be loaded here -->
    </div>
  </div>
</div>

<!-- Purchase Modal -->
<div id="purchase-modal" class="modal">
  <div class="modal-content max-w-lg">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-orbitron font-bold">ဝယ်ယူရန်</h2>
      <button onclick="closeModal('purchase-modal')" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="purchase-content">
      <!-- Purchase form will be loaded here -->
    </div>
  </div>
</div>

<!-- Add Product Modal -->
<div id="add-product-modal" class="modal">
  <div class="modal-content max-w-2xl">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-orbitron font-bold">ထုတ်ကုန်အသစ်ထည့်ရန်</h2>
      <button onclick="closeModal('add-product-modal')" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <form onsubmit="addSellerProduct(event)">
      <div class="form-group">
        <label class="form-label">ထုတ်ကုန်အမည်</label>
        <input type="text" class="form-input" id="new-product-name" required>
      </div>
      <div class="form-group">
        <label class="form-label">ဖော်ပြချက်</label>
        <textarea class="form-input form-textarea" id="new-product-description" required></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">ဖိုင်အမျိုးအစား</label>
        <select class="form-input" id="new-product-file-type" required>
          <option value="">ရွေးချယ်ပါ</option>
          <option value="apk">APK ဖိုင်</option>
          <option value="zip">ZIP ဖိုင်</option>
          <option value="file">အခြားဖိုင်</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">ဖိုင်</label>
        <div class="file-upload">
          <input type="file" id="new-product-file" required>
          <label for="new-product-file" class="file-upload-label">
            <i class="fas fa-upload mr-2"></i>ဖိုင်ရွေးချယ်ရန်
          </label>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">စျေးနှုန်း (ကျပ်)</label>
        <input type="number" class="form-input" id="new-product-price" min="0" required>
      </div>
      <div class="form-group">
        <label class="form-label">အိုင်ကွန် (ရွေးချယ်ခွင့်ရှိသည်)</label>
        <div class="file-upload">
          <input type="file" id="new-product-icon" accept="image/*">
          <label for="new-product-icon" class="file-upload-label">
            <i class="fas fa-image mr-2"></i>အိုင်ကွန်ရွေးချယ်ရန်
          </label>
        </div>
        <img id="new-product-icon-preview" class="image-preview" style="display: none;">
      </div>
      <button type="submit" class="btn-neon w-full">
        <i class="fas fa-plus mr-2"></i>ထုတ်ကုန်ထည့်ရန်
      </button>
    </form>
  </div>
</div>

<!-- Add Payment Method Modal -->
<div id="add-payment-method-modal" class="modal">
  <div class="modal-content max-w-lg">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-orbitron font-bold">ငွေပေးချေရေးနည်းလမ်းအသစ်</h2>
      <button onclick="closeModal('add-payment-method-modal')" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <form onsubmit="addPaymentMethod(event)">
      <div class="form-group">
        <label class="form-label">နည်းလမ်းအမည်</label>
        <input type="text" class="form-input" id="new-payment-method-name" required>
      </div>
      <div class="form-group">
        <label class="form-label">အကောင့်အချက်အလက်</label>
        <textarea class="form-input form-textarea" id="new-payment-method-info" required></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">ညွှန်ကြားချက်များ</label>
        <textarea class="form-input form-textarea" id="new-payment-method-instructions"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">QR ကုဒ် (ရွေးချယ်ခွင့်ရှိသည်)</label>
        <div class="file-upload">
          <input type="file" id="new-payment-method-qr" accept="image/*">
          <label for="new-payment-method-qr" class="file-upload-label">
            <i class="fas fa-qrcode mr-2"></i>QR ကုဒ်ရွေးချယ်ရန်
          </label>
        </div>
        <img id="new-payment-method-qr-preview" class="image-preview" style="display: none;">
      </div>
      <button type="submit" class="btn-neon w-full">
        <i class="fas fa-plus mr-2"></i>ထည့်ရန်
      </button>
    </form>
  </div>
</div>

<!-- Profile Modal -->
<div id="profile-modal" class="modal">
  <div class="modal-content max-w-lg">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-orbitron font-bold">ကျွန်ုပ်၏ပရိုဖိုင်</h2>
      <button onclick="closeModal('profile-modal')" class="text-gray-400 hover:text-white">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="profile-content">
      <!-- Profile content will be loaded here -->
    </div>
  </div>
</div>

<script>
// Supabase Configuration
const SUPABASE_URL = 'https://rliwdosxsbauwxkayjoa.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJsaXdkb3N4c2JhdXd4a2F5am9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMDA2NjIsImV4cCI6MjA2OTY3NjY2Mn0.uDvU9eX3Cy--D9l6daGaO2QMpn1YnxMJYVlbaeIgHu4';
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Global Variables
let currentUser = null;
let currentSection = 'dashboard';
let globalChatInterval = null;
let privateChatInterval = null;

// Initialize Application
document.addEventListener('DOMContentLoaded', async function() {
  await initializeApp();
});

// Initialize App
async function initializeApp() {
  try {
    // Check for existing session
    const sessionData = localStorage.getItem('fps_gfx_session');
    if (sessionData) {
      const session = JSON.parse(sessionData);
      if (session && session.expires_at > Date.now()) {
        // Validate session with server
        const { data: user } = await supabase
          .from('users')
          .select('*')
          .eq('id', session.user_id)
          .single();
        
        if (user && !user.is_banned) {
          currentUser = user;
          showMainApp();
          return;
        }
      }
    }
    
    // No valid session, show auth modal
    showAuthModal();
  } catch (error) {
    console.error('Initialization error:', error);
    showAuthModal();
  } finally {
    hideLoadingScreen();
  }
}

// Show/Hide Loading Screen
function hideLoadingScreen() {
  document.getElementById('loading-screen').style.display = 'none';
}

// Authentication Functions
function showAuthModal() {
  document.getElementById('auth-modal').classList.add('active');
}

function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('active');
}

function showLoginForm() {
  document.getElementById('login-form').style.display = 'block';
  document.getElementById('signup-form').style.display = 'none';
}

function showSignupForm() {
  document.getElementById('login-form').style.display = 'none';
  document.getElementById('signup-form').style.display = 'block';
}

// Handle Login
async function handleLogin(event) {
  event.preventDefault();
  
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  
  try {
    // Get user by email
    const { data: user, error } = await supabase
      .from('users')
      .select('*')
      .eq('email', email)
      .single();
    
    if (error || !user) {
      alert('အီးမေးလ် သို့မဟုတ် စကားဝှက်မှားနေပါသည်!');
      return;
    }
    
    // Verify password
    const isValidPassword = await bcrypt.compare(password, user.password_hash);
    if (!isValidPassword) {
      alert('အီးမေးလ် သို့မဟုတ် စကားဝှက်မှားနေပါသည်!');
      return;
    }
    
    if (user.is_banned) {
      alert('သင့်အကောင့်ကို ပိတ်ထားပါသည်!');
      return;
    }
    
    // Create session
    const sessionToken = generateSessionToken();
    const expiresAt = new Date();
    expiresAt.setDate(expiresAt.getDate() + 30); // 30 days
    
    const { error: sessionError } = await supabase
      .from('user_sessions')
      .insert({
        user_id: user.id,
        session_token: sessionToken,
        expires_at: expiresAt.toISOString(),
        ip_address: await getUserIP(),
        user_agent: navigator.userAgent
      });
    
    if (sessionError) {
      console.error('Session creation error:', sessionError);
      alert('အကောင့်ဝင်ရောက်ခြင်းတွင် ပြဿနာရှိသည်!');
      return;
    }
    
    // Store session locally
    localStorage.setItem('fps_gfx_session', JSON.stringify({
      user_id: user.id,
      session_token: sessionToken,
      expires_at: expiresAt.getTime()
    }));
    
    currentUser = user;
    closeModal('auth-modal');
    showMainApp();
    
  } catch (error) {
    console.error('Login error:', error);
    alert('အကောင့်ဝင်ရောက်ခြင်းတွင် ပြဿနာရှိသည်!');
  }
}

// Handle Signup
async function handleSignup(event) {
  event.preventDefault();
  
  const email = document.getElementById('signup-email').value;
  const password = document.getElementById('signup-password').value;
  const confirmPassword = document.getElementById('signup-confirm-password').value;
  const username = document.getElementById('signup-username').value;
  const displayName = document.getElementById('signup-display-name').value;
  const profilePictureFile = document.getElementById('signup-profile-picture').files[0];
  
  // Validation
  if (password !== confirmPassword) {
    alert('စကားဝှက်များ မတူညီပါ!');
    return;
  }
  
  if (password.length < 6) {
    alert('စကားဝှက်သည် အနည်းဆုံး ၆ လုံးရှိရပါမည်!');
    return;
  }
  
  try {
    // Check if email already exists
    const { data: existingUser } = await supabase
      .from('users')
      .select('id')
      .eq('email', email)
      .single();
    
    if (existingUser) {
      alert('ဤအီးမေးလ်ဖြင့် အကောင့်ရှိပြီးသားဖြစ်ပါသည်!');
      return;
    }
    
    // Check if username already exists
    const { data: existingUsername } = await supabase
      .from('users')
      .select('id')
      .eq('username', username)
      .single();
    
    if (existingUsername) {
      alert('ဤအသုံးပြုသူအမည်ကို အသုံးပြုထားပြီးသားဖြစ်ပါသည်!');
      return;
    }
    
    // Hash password
    const hashedPassword = await bcrypt.hash(password, 10);
    
    // Upload profile picture if provided
    let profilePictureUrl = null;
    if (profilePictureFile) {
      const fileExt = profilePictureFile.name.split('.').pop();
      const fileName = `${Date.now()}.${fileExt}`;
      
      const { data: uploadData, error: uploadError } = await supabase.storage
        .from('profile-pictures')
        .upload(fileName, profilePictureFile);
      
      if (!uploadError) {
        const { data: urlData } = supabase.storage
          .from('profile-pictures')
          .getPublicUrl(fileName);
        profilePictureUrl = urlData.publicUrl;
      }
    }
    
    // Create user
    const { data: newUser, error } = await supabase
      .from('users')
      .insert({
        email,
        password_hash: hashedPassword,
        username,
        display_name: displayName,
        profile_picture: profilePictureUrl
      })
      .select()
      .single();
    
    if (error) {
      console.error('Signup error:', error);
      alert('အကောင့်ဖွင့်ခြင်းတွင် ပြဿနာရှိသည်!');
      return;
    }
    
    // Create session
    const sessionToken = generateSessionToken();
    const expiresAt = new Date();
    expiresAt.setDate(expiresAt.getDate() + 30);
    
    const { error: sessionError } = await supabase
      .from('user_sessions')
      .insert({
        user_id: newUser.id,
        session_token: sessionToken,
        expires_at: expiresAt.toISOString(),
        ip_address: await getUserIP(),
        user_agent: navigator.userAgent
      });
    
    if (sessionError) {
      console.error('Session creation error:', sessionError);
    }
    
    // Store session locally
    localStorage.setItem('fps_gfx_session', JSON.stringify({
      user_id: newUser.id,
      session_token: sessionToken,
      expires_at: expiresAt.getTime()
    }));
    
    currentUser = newUser;
    closeModal('auth-modal');
    showMainApp();
    
    alert('အကောင့်ဖွင့်ခြင်း အောင်မြင်ပါသည်!');
    
  } catch (error) {
    console.error('Signup error:', error);
    alert('အကောင့်ဖွင့်ခြင်းတွင် ပြဿနာရှိသည်!');
  }
}

// Show Main Application
async function showMainApp() {
  document.getElementById('main-app').style.display = 'block';
  
  // Update header
  document.getElementById('header-username').textContent = currentUser.display_name;
  if (currentUser.profile_picture) {
    document.getElementById('header-profile-pic').src = currentUser.profile_picture;
  }
  
  // Show seller nav if KYC approved
  if (currentUser.kyc_status === 'approved') {
    document.getElementById('seller-nav').style.display = 'block';
  }
  
  // Load initial data
  await loadDashboardData();
  
  // Start real-time updates
  startRealTimeUpdates();
}

// Logout
async function logout() {
  if (confirm('အကောင့်မှ ထွက်ရန် သေချာပါသလား?')) {
    try {
      // Remove session from database
      const sessionData = localStorage.getItem('fps_gfx_session');
      if (sessionData) {
        const session = JSON.parse(sessionData);
        await supabase
          .from('user_sessions')
          .delete()
          .eq('session_token', session.session_token);
      }
      
      // Clear local storage
      localStorage.removeItem('fps_gfx_session');
      
      // Reset application
      currentUser = null;
      document.getElementById('main-app').style.display = 'none';
      showAuthModal();
      
      // Stop intervals
      if (globalChatInterval) clearInterval(globalChatInterval);
      if (privateChatInterval) clearInterval(privateChatInterval);
      
    } catch (error) {
      console.error('Logout error:', error);
    }
  }
}

// Navigation Functions
function showSection(sectionName) {
  // Hide all sections
  const sections = document.querySelectorAll('.section');
  sections.forEach(section => section.style.display = 'none');
  
  // Remove active class from all nav items
  const navItems = document.querySelectorAll('.nav-item');
  navItems.forEach(item => item.classList.remove('active'));
  
  // Show selected section
  document.getElementById(sectionName + '-section').style.display = 'block';
  
  // Add active class to current nav item
  event.currentTarget.classList.add('active');
  
  currentSection = sectionName;
  
  // Load section data
  loadSectionData(sectionName);
}

// Load Section Data
async function loadSectionData(sectionName) {
  switch (sectionName) {
    case 'dashboard':
      await loadDashboardData();
      break;
    case 'products':
      await loadProducts();
      break;
    case 'user-products':
      await loadUserProducts();
      break;
    case 'my-purchases':
      await loadMyPurchases();
      break;
    case 'seller-dashboard':
      await loadSellerDashboard();
      break;
    case 'global-chat':
      await loadGlobalChat();
      break;
    case 'private-chat':
      await loadPrivateChat();
      break;
    case 'support':
      await loadSupport();
      break;
    case 'kyc':
      await loadKYC();
      break;
    case 'news':
      await loadNews();
      break;
    case 'about':
      await loadAbout();
      break;
  }
}

// Dashboard Functions
async function loadDashboardData() {
  try {
    // Load stats
    const { data: downloads } = await supabase
      .from('user_downloads')
      .select('download_count')
      .eq('user_id', currentUser.id);
    
    const totalDownloads = downloads?.reduce((sum, item) => sum + item.download_count, 0) || 0;
    document.getElementById('total-downloads').textContent = totalDownloads;
    
    const { data: products } = await supabase
      .from('products')
      .select('id')
      .eq('is_active', true);
    
    document.getElementById('available-products').textContent = products?.length || 0;
    
    const { data: purchases } = await supabase
      .from('orders')
      .select('id')
      .eq('user_id', currentUser.id)
      .eq('status', 'approved');
    
    document.getElementById('total-purchases').textContent = purchases?.length || 0;
    
    // Load recent activity
    await loadRecentActivity();
    
  } catch (error) {
    console.error('Dashboard loading error:', error);
  }
}

async function loadRecentActivity() {
  const activityContainer = document.getElementById('recent-activity');
  activityContainer.innerHTML = '<p class="text-gray-400">လှုပ်ရှားမှုများ မရှိသေးပါ။</p>';
  
  // This would load recent user activities
  // Implementation depends on your activity tracking needs
}

// Products Functions
async function loadProducts() {
  try {
    const { data: products, error } = await supabase
      .from('products')
      .select('*')
      .eq('is_active', true)
      .order('created_at', { ascending: false });
    
    if (error) throw error;
    
    const container = document.getElementById('products-grid');
    container.innerHTML = '';
    
    if (!products || products.length === 0) {
      container.innerHTML = '<p class="text-gray-400 text-center col-span-full">ထုတ်ကုန်များ မရှိသေးပါ။</p>';
      return;
    }
    
    products.forEach(product => {
      const productCard = createProductCard(product);
      container.appendChild(productCard);
    });
    
  } catch (error) {
    console.error('Products loading error:', error);
  }
}

function createProductCard(product) {
  const card = document.createElement('div');
  card.className = 'product-card';
  card.onclick = () => showProductDetails(product);
  
  const priceText = product.is_free ? 'အခမဲ့' : `${product.price} ကျပ်`;
  const iconUrl = product.icon_url || 'https://via.placeholder.com/100';
  
  card.innerHTML = `
    <div class="p-4">
      <img src="${iconUrl}" alt="${product.name}" class="w-16 h-16 rounded-lg mx-auto mb-4">
      <h3 class="font-bold text-lg mb-2">${product.name}</h3>
      <p class="text-gray-400 text-sm mb-4">${product.description?.substring(0, 100) || ''}...</p>
      <div class="flex justify-between items-center">
        <span class="text-green-400 font-bold">${priceText}</span>
        <span class="text-xs text-gray-500">
          <i class="fas fa-download mr-1"></i>${product.download_count}
        </span>
      </div>
    </div>
  `;
  
  return card;
}

async function showProductDetails(product) {
  const modal = document.getElementById('product-details-modal');
  const content = document.getElementById('product-details-content');
  
  const priceText = product.is_free ? 'အခမဲ့' : `${product.price} ကျပ်`;
  const iconUrl = product.icon_url || 'https://via.placeholder.com/200';
  
  // Check if user already owns this product
  const { data: existingPurchase } = await supabase
    .from('orders')
    .select('id')
    .eq('user_id', currentUser.id)
    .eq('product_id', product.id)
    .eq('status', 'approved')
    .single();
  
  const downloadButton = existingPurchase 
    ? '<button onclick="downloadProduct(\'' + product.id + '\')" class="btn-neon w-full"><i class="fas fa-download mr-2"></i>ဒေါင်းလုဒ်ရယူရန်</button>'
    : product.is_free 
      ? '<button onclick="downloadFreeProduct(\'' + product.id + '\')" class="btn-neon w-full"><i class="fas fa-download mr-2"></i>အခမဲ့ဒေါင်းလုဒ်</button>'
      : '<button onclick="showPurchaseModal(\'' + product.id + '\')" class="btn-neon w-full"><i class="fas fa-shopping-cart mr-2"></i>ဝယ်ယူရန်</button>';
  
  content.innerHTML = `
    <div class="text-center mb-6">
      <img src="${iconUrl}" alt="${product.name}" class="w-32 h-32 rounded-lg mx-auto mb-4">
      <h3 class="text-2xl font-bold mb-2">${product.name}</h3>
      <p class="text-green-400 text-xl font-bold">${priceText}</p>
    </div>
    <div class="glass-dark p-4 rounded-lg mb-6">
      <h4 class="font-bold mb-2">ဖော်ပြချက်</h4>
      <p class="text-gray-300">${product.description || 'ဖော်ပြချက်မရှိပါ။'}</p>
    </div>
    <div class="grid grid-cols-2 gap-4 mb-6 text-sm">
      <div class="text-center">
        <i class="fas fa-file text-blue-400 mb-2"></i>
        <p class="text-gray-400">ဖိုင်အမျိုးအစား</p>
        <p class="font-bold">${product.file_type.toUpperCase()}</p>
      </div>
      <div class="text-center">
        <i class="fas fa-download text-green-400 mb-2"></i>
        <p class="text-gray-400">ဒေါင်းလုဒ်အရေအတွက်</p>
        <p class="font-bold">${product.download_count}</p>
      </div>
    </div>
    ${downloadButton}
  `;
  
  modal.classList.add('active');
}

async function showPurchaseModal(productId) {
  try {
    const { data: product } = await supabase
      .from('products')
      .select('*')
      .eq('id', productId)
      .single();
    
    const { data: paymentMethods } = await supabase
      .from('payment_methods')
      .select('*')
      .eq('is_active', true);
    
    const modal = document.getElementById('purchase-modal');
    const content = document.getElementById('purchase-content');
    
    let paymentMethodsOptions = '';
    if (paymentMethods && paymentMethods.length > 0) {
      paymentMethodsOptions = paymentMethods.map(method => 
        `<option value="${method.id}">${method.method_name}</option>`
      ).join('');
    }
    
    content.innerHTML = `
      <div class="text-center mb-6">
        <h3 class="text-xl font-bold mb-2">${product.name}</h3>
        <p class="text-green-400 text-xl font-bold">${product.price} ကျပ်</p>
      </div>
      
      <form onsubmit="processPurchase(event, '${productId}')">
        <div class="form-group">
          <label class="form-label">ငွေပေးချေရေးနည်းလမ်း</label>
          <select class="form-input" id="payment-method" required>
            <option value="">ရွေးချယ်ပါ</option>
            ${paymentMethodsOptions}
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">ငွေလွှဲပြေစာပုံ</label>
          <div class="file-upload">
            <input type="file" id="receipt-image" accept="image/*" required>
            <label for="receipt-image" class="file-upload-label">
              <i class="fas fa-receipt mr-2"></i>ပြေစာပုံရွေးချယ်ရန်
            </label>
          </div>
          <img id="receipt-preview" class="image-preview" style="display: none;">
        </div>
        
        <div class="text-sm text-gray-400 mb-4">
          <p><i class="fas fa-info-circle mr-2"></i>ငွေလွှဲပြီးပြေစာပုံကို ပေးပို့ပါ။ အတည်ပြုချက်ရရှိပြီးသည့်နောက် ဒေါင်းလုဒ်ရယူနိုင်ပါသည်။</p>
        </div>
        
        <button type="submit" class="btn-neon w-full">
          <i class="fas fa-paper-plane mr-2"></i>အမိန့်ပို့ရန်
        </button>
      </form>
    `;
    
    // Add preview functionality for receipt
    document.getElementById('receipt-image').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const preview = document.getElementById('receipt-preview');
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });
    
    closeModal('product-details-modal');
    modal.classList.add('active');
    
  } catch (error) {
    console.error('Purchase modal error:', error);
    alert('ပြဿနာရှိသည်! နောက်မှ ထပ်ကြိုးစားပါ။');
  }
}

async function processPurchase(event, productId) {
  event.preventDefault();
  
  const paymentMethodId = document.getElementById('payment-method').value;
  const receiptFile = document.getElementById('receipt-image').files[0];
  
  if (!receiptFile) {
    alert('ပြေစာပုံထည့်ပါ!');
    return;
  }
  
  try {
    // Get product details
    const { data: product } = await supabase
      .from('products')
      .select('price')
      .eq('id', productId)
      .single();
    
    // Upload receipt image
    const fileExt = receiptFile.name.split('.').pop();
    const fileName = `receipt_${Date.now()}.${fileExt}`;
    
    const { data: uploadData, error: uploadError } = await supabase.storage
      .from('receipts')
      .upload(fileName, receiptFile);
    
    if (uploadError) {
      alert('ပြေစာပုံတင်ခြင်းတွင် ပြဿနာရှိသည်!');
      return;
    }
    
    const { data: urlData } = supabase.storage
      .from('receipts')
      .getPublicUrl(fileName);
    
    // Create order
    const { error: orderError } = await supabase
      .from('orders')
      .insert({
        user_id: currentUser.id,
        product_id: productId,
        amount: product.price,
        payment_method_id: paymentMethodId,
        receipt_image: urlData.publicUrl,
        status: 'pending'
      });
    
    if (orderError) {
      alert('အမိန့်တင်ခြင်းတွင် ပြဿနာရှိသည်!');
      return;
    }
    
    alert('အမိန့်အောင်မြင်စွာ တင်ပြီးပါပြီ! အတည်ပြုချက်ကို စောင့်ဆိုင်းပါ။');
    closeModal('purchase-modal');
    
  } catch (error) {
    console.error('Purchase error:', error);
    alert('ဝယ်ယူခြင်းတွင် ပြဿနာရှိသည်!');
  }
}

// Global Chat Functions
async function loadGlobalChat() {
  try {
    const { data: messages, error } = await supabase
      .from('global_chat')
      .select(`
        *,
        users(username, display_name, profile_picture)
      `)
      .eq('is_deleted', false)
      .order('created_at', { ascending: true })
      .limit(50);
    
    if (error) throw error;
    
    const container = document.getElementById('global-chat-messages');
    container.innerHTML = '';
    
    if (messages && messages.length > 0) {
      messages.forEach(message => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${message.user_id === currentUser.id ? 'own' : 'other'}`;
        
        const profilePic = message.users.profile_picture || 'https://via.placeholder.com/30';
        const displayName = message.users.display_name || message.users.username;
        
        messageDiv.innerHTML = `
          <div class="flex items-start gap-2">
            <img src="${profilePic}" alt="${displayName}" class="w-8 h-8 rounded-full">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-1">
                <span class="font-bold text-sm">${displayName}</span>
                <span class="text-xs text-gray-500">${formatTime(message.created_at)}</span>
              </div>
              <p class="text-gray-300">${message.message}</p>
            </div>
          </div>
        `;
        
        container.appendChild(messageDiv);
      });
      
      container.scrollTop = container.scrollHeight;
    }
    
    // Start real-time updates if not already started
    if (!globalChatInterval) {
      globalChatInterval = setInterval(() => {
        if (currentSection === 'global-chat') {
          loadGlobalChat();
        }
      }, 3000);
    }
    
  } catch (error) {
    console.error('Global chat loading error:', error);
  }
}

async function sendGlobalMessage(event) {
  event.preventDefault();
  
  const input = document.getElementById('global-chat-input');
  const message = input.value.trim();
  
  if (!message) return;
  
  try {
    const { error } = await supabase
      .from('global_chat')
      .insert({
        user_id: currentUser.id,
        message: message
      });
    
    if (error) throw error;
    
    input.value = '';
    await loadGlobalChat();
    
  } catch (error) {
    console.error('Send message error:', error);
    alert('မက်ဆေ့ခ်ပို့ခြင်းတွင် ပြဿနာရှိသည်!');
  }
}

// KYC Functions
async function loadKYC() {
  try {
    const { data: kycData } = await supabase
      .from('kyc_documents')
      .select('*')
      .eq('user_id', currentUser.id)
      .order('submitted_at', { ascending: false })
      .limit(1)
      .single();
    
    const statusCard = document.getElementById('kyc-status-card');
    const formContainer = document.getElementById('kyc-form-container');
    
    if (kycData) {
      // Show status
      let statusClass, statusText, statusIcon;
      
      switch (kycData.status) {
        case 'pending':
          statusClass = 'badge-warning';
          statusText = 'စောင့်ဆိုင်းနေသည်';
          statusIcon = 'fas fa-clock';
          break;
        case 'approved':
          statusClass = 'badge-success';
          statusText = 'အတည်ပြုပြီး';
          statusIcon = 'fas fa-check-circle';
          break;
        case 'rejected':
          statusClass = 'badge-error';
          statusText = 'ငြင်းဆိုခံရသည်';
          statusIcon = 'fas fa-times-circle';
          break;
      }
      
      statusCard.innerHTML = `
        <i class="${statusIcon} text-4xl mb-4"></i>
        <h3 class="text-xl font-bold mb-2">KYC အခြေအနေ</h3>
        <span class="badge ${statusClass}">${statusText}</span>
        ${kycData.status === 'approved' ? '<p class="text-green-400 mt-2">သင်သည် ရောင်းချသူဖြစ်နိုင်ပါသည်!</p>' : ''}
        ${kycData.status === 'rejected' ? `<p class="text-red-400 mt-2">အကြောင်းရင်း: ${kycData.rejection_reason}</p>` : ''}
      `;
      
      // Show resubmit form if rejected
      if (kycData.status === 'rejected') {
        showKYCForm(formContainer);
      } else {
        formContainer.innerHTML = '';
      }
      
    } else {
      // No KYC submitted yet
      statusCard.innerHTML = `
        <i class="fas fa-id-card text-4xl mb-4"></i>
        <h3 class="text-xl font-bold mb-2">KYC စာရွက်စာတမ်း</h3>
        <p class="text-gray-400">ရောင်းချသူဖြစ်ရန် KYC စာရွက်စာတမ်းတင်ပါ</p>
      `;
      
      showKYCForm(formContainer);
    }
    
  } catch (error) {
    console.error('KYC loading error:', error);
  }
}

function showKYCForm(container) {
  container.innerHTML = `
    <div class="glass-dark p-6 rounded-lg">
      <h3 class="text-xl font-bold mb-6">KYC စာရွက်စာတမ်းတင်ရန်</h3>
      
      <form onsubmit="submitKYC(event)">
        <div class="form-group">
          <label class="form-label">အမည်အပြည့်အစုံ</label>
          <input type="text" class="form-input" id="kyc-full-name" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">အထောက်အထားအမျိုးအစား</label>
          <select class="form-input" id="kyc-id-type" required>
            <option value="">ရွေးချယ်ပါ</option>
            <option value="nrc">နိုင်ငံသားစီစစ်ရေးကတ်</option>
            <option value="passport">နိုင်ငံကူးလက်မှတ်</option>
            <option value="driving_license">ယာဉ်မောင်းလိုင်စင်</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">အထောက်အထားနံပါတ်</label>
          <input type="text" class="form-input" id="kyc-id-number" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">အထောက်အထားရှေ့ပိုင်းပုံ</label>
          <div class="file-upload">
            <input type="file" id="kyc-front-image" accept="image/*" required>
            <label for="kyc-front-image" class="file-upload-label">
              <i class="fas fa-image mr-2"></i>ရှေ့ပိုင်းပုံရွေးချယ်ရန်
            </label>
          </div>
          <img id="kyc-front-preview" class="image-preview" style="display: none;">
        </div>
        
        <div class="form-group">
          <label class="form-label">အထောက်အထားနောက်ပိုင်းပုံ (လိုအပ်ပါက)</label>
          <div class="file-upload">
            <input type="file" id="kyc-back-image" accept="image/*">
            <label for="kyc-back-image" class="file-upload-label">
              <i class="fas fa-image mr-2"></i>နောက်ပိုင်းပုံရွေးချယ်ရန်
            </label>
          </div>
          <img id="kyc-back-preview" class="image-preview" style="display: none;">
        </div>
        
        <div class="form-group">
          <label class="form-label">မျက်နှာပုံ (Selfie)</label>
          <div class="file-upload">
            <input type="file" id="kyc-selfie-image" accept="image/*" required>
            <label for="kyc-selfie-image" class="file-upload-label">
              <i class="fas fa-camera mr-2"></i>မျက်နှာပုံရွေးချယ်ရန်
            </label>
          </div>
          <img id="kyc-selfie-preview" class="image-preview" style="display: none;">
        </div>
        
        <div class="form-group">
          <label class="form-label">နောက်ထပ်အချက်အလက် (ရွေးချယ်ခွင့်ရှိသည်)</label>
          <textarea class="form-input form-textarea" id="kyc-additional-info" placeholder="နောက်ထပ်သိလိုသည့် အချက်အလက်များ..."></textarea>
        </div>
        
        <button type="submit" class="btn-neon w-full">
          <i class="fas fa-paper-plane mr-2"></i>KYC တင်ရန်
        </button>
      </form>
    </div>
  `;
  
  // Add image preview functionality
  ['front', 'back', 'selfie'].forEach(type => {
    const input = document.getElementById(`kyc-${type}-image`);
    const preview = document.getElementById(`kyc-${type}-preview`);
    
    input.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });
  });
}

async function submitKYC(event) {
  event.preventDefault();
  
  const fullName = document.getElementById('kyc-full-name').value;
  const idType = document.getElementById('kyc-id-type').value;
  const idNumber = document.getElementById('kyc-id-number').value;
  const frontImage = document.getElementById('kyc-front-image').files[0];
  const backImage = document.getElementById('kyc-back-image').files[0];
  const selfieImage = document.getElementById('kyc-selfie-image').files[0];
  const additionalInfo = document.getElementById('kyc-additional-info').value;
  
  if (!frontImage || !selfieImage) {
    alert('လိုအပ်သည့်ပုံများထည့်ပါ!');
    return;
  }
  
  try {
    // Upload images
    const uploads = [];
    
    // Front image
    const frontExt = frontImage.name.split('.').pop();
    const frontFileName = `kyc_front_${currentUser.id}_${Date.now()}.${frontExt}`;
    uploads.push(
      supabase.storage
        .from('kyc-documents')
        .upload(frontFileName, frontImage)
    );
    
    // Back image (if provided)
    let backFileName = null;
    if (backImage) {
      const backExt = backImage.name.split('.').pop();
      backFileName = `kyc_back_${currentUser.id}_${Date.now()}.${backExt}`;
      uploads.push(
        supabase.storage
          .from('kyc-documents')
          .upload(backFileName, backImage)
      );
    }
    
    // Selfie image
    const selfieExt = selfieImage.name.split('.').pop();
    const selfieFileName = `kyc_selfie_${currentUser.id}_${Date.now()}.${selfieExt}`;
    uploads.push(
      supabase.storage
        .from('kyc-documents')
        .upload(selfieFileName, selfieImage)
    );
    
    const uploadResults = await Promise.all(uploads);
    
    // Check for upload errors
    for (const result of uploadResults) {
      if (result.error) {
        alert('ပုံတင်ခြင်းတွင် ပြဿနာရှိသည်!');
        return;
      }
    }
    
    // Get public URLs
    const { data: frontUrl } = supabase.storage
      .from('kyc-documents')
      .getPublicUrl(frontFileName);
    
    const { data: backUrl } = backFileName ? supabase.storage
      .from('kyc-documents')
      .getPublicUrl(backFileName) : { data: null };
    
    const { data: selfieUrl } = supabase.storage
      .from('kyc-documents')
      .getPublicUrl(selfieFileName);
    
    // Submit KYC
    const { error } = await supabase
      .from('kyc_documents')
      .insert({
        user_id: currentUser.id,
        full_name: fullName,
        id_type: idType,
        id_number: idNumber,
        front_image: frontUrl.publicUrl,
        back_image: backUrl?.data?.publicUrl || null,
        selfie_image: selfieUrl.publicUrl,
        additional_info: additionalInfo || null,
        status: 'pending'
      });
    
    if (error) throw error;
    
    alert('KYC စာရွက်စာတမ်း အောင်မြင်စွာတင်ပြီးပါပြီ! စစ်ဆေးပြီးသည့်နောက် အတည်ပြုချက်ရရှိပါမည်။');
    await loadKYC();
    
  } catch (error) {
    console.error('KYC submission error:', error);
    alert('KYC တင်ခြင်းတွင် ပြဿနာရှိသည်!');
  }
}

// News Functions
async function loadNews() {
  try {
    const { data: news, error } = await supabase
      .from('news')
      .select('*')
      .eq('is_active', true)
      .order('created_at', { ascending: false });
    
    if (error) throw error;
    
    const container = document.getElementById('news-list');
    container.innerHTML = '';
    
    if (!news || news.length === 0) {
      container.innerHTML = '<p class="text-gray-400 text-center">သတင်းများ မရှိသေးပါ။</p>';
      return;
    }
    
    news.forEach(item => {
      const newsCard = document.createElement('div');
      newsCard.className = 'glass-dark p-6 rounded-lg';
      
      const mediaContent = item.media_url 
        ? `<img src="${item.media_url}" alt="${item.title}" class="w-full h-48 object-cover rounded-lg mb-4">`
        : '';
      
      const socialLinks = [];
      if (item.youtube_link) socialLinks.push(`<a href="${item.youtube_link}" target="_blank" class="text-red-500 hover:text-red-400"><i class="fab fa-youtube"></i></a>`);
      if (item.tiktok_link) socialLinks.push(`<a href="${item.tiktok_link}" target="_blank" class="text-pink-500 hover:text-pink-400"><i class="fab fa-tiktok"></i></a>`);
      if (item.telegram_link) socialLinks.push(`<a href="${item.telegram_link}" target="_blank" class="text-blue-500 hover:text-blue-400"><i class="fab fa-telegram"></i></a>`);
      if (item.facebook_link) socialLinks.push(`<a href="${item.facebook_link}" target="_blank" class="text-blue-600 hover:text-blue-500"><i class="fab fa-facebook"></i></a>`);
      
      newsCard.innerHTML = `
        ${mediaContent}
        <h3 class="text-xl font-bold mb-3">${item.title}</h3>
        <p class="text-gray-300 mb-4">${item.content}</p>
        <div class="flex justify-between items-center text-sm">
          <span class="text-gray-500">${formatDate(item.created_at)}</span>
          <div class="flex gap-3">
            ${socialLinks.join('')}
          </div>
        </div>
      `;
      
      container.appendChild(newsCard);
    });
    
  } catch (error) {
    console.error('News loading error:', error);
  }
}

// About Functions
async function loadAbout() {
  try {
    const { data: aboutInfo, error } = await supabase
      .from('about_info')
      .select('*')
      .limit(1)
      .single();
    
    if (error) throw error;
    
    const container = document.getElementById('about-content');
    
    if (!aboutInfo) {
      container.innerHTML = '<p class="text-gray-400 text-center">အချက်အလက်များ မရှိသေးပါ။</p>';
      return;
    }
    
    container.innerHTML = `
      <div class="text-center mb-8">
        <h3 class="text-2xl font-orbitron font-bold mb-4">FPS GFX Tool</h3>
        <p class="text-gray-300">မြန်မာနိုင်ငံအတွက် အကောင်းဆုံး FPS GFX ကိရိယာများ</p>
      </div>
      
      <div class="space-y-6">
        <div class="flex items-center gap-4">
          <i class="fas fa-user text-blue-400 text-xl"></i>
          <div>
            <p class="font-bold">ဆက်သွယ်ရမည့်ပုဂ္ဂိုလ်</p>
            <p class="text-gray-400">${aboutInfo.contact_name || 'မသတ်မှတ်ရသေး'}</p>
          </div>
        </div>
        
        <div class="flex items-center gap-4">
          <i class="fas fa-phone text-green-400 text-xl"></i>
          <div>
            <p class="font-bold">ဖုန်းနံပါတ်</p>
            <p class="text-gray-400">${aboutInfo.phone_number || 'မသတ်မှတ်ရသေး'}</p>
          </div>
        </div>
        
        <div class="flex items-center gap-4">
          <i class="fas fa-envelope text-yellow-400 text-xl"></i>
          <div>
            <p class="font-bold">အီးမေးလ်</p>
            <p class="text-gray-400">${aboutInfo.email || 'မသတ်မှတ်ရသေး'}</p>
          </div>
        </div>
        
        <div class="border-t border-gray-600 pt-6">
          <p class="font-bold mb-4">ဆိုရှယ်မီဒီယာ</p>
          <div class="flex gap-4">
            ${aboutInfo.telegram_link ? `<a href="${aboutInfo.telegram_link}" target="_blank" class="text-blue-500 hover:text-blue-400 text-2xl"><i class="fab fa-telegram"></i></a>` : ''}
            ${aboutInfo.viber_link ? `<a href="${aboutInfo.viber_link}" target="_blank" class="text-purple-500 hover:text-purple-400 text-2xl"><i class="fab fa-viber"></i></a>` : ''}
            ${aboutInfo.facebook_link ? `<a href="${aboutInfo.facebook_link}" target="_blank" class="text-blue-600 hover:text-blue-500 text-2xl"><i class="fab fa-facebook"></i></a>` : ''}
            ${aboutInfo.tiktok_link ? `<a href="${aboutInfo.tiktok_link}" target="_blank" class="text-pink-500 hover:text-pink-400 text-2xl"><i class="fab fa-tiktok"></i></a>` : ''}
          </div>
        </div>
      </div>
    `;
    
  } catch (error) {
    console.error('About loading error:', error);
  }
}

// Profile Functions
async function showProfile() {
  const modal = document.getElementById('profile-modal');
  const content = document.getElementById('profile-content');
  
  content.innerHTML = `
    <div class="text-center mb-6">
      <img src="${currentUser.profile_picture || 'https://via.placeholder.com/100'}" alt="Profile" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-blue-400">
      <h3 class="text-xl font-bold">${currentUser.display_name}</h3>
      <p class="text-gray-400">@${currentUser.username}</p>
    </div>
    
    <div class="space-y-4">
      <div class="glass-dark p-4 rounded-lg">
        <div class="flex justify-between items-center mb-2">
          <span class="text-gray-400">အီးမေးလ်</span>
          <span>${currentUser.email}</span>
        </div>
        <div class="flex justify-between items-center mb-2">
          <span class="text-gray-400">အကောင့်အခြေအနေ</span>
          <span class="badge badge-success">${currentUser.account_status}</span>
        </div>
        <div class="flex justify-between items-center mb-2">
          <span class="text-gray-400">KYC အခြေအနေ</span>
          <span class="badge ${currentUser.kyc_status === 'approved' ? 'badge-success' : currentUser.kyc_status === 'rejected' ? 'badge-error' : 'badge-warning'}">${currentUser.kyc_status}</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-400">ရောင်းချခွင့်</span>
          <span class="badge ${currentUser.can_sell ? 'badge-success' : 'badge-error'}">${currentUser.can_sell ? 'ရှိသည်' : 'မရှိပါ'}</span>
        </div>
      </div>
      
      <button onclick="showEditProfile()" class="btn-neon w-full">
        <i class="fas fa-edit mr-2"></i>ပရိုဖိုင်ပြင်ဆင်ရန်
      </button>
    </div>
  `;
  
  modal.classList.add('active');
}

// Utility Functions
function generateSessionToken() {
  return Array.from(crypto.getRandomValues(new Uint8Array(32)))
    .map(b => b.toString(16).padStart(2, '0'))
    .join('');
}

async function getUserIP() {
  try {
    const response = await fetch('https://api.ipify.org?format=json');
    const data = await response.json();
    return data.ip;
  } catch {
    return null;
  }
}

function formatTime(timestamp) {
  return new Date(timestamp).toLocaleTimeString('my-MM', {
    hour: '2-digit',
    minute: '2-digit'
  });
}

function formatDate(timestamp) {
  return new Date(timestamp).toLocaleDateString('my-MM', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

function startRealTimeUpdates() {
  // This would typically set up WebSocket connections or polling
  // For demo purposes, using intervals
  
  // Update dashboard stats periodically
  setInterval(async () => {
    if (currentSection === 'dashboard') {
      await loadDashboardData();
    }
  }, 30000); // 30 seconds
}

// File upload preview handlers
document.addEventListener('change', function(e) {
  if (e.target.type === 'file' && e.target.accept === 'image/*') {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const previewId = e.target.id + '-preview';
        const preview = document.getElementById(previewId);
        if (preview) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        }
      };
      reader.readAsDataURL(file);
    }
  }
});

// Add more functions as needed for other features...
// This is a comprehensive base that includes all the major functionality requested
</script>

</body>
</html>
